import{_ as A,k as b,l as k,c as l,o as c,b as I,B as y,n as N,A as w,t as O,ak as v,U as C,r as T,e as f,a as E,h as D,w as x,F as P,j as L,P as z}from"./index-D8fxni52.js";import{C as M,i as R,a as j}from"./relation-DncSzthF.js";import{g,f as V,a as H}from"./rect-CzEpIJLg.js";import{a as Y}from"./color-DciZLlTH.js";import{S as W}from"./scroll-view-IRZ_HjQm.js";const F={name:"PressIndexAnchor",options:{...k,styleIsolation:"shared"},mixins:[M(R,{indexKey:"tIndex"})],props:{useSlot:Boolean,index:{type:[Number,String],default:""},...b},emits:[],data(){return{active:!1,wrapperStyle:"",anchorStyle:""}},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},scrollIntoView(e,t){g(this,".press-index-anchor-wrapper").then(s=>{const r=e+s.top;t==null||t(r)})}}},U={key:1};function $(e,t,s,r,o,i){return c(),l("div",null,[I("div",{class:"press-index-anchor-wrapper",style:y(o.wrapperStyle)},[I("div",{class:N("press-index-anchor "+(o.active?"press-index-anchor--active press-hairline--bottom":"")),style:y(o.anchorStyle)},[s.useSlot?w(e.$slots,"default",{key:0},void 0,!0):(c(),l("span",U,O(s.index),1))],6)],4)])}const q=A(F,[["render",$],["__scopeId","data-v-f54d6020"]]),G=()=>{const e=[];for(let s=0;s<26;s++)e.push(String.fromCharCode(65+s));return e},K={name:"PressIndexBar",options:{...k,styleIsolation:"shared"},mixins:[j(R),W],props:{sticky:{type:Boolean,default:!0},zIndex:{type:Number,default:1},highlightColor:{type:String,default:Y},stickyOffsetTop:{type:Number,default:0},indexList:{type:Array,default:()=>G()},...b},emits:["select"],data(){return{activeAnchorIndex:null,showSidebar:!1,sidebar:{},curScrollTop:0}},created(){this.scrollTop=0,this.children=[]},mounted(){this.updateData()},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},updateData(){C(()=>{this.timer!=null&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.showSidebar=!!this.children.length,C(()=>{this.setRect().then(()=>{this.onScroll()})})},0)})},setRect(){return Promise.all([this.setAnchorsRect(),this.setListRect(),this.setSiderbarRect()])},setAnchorsRect(){return Promise.all(this.children.map(e=>g(e,".press-index-anchor-wrapper").then(t=>(Object.assign(e,{height:t.height,top:t.top+this.scrollTop}),e))))},setListRect(){return g(this,".press-index-bar").then(e=>{v(e)&&Object.assign(this,{height:e.height,top:e.top+this.scrollTop})})},setSiderbarRect(){return g(this,".press-index-bar__sidebar").then(e=>{v(e)&&(this.sidebar={height:e.height,top:e.top})})},setDiffData({target:e,data:t}){const s={};Object.keys(t).forEach(r=>{e[r]!==t[r]&&(s[r]=t[r])}),Object.keys(s).length&&e.setData(s)},getAnchorRect(e){return g(e,".press-index-anchor-wrapper").then(t=>({height:t.height,top:t.top}))},getActiveAnchorIndex(){const{children:e,scrollTop:t}=this,{sticky:s}=this;for(let r=this.children.length-1;r>=0;r--){const o=r>0?e[r-1].height:0;if((s?o:0)+t>=e[r].top)return r}return-1},onScroll(e){var a,d;e&&(e.target||e.detail)&&(this.scrollTop=((a=e.target)==null?void 0:a.scrollTop)||((d=e.detail)==null?void 0:d.scrollTop)||0);const{children:t=[],scrollTop:s}=this;if(!t.length)return;const{sticky:r,stickyOffsetTop:o,zIndex:i,highlightColor:h}=this,n=this.getActiveAnchorIndex();if(this.setDiffData({target:this,data:{activeAnchorIndex:n}}),r){let m=!1;n!==-1&&(m=t[n].top<=+s),t.forEach((_,p)=>{if(p===n){let u="",S=`
              color: ${h};
            `;m&&(u=`
                height: ${t[p].height}px;
              `,S=`
                position: fixed;
                top: ${o}px;
                z-index: ${i};
                color: ${h};
              `),this.setDiffData({target:_,data:{active:!0,anchorStyle:S,wrapperStyle:u}})}else if(p===n-1){const u=t[p],S=u.top,B=`
              position: relative;
              transform: translate3d(0, ${(p===t.length-1?this.top:t[p+1].top)-S-u.height}px, 0);
              z-index: ${i};
              color: ${h};
            `;this.setDiffData({target:_,data:{active:!0,anchorStyle:B}})}else this.setDiffData({target:_,data:{active:!1,anchorStyle:"",wrapperStyle:""}})})}},onClick(){},onTouchMove(e){const t=this.children.length,s=e.touches[0],r=this.sidebar.height/t;let o;o=Math.floor((H(s.clientY)-this.sidebar.top)/r),o<0?o=0:o>t-1&&(o=t-1),this.scrollToAnchor(o)},onTouchStop(){this.scrollToAnchorIndex=null},scrollToAnchor(e){if(typeof e!="number"||this.scrollToAnchorIndex===e)return;this.scrollToAnchorIndex=e;const t=this.children.find(s=>s.index===this.indexList[e]);t!==void 0&&(t.scrollIntoView(this.scrollTop,this.changeScrollerTop),this.$emit("select",t.index))},onClickInner(e){var s,r;const t=(r=(s=e.currentTarget)==null?void 0:s.dataset)==null?void 0:r.index;t!==void 0&&this.scrollToAnchor(+t)},onWatchScroll(e){this.onScroll(e)},changeScrollerTop(e){const t=V("pressIndexBarWrapper"),s=document==null?void 0:document.querySelector(t);s&&(s.scrollTop=e)}}},X={class:"press-index-bar-container"},J={class:"press-index-bar"},Q=["data-index"];function Z(e,t,s,r,o,i){const h=T("scroll-view");return c(),l("div",X,[f(h,{id:"pressIndexBarWrapper",class:"press-index-bar-wrapper",enhanced:"","scroll-with-animation":!1,"scroll-y":"","scroll-top":o.curScrollTop,onScroll:i.onWatchScroll},{default:D(()=>[I("div",J,[w(e.$slots,"default",{},void 0,!0)])]),_:3},8,["scroll-top","onScroll"]),o.showSidebar?(c(),l("div",{key:0,class:"press-index-bar__sidebar",onClick:t[1]||(t[1]=x((...n)=>i.onClick&&i.onClick(...n),["stop","prevent"])),onTouchmove:t[2]||(t[2]=x((...n)=>i.onTouchMove&&i.onTouchMove(...n),["stop","prevent"])),onTouchend:t[3]||(t[3]=x((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop"])),onTouchcancel:t[4]||(t[4]=x((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop","prevent"]))},[(c(!0),l(P,null,L(s.indexList,(n,a)=>(c(),l("div",{key:a,class:"press-index-bar__index",style:y("z-index: "+(s.zIndex+1)+"; color: "+(o.activeAnchorIndex===a?s.highlightColor:"")),"data-index":a,onClick:t[0]||(t[0]=x((...d)=>i.onClickInner&&i.onClickInner(...d),["stop"]))},O(n),13,Q))),128))],32)):E("",!0)])}const ee=A(K,[["render",Z],["__scopeId","data-v-b4c42d23"]]);function te(){const e=[];for(let t=65;t<91;t++)e.push(String.fromCharCode(t));return e}const se=te(),re={i18n:{"zh-CN":{text:"文本",customIndexList:"自定义索引列表"},"en-US":{text:"Text",customIndexList:"Custom Index List"}},components:{PressCell:z,PressIndexBar:ee,PressIndexAnchor:q},data(){let e="",t=0;return t=44,{anchorList:se,wrapStyle:e,stickyOffsetTop:t}},mounted(){},methods:{onSelect(e){console.log("[onSelect]: ",e)}}};function oe(e,t,s,r,o,i){const h=T("PressIndexAnchor"),n=T("PressCell"),a=T("PressIndexBar");return c(),l("div",{class:"demo-wrap",style:y(o.wrapStyle)},[f(a,{"sticky-offset-top":o.stickyOffsetTop,onSelect:i.onSelect},{default:D(()=>[(c(!0),l(P,null,L(o.anchorList,(d,m)=>(c(),l("div",{key:m},[f(h,{index:d},null,8,["index"]),f(n,{title:e.t("text")},null,8,["title"]),f(n,{title:e.t("text")},null,8,["title"]),f(n,{title:e.t("text")},null,8,["title"])]))),128))]),_:1},8,["sticky-offset-top","onSelect"])],4)}const fe=A(re,[["render",oe]]);export{fe as default};
