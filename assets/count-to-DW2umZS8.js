import{_ as f,u as p,x as y,y as S,c as d,o as m,A as T,B as b,t as g,r as c,e as a,h as r,b as C}from"./index-D8fxni52.js";import{P as _,a as N}from"./press-grid-emINJMxs.js";import"./relation-DncSzthF.js";const F={props:{startValue:{type:[String,Number],default:0},endValue:{type:[String,Number],default:0},duration:{type:[String,Number],default:2e3},autoplay:{type:Boolean,default:!0},decimals:{type:[String,Number],default:0},useEasing:{type:Boolean,default:!0},decimal:{type:[String,Number],default:"."},color:{type:String,default:"#606266"},fontSize:{type:[String,Number],default:22},bold:{type:Boolean,default:!1},separator:{type:String,default:""},customStyle:{type:[String,Object],default:""},useSlot:{type:Boolean,default:!1}}};class D{constructor(e){const s={startValue:0,endValue:0,duration:2e3,autoplay:!0,decimals:0,decimal:".",separator:"",useEasing:!0,easingFn:(i,o,n,l)=>n*(-Math.pow(2,-10*i/l)+1)*1024/1023+o,onChange:()=>{},onEnd:()=>{}};this.config={...s,...e},this.localStartVal=this.config.startValue,this.displayValue=this.formatNumber(this.config.startValue),this.printVal=null,this.paused=!1,this.localDuration=Number(this.config.duration),this.startTime=null,this.timestamp=null,this.remaining=null,this.rAF=null,this.lastTime=0,this.countDown=this.config.startValue>this.config.endValue,this.config.autoplay&&this.start()}requestAnimationFrame(e){const s=new Date().getTime(),i=Math.max(0,16-(s-this.lastTime)),o=setTimeout(()=>{e(s+i)},i);return this.lastTime=s+i,o}cancelAnimationFrame(e){clearTimeout(e)}start(e){e&&(this.config={...this.config,...e||{}}),this.countDown=this.config.startValue>this.config.endValue,this.localStartVal=this.config.startValue,this.startTime=null,this.localDuration=this.config.duration,this.paused=!1,this.rAF=this.requestAnimationFrame(this.count.bind(this))}reStart(){this.paused?(this.resume(),this.paused=!1):(this.stop(),this.paused=!0)}stop(){this.cancelAnimationFrame(this.rAF)}resume(){this.remaining&&(this.startTime=0,this.localDuration=this.remaining,this.localStartVal=this.printVal,this.requestAnimationFrame(this.count.bind(this)))}reset(){var e,s;this.startTime=null,this.cancelAnimationFrame(this.rAF),this.displayValue=this.formatNumber(this.config.startValue),(s=(e=this.config).onChange)==null||s.call(e,this.displayValue)}count(e){var i,o,n,l;this.startTime||(this.startTime=e),this.timestamp=e;const s=e-this.startTime;this.remaining=this.localDuration-s,this.config.useEasing?this.countDown?this.printVal=this.localStartVal-this.config.easingFn(s,0,this.localStartVal-this.config.endValue,this.localDuration):this.printVal=this.config.easingFn(s,this.localStartVal,this.config.endValue-this.localStartVal,this.localDuration):this.countDown?this.printVal=this.localStartVal-(this.localStartVal-this.config.endValue)*(s/this.localDuration):this.printVal=this.localStartVal+(this.config.endValue-this.localStartVal)*(s/this.localDuration),this.countDown?this.printVal=this.printVal<this.config.endValue?this.config.endValue:this.printVal:this.printVal=this.printVal>this.config.endValue?this.config.endValue:this.printVal,this.displayValue=this.formatNumber(this.printVal)||0,(o=(i=this.config).onChange)==null||o.call(i,this.displayValue),s<this.localDuration?this.rAF=this.requestAnimationFrame(this.count.bind(this)):(l=(n=this.config).onEnd)==null||l.call(n)}formatNumber(e){e=Number(e),e=e.toFixed(Number(this.config.decimals)),e+="";const s=e.split(".");let i=s[0];const o=s.length>1?this.config.decimal+s[1]:"",n=/(\d+)(\d{3})/;if(this.config.separator&&!this.isNumber(this.config.separator))for(;n.test(i);)i=i.replace(n,`$1${this.config.separator}$2`);return i+o}isNumber(e){return!isNaN(parseFloat(e))}destroy(){this.cancelAnimationFrame(this.rAF)}}const E={name:"PressCountTo",options:{...y(!0,!1),styleIsolation:"shared"},mixins:[F],emits:["change","end"],data(){return{countToInstance:null,displayValue:this.formatNumber(this.startValue)}},computed:{countToStyle(){const{customStyle:t,fontSize:e,bold:s,color:i}=this;return S([t,{fontSize:p(e),fontWeight:s?"bold":"normal",color:i}])}},watch:{startValue(){this.autoplay&&this.start()},endValue(){this.autoplay&&this.start()}},mounted(){this.initCountTo(),this.autoplay&&this.start()},beforeDestroy(){var t;(t=this.countToInstance)==null||t.destroy()},methods:{addUnit:p,getConfig(){return{startValue:this.startValue,endValue:this.endValue,duration:this.duration,autoplay:this.autoplay,decimals:this.decimals,decimal:this.decimal,separator:this.separator,useEasing:this.useEasing,onChange:t=>{this.displayValue=t,this.$emit("change",t)},onEnd:()=>{this.$emit("end")}}},formatNumber(t){t=Number(t),t=t.toFixed(Number(this.decimals)),t+="";const e=t.split(".");let s=e[0];const i=e.length>1?this.decimal+e[1]:"",o=/(\d+)(\d{3})/;if(this.separator&&!this.isNumber(this.separator))for(;o.test(s);)s=s.replace(o,`$1${this.separator}$2`);return s+i},isNumber(t){return!isNaN(parseFloat(t))},initCountTo(){this.countToInstance=new D({...this.getConfig()})},start(){var t;(t=this.countToInstance)==null||t.start(this.getConfig())},stop(){var t;(t=this.countToInstance)==null||t.stop()},reset(){var t;(t=this.countToInstance)==null||t.reset()},reStart(){var t;(t=this.countToInstance)==null||t.reStart()},resume(){var t;(t=this.countToInstance)==null||t.resume()}}},w={class:"press-count-to"};function v(t,e,s,i,o,n){return m(),d("span",w,[t.useSlot?T(t.$slots,"default",{key:0},void 0,!0):(m(),d("span",{key:1,class:"press-count-to__number",style:b(n.countToStyle)},g(o.displayValue),5))])}const A=f(E,[["render",v],["__scopeId","data-v-e53548c1"]]),k={i18n:{"zh-CN":{customStyle:"自定义样式",decimals:"小数位",separator:"千分位分隔符",duration:"自定义持续时间",animation:"禁用缓慢动画",control:"自定义控制",resume:"继续",pause:"暂停",start:"开始",countdown:"倒计时",slot:"插槽"},"en-US":{customStyle:"Custom Style",decimals:"Decimal",separator:"Separator",duration:"Duration",animation:"Animation",control:"Control",resume:"Resume",pause:"Pause",start:"Start",countdown:"Countdown",slot:"Slot"}},components:{PressCountTo:A,PressGrid:N,PressGridItem:_},data(){return{customStyle:"margin-right: 16px;",autoplay:!1,slotValue:""}},methods:{start(){this.$refs.pressCountToRef.start()},pause(){this.$refs.pressCountToRef.stop()},resume(){this.$refs.pressCountToRef.resume()},onEnd(){this.onGTip("[end]")},onChange(t){this.slotValue=t}}},I={class:"demo-wrap"},P={style:{color:"red"}};function $(t,e,s,i,o,n){const l=c("PressCountTo"),u=c("demo-block"),h=c("PressGridItem"),V=c("PressGrid");return m(),d("div",I,[a(u,{title:t.t("basicUsage")},{default:r(()=>[a(l,{"start-value":30,"end-value":500,onEnd:n.onEnd},null,8,["onEnd"])]),_:1},8,["title"]),a(u,{title:t.t("customStyle")},{default:r(()=>[a(l,{"end-value":3e3,color:"#909399","font-size":30,bold:!0})]),_:1},8,["title"]),a(u,{title:t.t("duration")},{default:r(()=>[a(l,{"start-value":30,"end-value":500,duration:5e3,onEnd:n.onEnd},null,8,["onEnd"])]),_:1},8,["title"]),a(u,{title:t.t("animation")},{default:r(()=>[a(l,{"start-value":30,"end-value":500,"use-easing":!1})]),_:1},8,["title"]),a(u,{title:t.t("countdown")},{default:r(()=>[a(l,{"start-value":500,"end-value":0})]),_:1},8,["title"]),a(u,{title:t.t("decimals")},{default:r(()=>[a(l,{"start-value":30,"end-value":500,decimals:2})]),_:1},8,["title"]),a(u,{title:t.t("separator")},{default:r(()=>[a(l,{"end-value":5e3,separator:","})]),_:1},8,["title"]),a(u,{title:t.t("slot")},{default:r(()=>[a(l,{"end-value":5e3,"use-slot":!0,onChange:n.onChange},{default:r(()=>[C("span",P,g(o.slotValue),1)]),_:1},8,["onChange"])]),_:1},8,["title"]),a(u,{title:t.t("control")},{default:r(()=>[a(l,{ref:"pressCountToRef","end-value":5e3,autoplay:o.autoplay,onEnd:n.onEnd},null,8,["autoplay","onEnd"])]),_:1},8,["title"]),a(V,{clickable:"","column-num":3},{default:r(()=>[a(h,{text:t.t("start"),icon:"play-circle-o",onClick:n.start},null,8,["text","onClick"]),a(h,{text:t.t("pause"),icon:"pause-circle-o",onClick:n.pause},null,8,["text","onClick"]),a(h,{text:t.t("resume"),icon:"replay",onClick:n.resume},null,8,["text","onClick"])]),_:1})])}const z=f(k,[["render",$]]);export{z as default};
