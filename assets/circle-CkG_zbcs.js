import{W as z,B as _}from"./color-DciZLlTH.js";import{_ as b,N as S,E as g,S as E,T as N,U as L,o as c,c as d,a,l as M,h as B,F as T,t as m,M as W,e as n,k as p,r as f,G as w}from"./index-C8vugXWi.js";function k(e){return Object.assign(e,{setStrokeStyle(t){e.strokeStyle=t},setLineWidth(t){e.lineWidth=t},setLineCap(t){e.lineCap=t},setFillStyle(t){e.fillStyle=t},setFontSize(t){e.font=String(t)},setGlobalAlpha(t){e.globalAlpha=t},setLineJoin(t){e.lineJoin=t},setTextAlign(t){e.textAlign=t},setMiterLimit(t){e.miterLimit=t},setShadow(t,r,i,s){e.shadowOffsetX=t,e.shadowOffsetY=r,e.shadowBlur=i,e.shadowColor=s},setTextBaseline(t){e.textBaseline=t},createCircularGradient(){},draw(){}})}let I=0;function x(e){return Math.min(Math.max(e,0),100)}const V=2*Math.PI,y=-Math.PI/2,C=1,U={name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:z},color:{type:null,default:_},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data(){return{hoverColor:_,id:1,isNotInUni:S()}},computed:{circleStyle(){const{size:e}=this;return`width: ${g.addUnit(e)};height: ${g.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})}}},created(){I+=1,this.id=I},mounted(){this.currentValue=this.value,this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:t}=this;if(S()){const i=window.devicePixelRatio,s=document.getElementById(this.canvasId),l=s.getContext("2d");return this.inited||(this.inited=!0,s.width=t*i,s.height=t*i,l.scale(i,i)),Promise.resolve(k(l))}if(e===""||!E()){const i=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(i)}const r=N().pixelRatio;return new Promise(i=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec(s=>{const l=s[0].node,o=l.getContext(e);this.inited||(this.inited=!0,l.width=t*r,l.height=t*r,o.scale(r,r)),i(k(o))})})},setHoverColor(){const{color:e,size:t}=this;return L(e)?this.getContext().then(r=>{const i=r.createLinearGradient(t,0,0,0);Object.keys(e).sort((s,l)=>parseFloat(s)-parseFloat(l)).map(s=>i.addColorStop(parseFloat(s)/100,e[s])),this.hoverColor=i}):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,t,r,i,s){const{strokeWidth:l,lineCap:o,clockwise:h,size:v}=this,u=v/2,P=u-l/2;e.setStrokeStyle(t),e.setLineWidth(l),e.setLineCap(o),e.beginPath(),e.arc(u,u,P,r,i,!h),e.stroke(),s&&(e.setFillStyle(s),e.fill())},renderLayerCircle(e){const{layerColor:t,fill:r}=this;this.presetCanvas(e,t,0,V,r)},renderHoverCircle(e,t){const{clockwise:r}=this,i=V*(t/100),s=r?y+i:3*Math.PI-(y+i);this.presetCanvas(e,this.hoverColor,y,s)},drawCircle(e){const{size:t}=this;this.getContext().then(r=>{r.clearRect(0,0,t,t),this.renderLayerCircle(r);const i=x(e);i!==0&&this.renderHoverCircle(r,i),r.draw()})},reRender(){const{value:e,speed:t}=this;if(t<=0||t>1e3){this.drawCircle(e);return}this.clearMockInterval(),this.currentValue=this.currentValue||0;const r=()=>{this.interval=setTimeout(()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<C?this.currentValue=e:this.currentValue<e?this.currentValue+=C:this.currentValue-=C,this.drawCircle(this.currentValue),r()):this.clearMockInterval()},1e3/t)};r()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},F={class:"press-circle-index"},G={class:"press-circle"},R=["id","type","canvas-id"],A={key:0,class:"press-circle__text"},H={key:0,class:"press-circle__text"},D={key:1,class:"press-circle__text"};function O(e,t,r,i,s,l){return c(),d("div",F,[a("div",G,[a("canvas",{id:l.canvasId,class:"press-circle__canvas",type:r.type,style:M(l.circleStyle),"canvas-id":l.canvasId},null,12,R),r.text?(c(),d(T,{key:1},[s.isNotInUni?(c(),d("div",H,m(r.text),1)):(c(),d("cover-view",D,m(r.text),1))],64)):(c(),d("div",A,[B(e.$slots,"default",{},void 0,!0)]))])])}const j=b(U,[["render",O],["__scopeId","data-v-b134d198"]]),J={i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:j,PressButton:W},data(){return{value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}},methods:{onChangeCircleValue(e){if(e==="plus"){if(this.value>=100)return;this.value+=20}else if(e==="minus"){if(this.value<=0)return;this.value-=20}}}},$={class:"demo-wrap demo-wrap--gray"},Q={class:"demo-part"},X={class:"demo-part"},Y={class:"demo-part"},q={class:"demo-part"},K={class:"demo-part"};function Z(e,t,r,i,s,l){const o=f("press-circle"),h=f("demo-block"),v=f("press-button");return c(),d("div",$,[n(h,{title:e.t("basicUsage"),"header-style":s.headerStyle,"section-style":s.sectionStyle},{default:p(()=>[n(o,{value:s.value,text:`${s.value}%`},null,8,["value","text"])]),_:1},8,["title","header-style","section-style"]),n(h,{title:e.t("customStyle"),"header-style":s.headerStyle,"section-style":s.sectionStyle},{default:p(()=>[a("div",Q,[n(o,{value:s.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),a("div",X,[n(o,{value:s.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),a("div",Y,[n(o,{value:s.value,"stroke-width":6,color:s.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),a("div",q,[n(o,{value:s.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),a("div",K,[n(o,{value:s.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),a("div",null,[n(v,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:t[0]||(t[0]=u=>l.onChangeCircleValue("plus"))},{default:p(()=>[w(m(e.t("add")),1)]),_:1}),n(v,{type:"e-sport-primary",onClick:t[1]||(t[1]=u=>l.onChangeCircleValue("minus"))},{default:p(()=>[w(m(e.t("decrease")),1)]),_:1})])]),_:1},8,["title","header-style","section-style"])])}const se=b(J,[["render",Z],["__scopeId","data-v-9cde7cae"]]);export{se as default};
