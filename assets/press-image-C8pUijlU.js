import{O as S,a6 as z,_ as I,o,c as a,a as c,l as n,d as l,Y as y,a8 as P,a9 as _,z as E,C as h,B,r as m,b as p,k as F,F as C,h as w,e as b,w as H}from"./index-DccXyPO9.js";import{P as U}from"./press-transition-JizE2nFH.js";const L={props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},width:{type:[String,Number],default:300},height:{type:[String,Number],default:225},round:{type:Boolean,default:!1},radius:{type:[String,Number],default:0},lazyLoad:{type:Boolean,default:!0},showMenuByLongpress:{type:Boolean,default:!0},loadingIcon:{type:String,default:"photo"},errorIcon:{type:String,default:"photo-fail"},showLoading:{type:Boolean,default:!0},showError:{type:Boolean,default:!0},fade:{type:Boolean,default:!0},webp:{type:Boolean,default:!1},duration:{type:[String,Number],default:500},backgroundColor:{type:String,default:"#f3f4f6"},customStyle:{type:String,default:""},transitionStyle:{type:String,default:""}}};S()&&z(["uni-image"],app);function k(e){return navigator.vendor==="Google Inc."&&e>10&&(e=Math.round(e/2)*2),e}const N={name:"Image",props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},lazyLoad:{type:[Boolean,String],default:!1},draggable:{type:Boolean,default:!1}},data(){return{originalWidth:0,originalHeight:0,originalStyle:{width:"",height:""},contentPath:""}},computed:{isVue2(){let e=!0;return e=!1,e},ratio(){return this.originalWidth&&this.originalHeight?this.originalWidth/this.originalHeight:0},style(){let e="auto",t="";const r="no-repeat";switch(this.mode){case"aspectFit":e="contain",t="center center";break;case"aspectFill":e="cover",t="center center";break;case"widthFix":case"heightFix":e="100% 100%";break;case"top":t="center top";break;case"bottom":t="center bottom";break;case"center":t="center center";break;case"left":t="left center";break;case"right":t="right center";break;case"top left":t="left top";break;case"top right":t="right top";break;case"bottom left":t="left bottom";break;case"bottom right":t="right bottom";break;default:e="100% 100%",t="0% 0%";break}return{"background-image":this.contentPath?`url("${this.contentPath}")`:"none","background-position":t,"background-size":e,"background-repeat":r}}},watch:{src(){this._loadImage()},mode(e,t){(t==="widthFix"||t==="heightFix")&&this._resetSize(),(e==="widthFix"||e==="heightFix")&&this._fixSize()},contentPath(e){!e&&this.__img&&(this.__img.remove(),delete this.__img)}},mounted(){this.originalStyle.width=this.$el.style.width||"",this.originalStyle.height=this.$el.style.height||"",this._loadImage()},beforeDestroy(){this._clearImage()},methods:{_fixSize(){if(this.ratio){const{$el:e}=this;if(this.mode==="widthFix"){const t=e.offsetWidth;t&&(e.style.height=`${k(t/this.ratio)}px`)}else if(this.mode==="heightFix"){const t=e.offsetHeight;t&&(e.style.width=`${k(t*this.ratio)}px`)}}window.dispatchEvent(new CustomEvent("updateview"))},_resetSize(){this.$el.style.width=this.originalStyle.width,this.$el.style.height=this.originalStyle.height},_resetData(){this.originalWidth=0,this.originalHeight=0,this.contentPath=""},_loadImage(){const e=this.src;if(e){this._img=this._img||new Image;const t=this._img;t.onload=r=>{this._img=null,this.originalWidth=t.width;const g=this.originalWidth;this.originalHeight=t.height;const s=this.originalHeight;this._fixSize(),this.contentPath=e,t.draggable=this.draggable,this.__img&&this.__img.remove(),this.__img=t,this.$el.appendChild(t),this.$emit("load",r,{width:g,height:s})},t.onerror=r=>{this._img=null,this._resetData(),this.$emit("error",r,{errMsg:`GET ${this.src} 404 (Not Found)`})},t.src=e}else this._clearImage(),this._resetData()},_clearImage(){const e=this._img;e&&(e.onload=null,e.onerror=null,this._img=null)}}};function T(e,t,r,g,s,i){return i.isVue2?(o(),a("uni-image",y({key:0},P(e.$listeners,!0)),[c("div",{ref:"content",style:n(i.style)},null,4),r.mode==="widthFix"||r.mode==="heightFix"?(o(),a("div",{key:0,ref:"sensor",onResize:t[0]||(t[0]=u=>i._fixSize())},null,544)):l("",!0)],16)):(o(),a("uni-image",_(y({key:1},e.$attrs)),[c("div",{ref:"content",style:n(i.style)},null,4),r.mode==="widthFix"||r.mode==="heightFix"?(o(),a("div",{key:0,ref:"sensor",onResize:t[1]||(t[1]=u=>i._fixSize())},null,544)):l("",!0)],16))}const R=I(N,[["render",T],["__scopeId","data-v-c897e2c2"]]),W={name:"PressImage",options:{virtualHost:!0,styleIsolation:"shared"},components:{PressIconPlus:E,PressTransition:U,InnerImage:R},mixins:[L],emits:["click","error","load"],data(){return{isError:!1,loading:!0,opacity:1,durationTime:this.duration,backgroundStyle:{},show:!1,isNotInUni:S()}},computed:{wrapStyle(){const e={};return e.width=h(this.width),e.height=h(this.height),e.borderRadius=this.round?"10000px":h(this.radius),e.overflow=this.radius>0?"hidden":"visible",B([{...e,...this.backgroundStyle},this.customStyle])}},watch:{src:{immediate:!0,handler(e){e?(this.isError=!1,this.loading=!0):this.isError=!0}}},mounted(){this.show=!0},methods:{addUnit:h,onClick(){this.$emit("click")},onErrorHandler(e){this.loading=!1,this.isError=!0,this.$emit("error",e)},onLoadHandler(e){this.loading=!1,this.isError=!1,this.$emit("load",e),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}}}},M=["src","mode","show-menu-by-longpress","lazy-load"];function D(e,t,r,g,s,i){const u=m("InnerImage"),f=m("PressIconPlus"),v=m("PressTransition");return o(),p(v,{mode:"fade",show:s.show,duration:e.fade?s.durationTime:0,"custom-style":`display: inline-block;${e.transitionStyle}`},{default:F(()=>[c("div",{class:"press-image",style:n(i.wrapStyle),onClick:t[2]||(t[2]=H((...d)=>i.onClick&&i.onClick(...d),["stop"]))},[s.isError?l("",!0):(o(),a(C,{key:0},[s.isNotInUni?(o(),p(u,{key:0,src:e.src,mode:e.mode,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"press-image__image",style:n({borderRadius:e.round?"10000px":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)}),onError:i.onErrorHandler,onLoad:i.onLoadHandler},null,8,["src","mode","show-menu-by-longpress","lazy-load","style","onError","onLoad"])):l("",!0),s.isNotInUni?l("",!0):(o(),a("image",{key:1,src:e.src,mode:e.mode,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"press-image__image",style:n({borderRadius:e.round?"10000px":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)}),onError:t[0]||(t[0]=(...d)=>i.onErrorHandler&&i.onErrorHandler(...d)),onLoad:t[1]||(t[1]=(...d)=>i.onLoadHandler&&i.onLoadHandler(...d))},null,44,M))],64)),e.showLoading&&s.loading?(o(),a("div",{key:1,class:"press-image__loading",style:n({borderRadius:e.round?"50%":i.addUnit(e.radius),backgroundColor:e.backgroundColor,width:i.addUnit(e.width),height:i.addUnit(e.height)})},[w(e.$slots,"loading",{},()=>[b(f,{name:e.loadingIcon,width:e.width,height:e.height},null,8,["name","width","height"])],!0)],4)):l("",!0),e.showError&&s.isError&&!s.loading?(o(),a("div",{key:2,class:"press-image__error",style:n({borderRadius:e.round?"50%":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)})},[w(e.$slots,"error",{},()=>[b(f,{name:e.errorIcon,width:e.width,height:e.height},null,8,["name","width","height"])],!0)],4)):l("",!0)],4)]),_:3},8,["show","duration","custom-style"])}const O=I(W,[["render",D],["__scopeId","data-v-c14c5803"]]);export{O as P};
