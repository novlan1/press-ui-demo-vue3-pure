import{v,x as M,Q as $,_ as w,ag as x,r as f,o as g,c as P,e as D,ah as H,y as I,ai as N,k as T,a as B,t as F,d as y}from"./index-C8vugXWi.js";import{P as S,p as _}from"./press-picker-plus-Kmh-dmsw.js";const h=(e,t)=>t,k=new Date().getFullYear();function E(e){return x(e)&&!isNaN(new Date(e).getTime())}function C(e,t,i){return Math.min(Math.max(e,t),i)}function l(e){return`00${e}`.slice(-2)}function Y(e,t){let i=0;const a=Array(e<0?0:e);for(;i<e;)a[i]=t(i),i+=1;return a}function c(e){for(e===void 0&&(e="1");isNaN(parseInt(e,10));)e=e.slice(1);return parseInt(e,10)}function b(e,t){return 32-new Date(e,t-1,32).getDate()}const j={name:"PressDatetimePicker",options:{...v,styleIsolation:"shared"},components:{PressPicker:S},props:Object.assign(Object.assign({},_),{...M,value:{type:null},filter:{type:[Function,null],default:null},type:{type:String,default:"datetime"},showToolbar:{type:Boolean,default:!0},formatter:{type:[Function,null],default:h},minDate:{type:Number,default:new Date(k-10,0,1).getTime()},maxDate:{type:Number,default:new Date(k+10,11,31).getTime()},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},immediateCheck:{type:Boolean,default:!1},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}}),emits:["input","input","cancel","confirm","input","change"],data(){return{innerValue:Date.now(),columns:[]}},watch:{value:{handler(){this.updateValue()}},type:{handler(){this.updateValue()}},minDate:{handler(){this.updateValue()}},maxDate:{handler(){this.updateValue()}},minHour:{handler(){this.updateValue()}},maxHour:{handler(){this.updateValue()}},minMinute:{handler(){this.updateValue()}},maxMinute:{handler(){this.updateValue()}}},mounted(){const e=this.correctValue(this.value);this.updateColumnValue(e).then(()=>{this.immediateCheck?this.onChange():this.$emit("input",e)})},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},set(e){return this.setData(e),new Promise(t=>$(t))},updateValue(){const e=this.correctValue(this.value),t=e===this.innerValue;this.updateColumnValue(e).then(()=>{t||this.$emit("input",e)})},getPicker(){if(this.picker==null){this.picker=this.$refs.pressPicker;const{picker:e}=this,{setColumnValues:t}=e;e.setColumnValues=(...i)=>t.apply(e,[...i,!1])}return this.picker},updateColumns(){const e=this.formatter||h,t=this.getOriginColumns().map(i=>({values:i.values.map(a=>e(i.type,a,this.innerValue))}));return this.set({columns:t})},getOriginColumns(){const{filter:e,innerValue:t}=this;return this.getRanges().map(({type:a,range:n})=>{let r=Y(n[1]-n[0]+1,s=>{const o=n[0]+s;return a==="year"?`${o}`:l(o)});return e&&(r=e(a,r,t)),{type:a,values:r}})},getRanges(){if(this.type==="time")return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:i,maxHour:a,maxMinute:n}=this.getBoundary("max",this.innerValue),{minYear:r,minDate:s,minMonth:o,minHour:u,minMinute:p}=this.getBoundary("min",this.innerValue),m=[{type:"year",range:[r,e]},{type:"month",range:[o,i]},{type:"day",range:[s,t]},{type:"hour",range:[u,a]},{type:"minute",range:[p,n]}];return this.type==="date"&&m.splice(3,2),this.type==="year-month"&&m.splice(2,3),m},correctValue(e){const t=this.type!=="time";if(t&&!E(e))e=this.minDate;else if(!t&&!e){const{minHour:i}=this;e=`${l(i)}:00`}if(!t){let[i,a]=e.split(":");return i=l(C(i,this.minHour,this.maxHour)),a=l(C(a,this.minMinute,this.maxMinute)),`${i}:${a}`}return e=Math.max(e,this.minDate),e=Math.min(e,this.maxDate),e},getBoundary(e,t){const i=new Date(t),a=new Date(this[`${e}Date`]),n=a.getFullYear();let r=1,s=1,o=0,u=0;return e==="max"&&(r=12,s=b(i.getFullYear(),i.getMonth()+1),o=23,u=59),i.getFullYear()===n&&(r=a.getMonth()+1,i.getMonth()+1===r&&(s=a.getDate(),i.getDate()===s&&(o=a.getHours(),i.getHours()===o&&(u=a.getMinutes())))),{[`${e}Year`]:n,[`${e}Month`]:r,[`${e}Date`]:s,[`${e}Hour`]:o,[`${e}Minute`]:u}},onCancel(){this.$emit("cancel")},onConfirm(){this.$emit("confirm",this.innerValue)},onChange(){let e;const t=this.getPicker(),i=this.getOriginColumns();if(this.type==="time"){const a=t.getIndexes();e=`${+i[0].values[a[0]]}:${+i[1].values[a[1]]}`}else{const n=t.getIndexes().map((O,V)=>i[V].values[O]),r=c(n[0]),s=c(n[1]),o=b(r,s);let u=c(n[2]);this.type==="year-month"&&(u=1),u=u>o?o:u;let p=0,m=0;this.type==="datetime"&&(p=c(n[3]),m=c(n[4])),e=new Date(r,s-1,u,p,m)}e=this.correctValue(e),this.updateColumnValue(e).then(()=>{this.$emit("input",e),this.$emit("change",t)})},updateColumnValue(e){let t=[];const{type:i,innerValue:a}=this,n=this.formatter||h,r=this.getPicker();if(i==="time"){const s=e.split(":");t=[n("hour",s[0],a),n("minute",s[1])]}else{const s=new Date(e);t=[n("year",`${s.getFullYear()}`,a),n("month",l(s.getMonth()+1),a)],i==="date"&&t.push(n("day",l(s.getDate()),a)),i==="datetime"&&t.push(n("day",l(s.getDate()),a),n("hour",l(s.getHours()),a),n("minute",l(s.getMinutes()),a))}return this.set({innerValue:e}).then(()=>this.updateColumns()).then(()=>r.setValues(t))}}},R={class:"press-datetime-picker-index"};function z(e,t,i,a,n,r){const s=f("press-picker");return g(),P("div",R,[D(s,{ref:"pressPicker",class:"press-datetime-picker","active-class":e.activeClass,"toolbar-class":e.toolbarClass,"column-class":e.columnClass,title:e.title,columns:n.columns,"item-height":e.itemHeight,"show-toolbar":e.showToolbar,"visible-item-count":e.visibleItemCount,"confirm-button-text":e.confirmButtonText,"cancel-button-text":e.cancelButtonText,"use-momentum":e.useMomentum,"swipe-duration":e.swipeDuration,onChange:r.onChange,onConfirm:r.onConfirm,onCancel:r.onCancel},null,8,["active-class","toolbar-class","column-class","title","columns","item-height","show-toolbar","visible-item-count","confirm-button-text","cancel-button-text","use-momentum","swipe-duration","onChange","onConfirm","onCancel"])])}const L=w(j,[["render",z],["__scopeId","data-v-afdb2208"]]);let d;const q={...H,datetimePicker:{type:Object,default:()=>({})},tip:{type:String,default:""}},A={name:"PressDatetimePickerPopup",options:{virtualHost:!0},components:{PressPopup:I,PressDatetimePicker:L},mixins:[N(q)],props:{},emits:[],data(){return{currentValue:this.getPropOrData("datetimePicker.value")}},computed:{immediateCheck(){return this.getPropOrData("datetimePicker.immediateCheck")||!0}},watch:{},created(){d=this},mounted(){},methods:{noop(){},emitEvent(e){const t={context:this,value:this.currentValue};this.$emit(e),this.promiseCallback(e,t)},confirm(){this.emitEvent("confirm")},cancel(){this.emitEvent("cancel")},onInput(e){var t;this.currentValue=e,(t=this.getPropOrData("datetimePicker.input"))==null||t(e)},timeFilter(e,t,i){const a=d.getPropOrData("datetimePicker.filter")||null;return a?a(e,t,i):t},timeFormatter(e,t,i){const a=d.getPropOrData("datetimePicker.formatter")||null;return a?a(e,t,i):t}}},Q={key:0,class:"press-datetime-picker-popup"},U={class:"press-datetime-picker-popup__picker"},Z={key:0,class:"press-datetime-picker-popup__tip"};function G(e,t,i,a,n,r){const s=f("PressDatetimePicker"),o=f("PressPopup");return e.innerShow?(g(),P("div",Q,[D(o,{"show-title":e.getPropOrData("showTitle"),"close-icon":e.getPropOrData("closeIcon"),"arrow-icon":e.getPropOrData("arrowIcon"),title:e.getPropOrData("title"),button:e.getPropOrData("button"),"border-button":e.getPropOrData("borderButton"),"z-index":e.getPropOrData("zIndex"),"popup-class":e.getPropOrData("popupClass"),"close-on-click-overlay":e.getPropOrData("closeOnClickOverlay"),"custom-style":e.getPropOrData("customStyle"),onConfirm:r.confirm,onCancel:r.cancel},{default:T(()=>[B("div",U,[D(s,{ref:"picker",value:e.getPropOrData("datetimePicker.value"),"show-toolbar":e.getPropOrData("datetimePicker.showToolbar")||!1,"item-height":e.getPropOrData("datetimePicker.itemHeight")||56,type:e.getPropOrData("datetimePicker.type")||"datetime","max-date":e.getPropOrData("datetimePicker.maxDate"),"min-date":e.getPropOrData("datetimePicker.minDate"),"immediate-check":r.immediateCheck,formatter:r.timeFormatter,filter:r.timeFilter,onInput:r.onInput},null,8,["value","show-toolbar","item-height","type","max-date","min-date","immediate-check","formatter","filter","onInput"])]),e.tip?(g(),P("div",Z,F(e.tip),1)):y("",!0)]),_:1},8,["show-title","close-icon","arrow-icon","title","button","border-button","z-index","popup-class","close-on-click-overlay","custom-style","onConfirm","onCancel"])])):y("",!0)}const W=w(A,[["render",G],["__scopeId","data-v-23395b95"]]);export{L as P,W as a,h as d};
