import{d as j,a as J}from"./press-component-Cv9kTz4A.js";import{P as Q}from"./press-loading-plus-BuhRayzR.js";import{g as N,e as tt,c as et}from"./rect-7HbQQVQ8.js";import{v as it,n as st}from"./add-unit-CSy-4COV.js";import{i as ot}from"./utils-6Uv3ickc.js";import{B as rt}from"./bind-event-_XNNESuL.js";import{P as D,p as B}from"./support-passive-CNRHRm4O.js";import{_ as z,o as y,c as S,a as f,m as T,d as L,i as M,X as lt,Y as nt,p as O,e as F,r as E,b as ht,l as k,f as P,A as at,t as V,n as $,V as ct,F as ft,y as ut}from"./index-4prF5mFA.js";import{s as dt,a as H,P as _t,F as pt}from"./helper-DFCphh7x.js";import{P as mt}from"./press-picker-BQuw-yOi.js";import{P as gt}from"./press-cell-DQI7GKjm.js";import"./style-CpIyAjCl.js";import"./system-DmiJ0d78.js";import"./event-CZpnkkJH.js";import"./press-popup-BjrRY9bM.js";import"./press-button-BNvNLjda.js";import"./press-icon-plus-BKnDNWlW.js";import"./press-info-zFc1oCW_.js";import"./press-loading-wKaN170k.js";import"./button-Dky8tJDD.js";import"./function-BV4CtTTe.js";import"./press-switch-Cy8l3HrA.js";import"./computed-jVh4moej.js";import"./functional-gQwSCE-6.js";import"./index-8SKntImH.js";import"./link-pPHzr9dz.js";const K="scrollViewId";function b(t){this._drag=t,this._dragLog=Math.log(t),this._x=0,this._v=0,this._startTime=0}b.prototype.set=function(t,e){this._x=t,this._v=e,this._startTime=new Date().getTime()};b.prototype.setVelocityByEnd=function(t){this._v=(t-this._x)*this._dragLog/(Math.pow(this._drag,100)-1)};b.prototype.x=function(t){t===void 0&&(t=(new Date().getTime()-this._startTime)/1e3);const e=t===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,t);return this._dt=t,this._x+this._v*e/this._dragLog-this._v/this._dragLog};b.prototype.dx=function(t){t===void 0&&(t=(new Date().getTime()-this._startTime)/1e3);const e=t===this._dt&&this._powDragDt?this._powDragDt:this._powDragDt=Math.pow(this._drag,t);return this._dt=t,this._v*e};b.prototype.done=function(){return Math.abs(this.dx())<3};b.prototype.reconfigure=function(t){const e=this.x(),i=this.dx();this._drag=t,this._dragLog=Math.log(t),this.set(e,i)};b.prototype.configuration=function(){const t=this;return[{label:"Friction",read(){return t._drag},write(e){t.reconfigure(e)},min:.001,max:.1,step:.001}]};function q(t,e,i){return t>e-i&&t<e+i}function w(t,e){return q(t,0,e)}function W({e:t,c:e,u:i}){let s,o;return t===this._t&&(s=this._powER1T,o=this._powER2T),this._t=t,s||(this._powER1T=Math.pow(Math.E,e*t),s=this._powER1T),o||(this._powER2T=Math.pow(Math.E,i*t),o=this._powER2T),{t:s,n:o}}function p(t,e,i){this._m=t,this._k=e,this._c=i,this._solution=null,this._endPosition=0,this._startTime=0}p.prototype._solve=function(t,e){const i=this._c,s=this._m,o=this._k,l=i*i-4*s*o;if(l===0){const n=-i/(2*s),a=t,g=e/(n*t);return{x(_){return(a+g*_)*Math.pow(Math.E,n*_)},dx(_){const v=Math.pow(Math.E,n*_);return n*(a+g*_)*v+g*v}}}if(l>0){const n=(-i-Math.sqrt(l))/(2*s),a=(-i+Math.sqrt(l))/(2*s),g=(e-n*t)/(a-n),_=t-g;return{x(v){const{t:C,n:I}=W({e:v,c:n,u:a});return _*C+g*I},dx(v){const{t:C,n:I}=W({e:v,c:n,u:a});return _*n*C+g*a*I}}}const r=Math.sqrt(4*s*o-i*i)/(2*s),h=-i/2*s,u=t,d=(e-h*t)/r;return{x(n){return Math.pow(Math.E,h*n)*(u*Math.cos(r*n)+d*Math.sin(r*n))},dx(n){const a=Math.pow(Math.E,h*n),g=Math.cos(r*n),_=Math.sin(r*n);return a*(d*r*g-u*r*_)+h*a*(d*_+u*g)}}};p.prototype.x=function(t){return t===void 0&&(t=(new Date().getTime()-this._startTime)/1e3),this._solution?this._endPosition+this._solution.x(t):0};p.prototype.dx=function(t){return t===void 0&&(t=(new Date().getTime()-this._startTime)/1e3),this._solution?this._solution.dx(t):0};p.prototype.setEnd=function(t,e,i){if(i||(i=new Date().getTime()),t!==this._endPosition||!w(e,.4)){e=e||0;let s=this._endPosition;this._solution&&(w(e,.4)&&(e=this._solution.dx((i-this._startTime)/1e3)),s=this._solution.x((i-this._startTime)/1e3),w(e,.4)&&(e=0),w(s,.4)&&(s=0),s+=this._endPosition),this._solution&&w(s-t,.4)&&w(e,.4)||(this._endPosition=t,this._solution=this._solve(s-this._endPosition,e),this._startTime=i)}};p.prototype.snap=function(t){this._startTime=new Date().getTime(),this._endPosition=t,this._solution={x(){return 0},dx(){return 0}}};p.prototype.done=function(t){return t||(t=new Date().getTime()),q(this.x(),this._endPosition,.4)&&w(this.dx(),.4)};p.prototype.reconfigure=function(t,e,i){this._m=t,this._k=e,this._c=i,this.done()||(this._solution=this._solve(this.x()-this._endPosition,this.dx()),this._startTime=new Date().getTime())};p.prototype.springConstant=function(){return this._k};p.prototype.damping=function(){return this._c};p.prototype.configuration=function(){function t(i,s){i.reconfigure(1,s,i.damping())}function e(i,s){i.reconfigure(1,i.springConstant(),s)}return[{label:"Spring Constant",read:this.springConstant.bind(this),write:t.bind(this,this),min:100,max:1e3},{label:"Damping",read:this.damping.bind(this),write:e.bind(this,this),min:1,max:500}]};function x(t,e,i){this._extent=t,this._friction=e||new b(.01),this._spring=i||new p(1,90,20),this._startTime=0,this._springing=!1,this._springOffset=0}x.prototype.snap=function(t,e){this._springOffset=0,this._springing=!0,this._spring.snap(t),this._spring.setEnd(e)};x.prototype.set=function(t,e){this._friction.set(t,e),t>0&&e>=0?(this._springOffset=0,this._springing=!0,this._spring.snap(t),this._spring.setEnd(0)):t<-this._extent&&e<=0?(this._springOffset=0,this._springing=!0,this._spring.snap(t),this._spring.setEnd(-this._extent)):this._springing=!1,this._startTime=new Date().getTime()};x.prototype.x=function(t){if(!this._startTime)return 0;if(t||(t=(new Date().getTime()-this._startTime)/1e3),this._springing)return this._spring.x()+this._springOffset;let e=this._friction.x(t);const i=this.dx(t);return(e>0&&i>=0||e<-this._extent&&i<=0)&&(this._springing=!0,this._spring.setEnd(0,i),e<-this._extent?this._springOffset=-this._extent:this._springOffset=0,e=this._spring.x()+this._springOffset),e};x.prototype.dx=function(t){let e=0;return e=this._lastTime===t?this._lastDx:this._springing?this._spring.dx(t):this._friction.dx(t),this._lastTime=t,this._lastDx=e,e};x.prototype.done=function(){return this._springing?this._spring.done():this._friction.done()};x.prototype.setVelocityByEnd=function(t){this._friction.setVelocityByEnd(t)};x.prototype.configuration=function(){const t=this._friction.configuration();return t.push.apply(t,this._spring.configuration()),t};function yt(t,e,i){function s(r,h,u,d){if(!r||!r.cancelled){u(h);const n=h.done();n||r.cancelled||(r.id=requestAnimationFrame(s.bind(null,r,h,u,d))),n&&d&&d(h)}}function o(r){r&&r.id&&cancelAnimationFrame(r.id),r&&(r.cancelled=!0)}const l={id:0,cancelled:!1};return s(l,t,e,i),{cancel:o.bind(null,l),model:t}}function m(t,e){e=e||{},this._element=t,this._options=e,this._enableSnap=e.enableSnap||!1,this._itemSize=e.itemSize||0,this._enableX=e.enableX||!1,this._enableY=e.enableY||!1,this._shouldDispatchScrollEvent=!!e.onScroll,this._enableX?(this._extent=(e.scrollWidth||this._element.offsetWidth)-this._element.parentElement.offsetWidth,this._scrollWidth=e.scrollWidth):(this._extent=(e.scrollHeight||this._element.offsetHeight)-this._element.parentElement.offsetHeight,this._scrollHeight=e.scrollHeight),this._position=0,this._scroll=new x(this._extent,e.friction,e.spring),this._onTransitionEnd=this.onTransitionEnd.bind(this),this.updatePosition()}m.prototype.onTouchStart=function(){this._startPosition=this._position,this._lastChangePos=this._startPosition,this._startPosition>0?this._startPosition/=.5:this._startPosition<-this._extent&&(this._startPosition=(this._startPosition+this._extent)/.5-this._extent),this._animation&&(this._animation.cancel(),this._scrolling=!1),this.updatePosition()};m.prototype.onTouchMove=function(t,e){let i=this._startPosition;this._enableX?i+=t:this._enableY&&(i+=e),i>0?i*=.5:i<-this._extent&&(i=.5*(i+this._extent)-this._extent),this._position=i,this.updatePosition(),this.dispatchScroll()};m.prototype.onTouchEnd=function(t,e,i){if(this._enableSnap&&this._position>-this._extent&&this._position<0){if(this._enableY&&(Math.abs(e)<this._itemSize&&Math.abs(i.y)<300||Math.abs(i.y)<150)){this.snap();return}if(this._enableX&&(Math.abs(t)<this._itemSize&&Math.abs(i.x)<300||Math.abs(i.x)<150)){this.snap();return}}this._enableX?this._scroll.set(this._position,i.x):this._enableY&&this._scroll.set(this._position,i.y);let s;if(this._enableSnap){const o=this._scroll._friction.x(100),l=o%this._itemSize;s=Math.abs(l)>this._itemSize/2?o-(this._itemSize-Math.abs(l)):o-l,s<=0&&s>=-this._extent&&this._scroll.setVelocityByEnd(s)}this._lastTime=Date.now(),this._lastDelay=0,this._scrolling=!0,this._lastChangePos=this._position,this._lastIdx=Math.floor(Math.abs(this._position/this._itemSize)),this._animation=yt(this._scroll,()=>{const o=Date.now(),l=(o-this._scroll._startTime)/1e3,r=this._scroll.x(l);this._position=r,this.updatePosition();const h=this._scroll.dx(l);this._shouldDispatchScrollEvent&&o-this._lastTime>this._lastDelay&&(this.dispatchScroll(),this._lastDelay=Math.abs(2e3/h),this._lastTime=o)},()=>{this._enableSnap&&(s<=0&&s>=-this._extent&&(this._position=s,this.updatePosition()),typeof this._options.onSnap=="function"&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize))),this._shouldDispatchScrollEvent&&this.dispatchScroll(),this._scrolling=!1})};m.prototype.onTransitionEnd=function(){this._element.style.transition="",this._element.style.webkitTransition="",this._element.removeEventListener("transitionend",this._onTransitionEnd),this._element.removeEventListener("webkitTransitionEnd",this._onTransitionEnd),this._snapping&&(this._snapping=!1),this.dispatchScroll()};m.prototype.snap=function(){const t=this._itemSize,e=this._position%t,i=Math.abs(e)>this._itemSize/2?this._position-(t-Math.abs(e)):this._position-e;this._position!==i&&(this._snapping=!0,this.scrollTo(-i),typeof this._options.onSnap=="function"&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize)))};m.prototype.scrollTo=function(t,e){this._animation&&(this._animation.cancel(),this._scrolling=!1),typeof t=="number"&&(this._position=-t),this._position<-this._extent?this._position=-this._extent:this._position>0&&(this._position=0),this._element.style.transition=`transform ${e||.2}s ease-out`,this._element.style.webkitTransition=`-webkit-transform ${e||.2}s ease-out`,this.updatePosition(),this._element.addEventListener("transitionend",this._onTransitionEnd),this._element.addEventListener("webkitTransitionEnd",this._onTransitionEnd)};m.prototype.dispatchScroll=function(){if(typeof this._options.onScroll=="function"&&Math.round(this._lastPos)!==Math.round(this._position)){this._lastPos=this._position;const t={target:{scrollLeft:this._enableX?-this._position:0,scrollTop:this._enableY?-this._position:0,scrollHeight:this._scrollHeight||this._element.offsetHeight,scrollWidth:this._scrollWidth||this._element.offsetWidth,offsetHeight:this._element.parentElement.offsetHeight,offsetWidth:this._element.parentElement.offsetWidth}};this._options.onScroll(t)}};m.prototype.update=function(t,e,i){let s=0;const o=this._position;this._enableX?(s=this._element.childNodes.length?(e||this._element.offsetWidth)-this._element.parentElement.offsetWidth:0,this._scrollWidth=e):(s=this._element.childNodes.length?(e||this._element.offsetHeight)-this._element.parentElement.offsetHeight:0,this._scrollHeight=e),typeof t=="number"&&(this._position=-t),this._position<-s?this._position=-s:this._position>0&&(this._position=0),this._itemSize=i||this._itemSize,this.updatePosition(),o!==this._position&&(this.dispatchScroll(),typeof this._options.onSnap=="function"&&this._options.onSnap(Math.floor(Math.abs(this._position)/this._itemSize))),this._extent=s,this._scroll._extent=s};m.prototype.updatePosition=function(){let t="";this._enableX?t=`translateX(${this._position}px) translateZ(0)`:this._enableY&&(t=`translateY(${this._position}px) translateZ(0)`),this._element.style.webkitTransform=t,this._element.style.transform=t};m.prototype.isScrolling=function(){return this._scrolling||this._snapping};const St={methods:{initScroller(t,e){this._touchInfo={trackingID:-1,maxDy:0,maxDx:0},this._scroller=new m(t,e),this.__handleTouchStart=this._handleTouchStart.bind(this),this.__handleTouchMove=this._handleTouchMove.bind(this),this.__handleTouchEnd=this._handleTouchEnd.bind(this),this._initedScroller=!0},_findDelta(t){const e=this._touchInfo;return t.detail.state==="move"||t.detail.state==="end"?{x:t.detail.dx,y:t.detail.dy}:{x:t.screenX-e.x,y:t.screenY-e.y}},_handleTouchStart(t){const e=this._touchInfo,i=this._scroller;i&&(t.detail.state==="start"?(e.trackingID="touch",e.x=t.detail.x,e.y=t.detail.y):(e.trackingID="mouse",e.x=t.screenX,e.y=t.screenY),e.maxDx=0,e.maxDy=0,e.historyX=[0],e.historyY=[0],e.historyTime=[t.detail.timeStamp],e.listener=i,i.onTouchStart&&i.onTouchStart(),t.preventDefault())},_handleTouchMove(t){const e=this._touchInfo;if(e.trackingID!==-1){t.preventDefault();const i=this._findDelta(t);if(i){for(e.maxDy=Math.max(e.maxDy,Math.abs(i.y)),e.maxDx=Math.max(e.maxDx,Math.abs(i.x)),e.historyX.push(i.x),e.historyY.push(i.y),e.historyTime.push(t.detail.timeStamp);e.historyTime.length>10;)e.historyTime.shift(),e.historyX.shift(),e.historyY.shift();e.listener&&e.listener.onTouchMove&&e.listener.onTouchMove(i.x,i.y,t.detail.timeStamp)}}},_handleTouchEnd(t){const e=this._touchInfo;if(e.trackingID!==-1){t.preventDefault();const i=this._findDelta(t);if(i){const{listener:s}=e;e.trackingID=-1,e.listener=null;const o=e.historyTime.length,l={x:0,y:0};if(o>2)for(let r=e.historyTime.length-1,h=e.historyTime[r],u=e.historyX[r],d=e.historyY[r];r>0;){r-=1;const n=e.historyTime[r],a=h-n;if(a>30&&a<50){l.x=(u-e.historyX[r])/(a/1e3),l.y=(d-e.historyY[r])/(a/1e3);break}}e.historyTime=[],e.historyX=[],e.historyY=[],s&&s.onTouchEnd&&s.onTouchEnd(i.x,i.y,l)}}}}},Tt={name:"ScrollView",mixins:[St],props:{scrollX:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},upperThreshold:{type:[Number,String],default:50},lowerThreshold:{type:[Number,String],default:50},scrollTop:{type:[Number,String],default:0},scrollLeft:{type:[Number,String],default:0},scrollIntoView:{type:String,default:""},scrollWithAnimation:{type:[Boolean,String],default:!1},enableBackToTop:{type:[Boolean,String],default:!1},refresherEnabled:{type:[Boolean,String],default:!1},refresherThreshold:{type:Number,default:45},refresherDefaultStyle:{type:String,default:"back"},refresherBackground:{type:String,default:"#fff"},refresherTriggered:{type:[Boolean,String],default:!1}},emits:["update:refresherTriggered","scroll","scrolltoupper","scrolltolower","refresherpulling","refresherrefresh","refresherabort","refresherrestore"],data(){return{lastScrollTop:Number(this.scrollTop)||0,lastScrollLeft:Number(this.scrollLeft)||0,lastScrollToUpperTime:0,lastScrollToLowerTime:0,refresherHeight:0,refreshRotate:0,refreshState:""}},computed:{upperThresholdNumber(){const t=Number(this.upperThreshold);return isNaN(t)?50:t},lowerThresholdNumber(){const t=Number(this.lowerThreshold);return isNaN(t)?50:t},scrollTopNumber(){return Number(this.scrollTop)||0},scrollLeftNumber(){return Number(this.scrollLeft)||0}},watch:{scrollTopNumber(t){this._scrollTopChanged(t)},scrollLeftNumber(t){this._scrollLeftChanged(t)},scrollIntoView(t){this._scrollIntoViewChanged(t)},refresherTriggered(t){t===!0?this._setRefreshState("refreshing"):t===!1&&this._setRefreshState("restore")}},mounted(){const t=this;let e=null,i=null;this._attached=!0,this.toUpperNumber=0,this.triggerAbort=!1,this.beforeRefreshing=!1,this._scrollTopChanged(this.scrollTopNumber),this._scrollLeftChanged(this.scrollLeftNumber),this._scrollIntoViewChanged(this.scrollIntoView),this.__handleScroll=function(s){s.preventDefault(),s.stopPropagation(),t._handleScroll.bind(t,s)()},this.__handleTouchMove=function(s){if(e===null)return;const o=s.touches[0].pageX,l=s.touches[0].pageY,{main:r}=t.$refs;if(Math.abs(o-e.x)>Math.abs(l-e.y))if(t.scrollX){if(r.scrollLeft===0&&o>e.x){i=!1;return}if(r.scrollWidth===r.offsetWidth+r.scrollLeft&&o<e.x){i=!1;return}i=!0}else i=!1;else if(t.scrollY)if(r.scrollTop===0&&l>e.y)i=!1,t.refresherEnabled&&s.cancelable!==!1&&s.preventDefault();else if(r.scrollHeight===r.offsetHeight+r.scrollTop&&l<e.y){i=!1;return}else i=!0;else i=!1;if(i&&s.stopPropagation(),r.scrollTop===0&&s.touches.length===1&&(t.refreshState="pulling"),t.refresherEnabled&&t.refreshState==="pulling"){const h=l-e.y;t.toUpperNumber===0&&(t.toUpperNumber=l),t.beforeRefreshing?(t.refresherHeight=h+t.refresherThreshold,t.triggerAbort=!1):(t.refresherHeight=l-t.toUpperNumber,t.refresherHeight>0&&(t.triggerAbort=!0,t.$trigger("refresherpulling",s,{deltaY:h})));const u=t.refresherHeight/t.refresherThreshold;t.refreshRotate=(u>1?1:u)*360}},this.__handleTouchStart=function(s){s.touches.length===1&&(e={x:s.touches[0].pageX,y:s.touches[0].pageY})},this.__handleTouchEnd=function(){e=null,t.refresherHeight>=t.refresherThreshold?t._setRefreshState("refreshing"):t._setRefreshState("refresherabort")},this.$refs.main.addEventListener("touchstart",this.__handleTouchStart,D),this.$refs.main.addEventListener("touchmove",this.__handleTouchMove,B(!1)),this.$refs.main.addEventListener("scroll",this.__handleScroll,B(!1)),this.$refs.main.addEventListener("touchend",this.__handleTouchEnd,D)},activated(){this.scrollY&&(this.$refs.main.scrollTop=this.lastScrollTop),this.scrollX&&(this.$refs.main.scrollLeft=this.lastScrollLeft)},beforeDestroy(){this.$refs.main.removeEventListener("touchstart",this.__handleTouchStart,D),this.$refs.main.removeEventListener("touchmove",this.__handleTouchMove,D),this.$refs.main.removeEventListener("scroll",this.__handleScroll,B(!1)),this.$refs.main.removeEventListener("touchend",this.__handleTouchEnd,D)},methods:{$trigger(t,e){this.$emit(t,e)},scrollTo(t,e){const i=this.$refs.main;t<0?t=0:e==="x"&&t>i.scrollWidth-i.offsetWidth?t=i.scrollWidth-i.offsetWidth:e==="y"&&t>i.scrollHeight-i.offsetHeight&&(t=i.scrollHeight-i.offsetHeight);let s=0,o="";e==="x"?s=i.scrollLeft-t:e==="y"&&(s=i.scrollTop-t),s!==0&&(this.$refs.content.style.transition="transform .3s ease-out",this.$refs.content.style.webkitTransition="-webkit-transform .3s ease-out",e==="x"?o=`translateX(${s}px) translateZ(0)`:e==="y"&&(o=`translateY(${s}px) translateZ(0)`),this.$refs.content.removeEventListener("transitionend",this.__transitionEnd),this.$refs.content.removeEventListener("webkitTransitionEnd",this.__transitionEnd),this.__transitionEnd=this._transitionEnd.bind(this,t,e),this.$refs.content.addEventListener("transitionend",this.__transitionEnd),this.$refs.content.addEventListener("webkitTransitionEnd",this.__transitionEnd),e==="x"?i.style.overflowX="hidden":e==="y"&&(i.style.overflowY="hidden"),this.$refs.content.style.transform=o,this.$refs.content.style.webkitTransform=o)},_handleTrack(t){if(t.detail.state==="start"){this._x=t.detail.x,this._y=t.detail.y,this._noBubble=null;return}t.detail.state==="end"&&(this._noBubble=!1),this._noBubble===null&&this.scrollY&&(Math.abs(this._y-t.detail.y)/Math.abs(this._x-t.detail.x)>1?this._noBubble=!0:this._noBubble=!1),this._noBubble===null&&this.scrollX&&(Math.abs(this._x-t.detail.x)/Math.abs(this._y-t.detail.y)>1?this._noBubble=!0:this._noBubble=!1),this._x=t.detail.x,this._y=t.detail.y,this._noBubble&&t.stopPropagation()},_handleScroll(t){const{target:e}=t;this.$trigger("scroll",t,{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,deltaX:this.lastScrollLeft-e.scrollLeft,deltaY:this.lastScrollTop-e.scrollTop}),this.scrollY&&(e.scrollTop<=this.upperThresholdNumber&&this.lastScrollTop-e.scrollTop>0&&t.timeStamp-this.lastScrollToUpperTime>200&&(this.$trigger("scrolltoupper",t,{direction:"top"}),this.lastScrollToUpperTime=t.timeStamp),e.scrollTop+e.offsetHeight+this.lowerThresholdNumber>=e.scrollHeight&&this.lastScrollTop-e.scrollTop<0&&t.timeStamp-this.lastScrollToLowerTime>200&&(this.$trigger("scrolltolower",t,{direction:"bottom"}),this.lastScrollToLowerTime=t.timeStamp)),this.scrollX&&(e.scrollLeft<=this.upperThresholdNumber&&this.lastScrollLeft-e.scrollLeft>0&&t.timeStamp-this.lastScrollToUpperTime>200&&(this.$trigger("scrolltoupper",t,{direction:"left"}),this.lastScrollToUpperTime=t.timeStamp),e.scrollLeft+e.offsetWidth+this.lowerThresholdNumber>=e.scrollWidth&&this.lastScrollLeft-e.scrollLeft<0&&t.timeStamp-this.lastScrollToLowerTime>200&&(this.$trigger("scrolltolower",t,{direction:"right"}),this.lastScrollToLowerTime=t.timeStamp)),this.lastScrollTop=e.scrollTop,this.lastScrollLeft=e.scrollLeft},_scrollTopChanged(t){this.scrollY&&(this._innerSetScrollTop?this._innerSetScrollTop=!1:this.scrollWithAnimation?this.scrollTo(t,"y"):this.$refs.main.scrollTop=t)},_scrollLeftChanged(t){this.scrollX&&(this._innerSetScrollLeft?this._innerSetScrollLeft=!1:this.scrollWithAnimation?this.scrollTo(t,"x"):this.$refs.main.scrollLeft=t)},_scrollIntoViewChanged(t){if(t){if(!/^[_a-zA-Z][-_a-zA-Z0-9:]*$/.test(t)){console.error(`id error: scroll-into-view=${t}`);return}const e=this.$el.querySelector(`#${t}`);if(e){const i=this.$refs.main.getBoundingClientRect(),s=e.getBoundingClientRect();if(this.scrollX){const o=s.left-i.left,{scrollLeft:l}=this.$refs.main,r=l+o;this.scrollWithAnimation?this.scrollTo(r,"x"):this.$refs.main.scrollLeft=r}if(this.scrollY){const o=s.top-i.top,{scrollTop:l}=this.$refs.main,r=l+o;this.scrollWithAnimation?this.scrollTo(r,"y"):this.$refs.main.scrollTop=r}}}},_transitionEnd(t,e){this.$refs.content.style.transition="",this.$refs.content.style.webkitTransition="",this.$refs.content.style.transform="",this.$refs.content.style.webkitTransform="";const{main:i}=this.$refs;e==="x"?(i.style.overflowX=this.scrollX?"auto":"hidden",i.scrollLeft=t):e==="y"&&(i.style.overflowY=this.scrollY?"auto":"hidden",i.scrollTop=t),this.$refs.content.removeEventListener("transitionend",this.__transitionEnd),this.$refs.content.removeEventListener("webkitTransitionEnd",this.__transitionEnd)},_setRefreshState(t){switch(t){case"refreshing":this.refresherHeight=this.refresherThreshold,this.beforeRefreshing||(this.beforeRefreshing=!0,this.$trigger("refresherrefresh",{},{}));break;case"restore":case"refresherabort":this.beforeRefreshing=!1,this.refresherHeight=0,this.toUpperNumber=0,t==="restore"&&(this.triggerAbort=!1,this.$trigger("refresherrestore",{},{})),t==="refresherabort"&&this.triggerAbort&&(this.triggerAbort=!1,this.$trigger("refresherabort",{},{}));break}this.refreshState=t},getScrollPosition(){const{main:t}=this.$refs;return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,scrollHeight:t.scrollHeight,scrollWidth:t.scrollWidth}}}},Y=t=>(O("data-v-083b4e17"),t=t(),F(),t),bt={ref:"wrap",class:"uni-scroll-view"},xt={ref:"content",class:"uni-scroll-view-content"},wt={key:0,class:"uni-scroll-view-refresh"},Lt={class:"uni-scroll-view-refresh-inner"},Et=Y(()=>f("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},null,-1)),vt=Y(()=>f("path",{d:"M0 0h24v24H0z",fill:"none"},null,-1)),Pt=[Et,vt],Dt={key:"refresh__spinner",class:"uni-scroll-view-refresh__spinner",width:"24",height:"24",viewBox:"25 25 50 50"},Mt=Y(()=>f("circle",{cx:"50",cy:"50",r:"20",fill:"none",style:{color:"#2bd009"},"stroke-width":"3"},null,-1)),kt=[Mt];function Ct(t,e,i,s,o,l){return y(),S("uni-scroll-view",lt(nt(t.$attrs)),[f("div",bt,[f("div",{ref:"main",style:T({"overflow-x":i.scrollX?"auto":"hidden","overflow-y":i.scrollY?"auto":"hidden"}),class:"uni-scroll-view"},[f("div",xt,[i.refresherEnabled?(y(),S("div",{key:0,ref:"refresherinner",style:T({"background-color":i.refresherBackground,height:o.refresherHeight+"px"}),class:"uni-scroll-view-refresher"},[i.refresherDefaultStyle!=="none"?(y(),S("div",wt,[f("div",Lt,[o.refreshState=="pulling"?(y(),S("svg",{key:"refresh__icon",style:T({transform:"rotate("+o.refreshRotate+"deg)"}),fill:"#2BD009",class:"uni-scroll-view-refresh__icon",width:"24",height:"24",viewBox:"0 0 24 24"},Pt,4)):L("",!0),o.refreshState=="refreshing"?(y(),S("svg",Dt,kt)):L("",!0)])])):L("",!0),i.refresherDefaultStyle=="none"?M(t.$slots,"refresher",{key:1},void 0,!0):L("",!0)],4)):L("",!0),M(t.$slots,"default",{},void 0,!0)],512)],4)],512)],16)}const It=z(Tt,[["render",Ct],["__scopeId","data-v-083b4e17"]]),X=tt(K);let Z={};ot()&&(Z={ScrollView:It});const Nt={name:"PressList",options:{...j},components:{PressLoadingPlus:Q,...Z},mixins:[it,rt(function(t){this.autoCheckScroller&&(this.scroller||(this.scroller=et(this.$el)),t(this.scroller,"scroll",this.onScroll,!0),t(this.scroller,"touchmove",this.onScroll,!0),this.onScroll())})],props:{offset:{type:[Number,String],default:50},finished:{type:Boolean,default:!1},finishedText:{type:String,default:""},loadingText:{type:String,default:"加载中..."},immediateCheck:{type:Boolean,default:!0},enableFlex:{type:Boolean,default:!1},enhanced:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},enablePassive:{type:Boolean,default:!1},scrollAnchoring:{type:Boolean,default:!1},scrollToElementById:{type:String,default:""},vertical:{type:Boolean,default:!0},loadingStyle:{type:String,default:""},loadingSize:{type:String,default:"20px"},finishedStyle:{type:String,default:""},autoCheckScroller:{type:Boolean,default:!1},scrollLeft:{type:[Number,String],default:0},scrollTop:{type:[Number,String],default:0},...J,customStyle:{type:String,default:""}},emits:["scroll","input","load","update:modelValue"],data(){return{innerLoading:this.realModelValue,SCROLL_VIEW_ID:K,scrollerHeight:0}},computed:{scrollViewClass(){return["press-list",this.vertical?"press-list--vertical":"press-list--hor",this.customClass].join(" ")},scrollViewStyle(){return`height: 100%; ${this.customStyle};`}},watch:{realModelValue:{handler(t){this.innerLoading=t,this.check()}},finished:"check"},mounted(){this.immediateCheck&&this.check()},updated(){},methods:{getScrollerHeight(){this.scrollerHeight||N(this,X).then(t=>{this.scrollerHeight=t.height})},scroll(t){this.getScrollerHeight(),this.$emit("scroll",t,this.scrollerHeight),this.check()},scrollToLower(){this.emitInput()},emitInput(){this.innerLoading||this.finished||(this.innerLoading=!0,this.emitModelValue(!0),this.$emit("load"))},check(){st(()=>{this.innerCheck()})},innerCheck(){if(!this.autoCheckScroller){this.commonCheck();return}},commonCheck(t){const{offset:e}=this;this.innerLoading||this.finished||Promise.all([N(this,".press-list__placeholder"),N(this,X)]).then(i=>{const{0:s,1:o}=i;if(t===void 0&&(t=o),this.innerLoading||this.finished||!(t.bottom-t.top))return;let r=s.bottom-t.bottom;this.vertical||(r=s.right-t.right),r<=e&&this.emitInput()}).catch(()=>{}).finally(()=>{})},onScroll(){const{scroller:t,autoCheckScroller:e}=this;if(!e)return;let i;t!=null&&t.getBoundingClientRect&&(i=t.getBoundingClientRect()),this.commonCheck(i)}}},Bt=t=>(O("data-v-32ecab3e"),t=t(),F(),t),Ht={class:"press-list__layout"},At=Bt(()=>f("div",{class:"press-list__placeholder"},null,-1));function Vt(t,e,i,s,o,l){const r=E("PressLoadingPlus"),h=E("scroll-view");return y(),ht(h,{id:o.SCROLL_VIEW_ID,style:T(l.scrollViewStyle),"scroll-y":i.vertical,"scroll-x":!i.vertical,"scroll-with-animation":i.scrollWithAnimation,"scroll-anchoring":i.scrollAnchoring,enhanced:i.enhanced,"enable-flex":i.enableFlex,"enable-passive":i.enablePassive,"lower-threshold":i.offset,"scroll-into-view":i.scrollToElementById,class:$(l.scrollViewClass),"scroll-top":i.scrollTop,"scroll-left":i.scrollLeft,onScrolltolower:l.scrollToLower,onScroll:l.scroll},{default:k(()=>[f("div",Ht,[M(t.$slots,"default",{},void 0,!0),o.innerLoading?M(t.$slots,"loading",{key:0},()=>[f("div",{class:"press-list__loading",style:T(i.loadingStyle)},[P(r,{vertical:!i.vertical,size:i.loadingSize},{default:k(()=>[at(V(i.loadingText),1)]),_:1},8,["vertical","size"])],4)],!0):L("",!0),i.finishedText&&i.finished?M(t.$slots,"finished",{key:1},()=>[f("div",{class:"press-list__finished",style:T(i.finishedStyle)},[f("div",null,V(i.finishedText),1)],4)],!0):L("",!0),At])]),_:3},8,["id","style","scroll-y","scroll-x","scroll-with-animation","scroll-anchoring","enhanced","enable-flex","enable-passive","lower-threshold","scroll-into-view","class","scroll-top","scroll-left","onScrolltolower","onScroll"])}const Rt=z(Nt,[["render",Vt],["__scopeId","data-v-32ecab3e"]]),c={pageSize:20,total:300,delay:200,vertical:!0,autoCheckScroller:!0},R=Array.from({length:5}).map((t,e)=>10**e).reduce((t,e)=>{for(let i=1;i<10;i++)t.push(e*i);return t},[]).map(t=>({label:t,value:t})),U=R.reduce((t,e)=>(t[e.value]=e.label,t),{}),G=Array.from({length:1e3}).map((t,e)=>({label:`${(e+1)*100}ms`,value:(e+1)*100})),zt=G.reduce((t,e)=>(t[e.value]=e.label,t),{});function Yt({context:t,callback:e}){dt({context:t,title:"自定义设置",closeIcon:!0,cellList:[{label:"每次加载数量",value:U[c.pageSize],click:({context:i})=>{i.closeDialog(),H({title:"每次加载数量",closeIcon:!0,list:R,current:{value:c.pageSize},context:t}).then(({item:s})=>{c.pageSize=s.value,t.onGTip("设置成功"),typeof e.changePageSize=="function"&&e.changePageSize.call(t,s.value)}).catch(()=>{})}},{label:"列表总数",value:U[c.total],click:({context:i})=>{i.closeDialog(),H({title:"列表总数",closeIcon:!0,list:R,current:{value:c.total},context:t}).then(({item:s})=>{c.total=s.value,t.onGTip("设置成功"),typeof e.changeTotal=="function"&&e.changeTotal.call(t,s.value)}).catch(()=>{})}},{label:"数据请求时间",value:zt[c.delay],click:({context:i})=>{i.closeDialog(),H({title:"数据请求时间",closeIcon:!0,list:G,current:{value:c.delay},context:t}).then(({item:s})=>{c.delay=s.value,t.onGTip("设置成功"),typeof e.changeDelay=="function"&&e.changeDelay.call(t,s.value)}).catch(()=>{})}},{label:"是否竖向滚动",type:"switch",open:c.vertical,click:({context:i})=>{i.closeDialog(),c.vertical=!c.vertical,t.onGTip("设置成功"),typeof e.changeDirection=="function"&&e.changeDirection.call(t,c.vertical)}},{label:"自动检测 Scroller",type:"switch",open:c.autoCheckScroller,click:({context:i})=>{i.closeDialog(),c.autoCheckScroller=!c.autoCheckScroller,typeof e.changeAutoCheckScroller=="function"&&e.changeAutoCheckScroller.call(t,c.autoCheckScroller)}}]})}const A=50,Wt=500,Xt=(t=Wt)=>({data(){return{currentIndex:0,useVirtualList:!0}},computed:{upMissed(){const{currentIndex:e}=this;return Math.max(0,e-t)},showingData(){const{currentIndex:e,upMissed:i,list:s,useVirtualList:o}=this;return o?s.slice(i,e+t).map((l,r)=>({...l,uniqueKey:r+i})):s},hiddenUpPartStyle(){const{upMissed:e,useVirtualList:i}=this;return i?`height: ${e*A}px;`:""},wrapStyle(){const{list:e,useVirtualList:i}=this;return i?`height: ${e.length*A}px;`:""}},methods:{updateCurrentIndex(e,i){const{scrollTop:s,scrollHeight:o}=ct(e);if(s<0||i+s>o)return;const l=Math.round(s/A);this.currentIndex=l}}});function Ut({length:t,delay:e,beforeLength:i}){return new Promise(s=>{setTimeout(()=>{s({data:Array.from({length:t}).map((o,l)=>{let r=l+i+1;return r<10&&(r=`0${r}`),{label:r,value:r}})})},e||0)})}const Ot={i18n:{"zh-CN":{custom:"自定义"},"en-US":{custom:"Custom"}},components:{PressList:Rt,PressPopupCell:_t,PressPicker:mt,PressCell:gt},mixins:[Xt()],data(){const t={...c};return{sectionStyle:"margin: 0;background: #f7f8fa;",headerStyle:"background: #f7f8fa;",loading:!1,finished:!1,immediateCheck:!0,list:[],FUNCTIONAL_ID_MAP:pt,listLocal:t,listStyle:""}},computed:{},watch:{listLocal:{handler(t){t.vertical||(this.useVirtualList=!1)},deep:!0}},mounted(){},methods:{load(){console.log("[load]"),this.onFetchData()},scroll(t,e){this.updateCurrentIndex(t,e)},onFetchData(t){var o;const{total:e,pageSize:i,delay:s}=this.listLocal;Ut({delay:s,length:i,beforeLength:t?0:((o=this.list)==null?void 0:o.length)||0}).then(({data:l})=>{let r=t?l:[...this.list,...l];r.length>e&&(r=r.slice(0,e)),this.list=r,console.log("[current total]",r.length),this.loading=!1,this.finished=this.list.length>=e}).catch(()=>{})},onShowBasicPopupCell(){Yt({context:this,callback:{changeTotal:this.changeTotal,changePageSize:this.changePageSize,changeDelay:this.changeDelay,changeDirection:this.changeDirection,changeAutoCheckScroller:this.changeAutoCheckScroller}})},changePageSize(t){this.listLocal={...this.listLocal,pageSize:t},this.generateData()},changeTotal(t){this.listLocal={...this.listLocal,total:t},this.generateData()},changeDelay(t){this.listLocal={...this.listLocal,delay:t},this.generateData()},changeDirection(t){this.listLocal={...this.listLocal,vertical:t},this.generateData()},changeAutoCheckScroller(t){this.listLocal={...this.listLocal,autoCheckScroller:t},this.list=[],this.generateData()},generateData(){this.loading=!0,this.onFetchData(!0)}}},Ft={class:"demo-container"};function $t(t,e,i,s,o,l){const r=E("press-cell"),h=E("demo-block"),u=E("PressList"),d=E("PressPopupCell"),n=E("PressPicker");return y(),S("div",{class:$(["demo-wrap demo-wrap--gray demo-wrap--flex",o.listLocal.vertical?"":"demo-wrap--hor"])},[P(h,{title:t.t("basicUsage"),"section-style":o.sectionStyle,"header-style":o.headerStyle},{default:k(()=>[P(r,{title:t.t("custom"),"is-link":"",onClick:l.onShowBasicPopupCell},null,8,["title","onClick"])]),_:1},8,["title","section-style","header-style"]),f("div",Ft,[P(u,{modelValue:o.loading,"onUpdate:modelValue":e[0]||(e[0]=a=>o.loading=a),finished:o.finished,"immediate-check":o.immediateCheck,vertical:o.listLocal.vertical,"finished-text":"没有更多了","auto-check-scroller":o.listLocal.autoCheckScroller,"custom-style":o.listStyle,onLoad:l.load,onScroll:l.scroll},{default:k(()=>[f("div",{style:T(t.wrapStyle),class:"list__wrap"},[f("div",{style:T(t.hiddenUpPartStyle)},null,4),(y(!0),S(ft,null,ut(t.showingData,a=>(y(),S("div",{key:a.value,class:"list__item"},V(a.label),1))),128))],4)]),_:1},8,["modelValue","finished","immediate-check","vertical","auto-check-scroller","custom-style","onLoad","onScroll"])]),P(d,{id:o.FUNCTIONAL_ID_MAP.POPUP_CELL,ref:o.FUNCTIONAL_ID_MAP.POPUP_CELL,mode:"functional"},null,8,["id"]),P(n,{id:o.FUNCTIONAL_ID_MAP.PICKER,ref:o.FUNCTIONAL_ID_MAP.PICKER,mode:"functional"},null,8,["id"])],2)}const Se=z(Ot,[["render",$t],["__scopeId","data-v-d2486478"]]);export{Se as default};
