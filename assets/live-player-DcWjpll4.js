import{_ as y,o as i,c as n,a as o,w as p,d,t as u,u as v,p as I,e as k,r as c,f as h,ab as b,R as M,n as f}from"./index-BZexHo5h.js";import{a as E}from"./loader-DBQ4z0vx.js";import{P as T}from"./press-field-DyWd8cng.js";import{P as F}from"./press-button-DeHHH_6o.js";import"./little-loader-BcSYYlxs.js";import"./press-cell-j69wMGN4.js";import"./press-icon-plus-5Xj-bw2h.js";import"./utils-Do31p4kb.js";import"./add-unit-Df5pRFBE.js";import"./press-info-BWsAQQHi.js";import"./press-component-HD2axD72.js";import"./validator-OjQp2SYe.js";import"./link-Ds6ljOst.js";import"./event-Dm-SpHU4.js";import"./support-passive-CNRHRm4O.js";import"./press-loading-plus-Df-tLDhD.js";import"./press-loading-wkUvB1Ib.js";import"./button-BaKXjqxg.js";import"./system-BAdrsxg_.js";const L={options:{virtualHost:!0},props:{errMessage:{type:String,default:"很抱歉因系统原因，本场比赛无法启动直播"},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isShowPlayIcon:{type:Boolean,default:!1},reloadInterval:{type:Number,default:5},retryTimeout:{type:Number,default:300},showFeedbackIcon:{type:Boolean,default:!1},showGoOtherMatch:{type:Boolean,default:!0}},emits:["clickFeedbackIcon","goOtherMatch","reloadPlayer","startPlay"],data(){return{isTryFailed:!1,timeout:this.retryTimeout,intervalT:null}},watch:{isError:{handler(e){if(e){if(this.intervalT)return;if(this.retryTimeout<=0){this.stopTimer();return}const t=this.reloadInterval||5;this.intervalT=setInterval(()=>{this.timeout-=1,this.timeout%t===0&&this.$emit("reloadPlayer"),this.timeout<=0&&this.stopTimer()},1e3)}else this.intervalT&&(this.timeout=this.retryTimeout,this.isTryFailed=!1,clearInterval(this.intervalT),this.intervalT=null)},immediate:!0}},methods:{stopTimer(){clearInterval(this.intervalT),this.intervalT=null,this.isTryFailed=!0}}},m=e=>(I("data-v-e757e634"),e=e(),k(),e),V={key:0,class:"press-msg"},O={key:0,class:"press-msg__error"},B={class:"press-msg__top-bar"},R=m(()=>o("div",null,null,-1)),G=m(()=>o("img",{class:"press-msg__feedback-img",src:"https://res.edata.qq.com/nestim/ua-images/feedback.png"},null,-1)),$=[G],q={class:"press-msg__connect-failed"},H={class:"press-msg__connect-failed-msg"},N={key:0,class:"press-msg__other-match"},z=m(()=>o("img",{class:"press-msg__other-match-img",src:"https://res.edata.qq.com/nestim/ua-images/arrow-right.png"},null,-1)),A=[z],W={key:1,class:"press-msg__loading"},D=m(()=>o("img",{class:"press-msg__loading-img",src:"https://res.edata.qq.com/nestim/images/loading.gif"},null,-1)),j={class:"press-msg__loading-text"},x={key:0,class:"press-msg__loading-time"},J={key:2,class:"press-msg__play-msg"};function X(e,t,s,g,r,a){return s.isShowPlayIcon||s.isLoading||s.isError?(i(),n("div",V,[s.isError&&r.isTryFailed?(i(),n("div",O,[o("div",B,[R,s.showFeedbackIcon?(i(),n("div",{key:0,class:"press-msg__feedback-img-wrap",onClick:t[0]||(t[0]=p(l=>e.$emit("clickFeedbackIcon"),["stop"]))},$)):d("",!0)]),o("div",q,[o("div",H,u(s.errMessage||"播放失败"),1),s.showGoOtherMatch?(i(),n("div",N,[o("div",{class:"press-msg__other-match-text",onClick:t[1]||(t[1]=p(l=>e.$emit("goOtherMatch"),["stop"]))}," 其他比赛直播 "),o("div",{class:"press-msg__other-match-icon",onClick:t[2]||(t[2]=p(l=>e.$emit("goOtherMatch"),["stop"]))},A)])):d("",!0)])])):s.isError&&!r.isTryFailed||s.isLoading?(i(),n("div",W,[D,o("span",j,[v(u(s.isLoading?"正在缓冲，请稍候…":"直播重连中，请耐心等待，预计等待时间")+" ",1),s.isLoading?d("",!0):(i(),n("span",x,u(`0${parseInt(r.timeout/60,10)}`)+":"+u(r.timeout%60<10?`0${r.timeout%60}`:r.timeout%60),1))])])):s.isShowPlayIcon?(i(),n("div",J,[o("img",{class:"press-msg__play-icon",src:"https://res.edata.qq.com/nestim/images/play.svg",onClick:t[3]||(t[3]=p(l=>e.$emit("startPlay"),["stop"]))})])):d("",!0)])):d("",!0)}const Y=y(L,[["render",X],["__scopeId","data-v-e757e634"]]),K={props:{videoSrc:{type:String,default:""},progressControl:{type:Boolean,default:!0},poster:{type:String,default:""},reloadInterval:{type:Number,default:5},retryTimeout:{type:Number,default:300},showFeedbackIcon:{type:Boolean,default:!1},errorMessage:{type:String,default:""},showGoOtherMatch:{type:Boolean,default:!0}}},U=["https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.1/libs/TXLivePlayer-1.2.0.min.js","https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.2/libs/hls.min.0.13.2m.js","https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.2/tcplayer.v4.5.2.min.js"],Q={options:{virtualHost:!0,styleIsoLation:"shared"},components:{LivePlayerMessage:Y},mixins:[K],props:{},emits:["clickFeedbackIcon","fullScreenChange","goOtherMatch","playError","playStatusChange"],data(){return{playerId:"pressTCVideoRef",player:null,isReady:!1,isShowPlayIcon:!1,isError:!1,isLoading:!1,errCode:0,playErrorMessage:""}},computed:{innerErrorMessage(){return this.errorMessage?this.errorMessage:this.playErrorMessage},innerRetryTimeout(){return this.errorMessage?0:this.retryTimeout},innerIsError(){return!!this.errorMessage||this.isError}},watch:{videoSrc:{handler(){this.errorMessage||this.reloadPlayer()},immediate:!1,deep:!0}},mounted(){this.toReady().then(()=>{this.initVideoPlayer()})},beforeDestroy(){this.player&&this.player.dispose()},methods:{async toReady(){for(const e of U)await E(e);return this.isReady=!0,console.log("[isReady]"),!0},startPlay(){this.player||this.initVideoPlayer(),this.player&&this.player.play()},reloadPlayer(){console.info("[reloadPlayer]"),this.initVideoPlayer(!0)},initVideoPlayer(e){var s;if(!this.videoSrc||this.errorMessage)return;if(!this.isReady){this.toReady().then(()=>{this.initVideoPlayer(e)});return}e||(this.playErrorMessage="",this.isError=!1,this.isLoading=!0,this.isShowPlayIcon=!0,window.setTimeout(()=>{this.isLoading=!1},5e3)),this.player&&this.player.dispose(),this.player=null;const t=document.createElement("video");t.setAttribute("id",this.playerId),t.setAttribute("playsinline",!0),t.setAttribute("webkit-playsinline",!0),t.setAttribute("autoplay",!0),(s=document.getElementById("pressTCView"))==null||s.appendChild(t),this.player=TCPlayer(this.playerId,{multiResolution:{autoplay:!0,bigPlayButton:!1},controlBar:{progressControl:this.progressControl,playbackRateMenuButton:!1}}),this.player.src(this.videoSrc),this.poster&&this.player.poster(this.poster),this.player.on("error",this.handerPlayerError),this.player.on("playing",this.handerPlayerPlaying),this.player.one("canplay",this.handerPlayerCanplay),this.player.on("pause",this.handerPlayerPause),this.player.on("waiting",this.handerPlayerWaiting),this.player.on("fullscreenchange",this.handerPlayerFullscreenchange),this.player.on("webrtcevent",this.handleWebrtcEvent)},handerPlayerError(e){console.warn("handerPlayerError",e),this.onHandleError()},handerPlayerPlaying(e){console.warn("handerPlayerPlaying",e),this.isShowPlayIcon=!1,this.isLoading=!1,this.isError=!1,this.playErrorMessage="",this.$emit("playStatusChange","playing")},handerPlayerCanplay(e){console.warn("handerPlayerCanplay",e),this.isShowPlayIcon=!0,this.isLoading=!1,this.isError=!1,this.playErrorMessage=""},handerPlayerPause(e){console.warn("handerPlayerPause",e),this.$emit("playStatusChange","pause"),this.isShowPlayIcon=!0},handerPlayerWaiting(e){console.warn("handerPlayerWaiting",e),this.isLoading=!0,this.$emit("playStatusChange","waiting")},handerPlayerFullscreenchange(e){console.warn("handerPlayerFullscreenchange",e);const t=this.player.isFullscreen();this.$emit("fullScreenChange",t),t||setTimeout(()=>{this.startPlay()},500)},handleWebrtcEvent(e){console.warn("handleWebrtcEvent",e.data.code)},onHandleError(){this.isLoading=!1,this.isError=!0,this.isShowPlayIcon=!1,this.playErrorMessage="直播开启失败，请刷新后重试",this.$emit("playError")}}},Z=e=>(I("data-v-cba2327e"),e=e(),k(),e),ee={class:"press-player"},te=Z(()=>o("div",{id:"pressTCView",class:"press-player__main"},null,-1));function se(e,t,s,g,r,a){const l=c("LivePlayerMessage");return i(),n("div",ee,[h(l,{"is-error":a.innerIsError,"is-loading":r.isLoading,"is-show-play-icon":r.isShowPlayIcon,"err-message":a.innerErrorMessage,"reload-interval":e.reloadInterval,"retry-timeout":a.innerRetryTimeout,"show-feedback-icon":e.showFeedbackIcon,"show-go-other-match":e.showGoOtherMatch,onClickFeedbackIcon:t[0]||(t[0]=_=>e.$emit("clickFeedbackIcon")),onGoOtherMatch:t[1]||(t[1]=_=>e.$emit("goOtherMatch")),onReloadPlayer:a.reloadPlayer,onStartPlay:a.startPlay},null,8,["is-error","is-loading","is-show-play-icon","err-message","reload-interval","retry-timeout","show-feedback-icon","show-go-other-match","onReloadPlayer","onStartPlay"]),te])}const re=y(Q,[["render",se],["__scopeId","data-v-cba2327e"]]),ae={name:"PressLivePlayer",components:{LivePlayerH5:re}},oe={class:"press-live-player"};function ie(e,t,s,g,r,a){const l=c("LivePlayerH5");return i(),n("div",oe,[h(l,b(e.$attrs,M(e.$listeners)),null,16)])}const ne=y(ae,[["render",ie],["__scopeId","data-v-fd83b718"]]),w="https://1500005692.vod2.myqcloud.com/43843706vodtranscq1500005692/62656d94387702300542496289/v.f100240.m3u8",le={components:{PressLivePlayer:ne,PressField:T,PressButton:F},data(){return{videoSrc:w,retryTimeout:5,errorMessage:"",showGoOtherMatch:!0,inputValue:w,autosize:{maxHeight:600,minHeight:50}}},mounted(){},methods:{onClearInput(){this.inputValue=""},onConfirmInput(){const{inputValue:e}=this;this.videoSrc=e},fullScreenChange(e){this.onGTip(`[fullScreenChange] ${e}`)},playStatusChange(e){this.onGTip(`[playStatusChange] ${e}`)},playError(){this.onGTip("[playError]")},goOtherMatch(){this.onGTip("[goOtherMatch]")},clickFeedbackIcon(){this.onGTip("[clickFeedbackIcon]")}}},he={class:"demo-wrap"},ce={class:"input__wrap"},de={class:"input__buttons"};function pe(e,t,s,g,r,a){const l=c("PressLivePlayer"),_=c("PressField"),P=c("PressButton"),C=c("demo-block");return i(),n("div",he,[h(l,{"video-src":r.videoSrc,"retry-timeout":r.retryTimeout,"error-message":r.errorMessage,"show-go-other-match":r.showGoOtherMatch,onGoOtherMatch:a.goOtherMatch,onClickFeedbackIcon:a.clickFeedbackIcon,onPlayStatusChange:a.playStatusChange,onFullScreenChange:a.fullScreenChange,onPlayError:a.playError},null,8,["video-src","retry-timeout","error-message","show-go-other-match","onGoOtherMatch","onClickFeedbackIcon","onPlayStatusChange","onFullScreenChange","onPlayError"]),h(C,{title:"Mock Data"},{default:f(()=>[o("div",ce,[h(_,{modelValue:r.inputValue,"onUpdate:modelValue":t[0]||(t[0]=S=>r.inputValue=S),type:"textarea",autosize:r.autosize,placeholder:"请输入直播地址"},null,8,["modelValue","autosize"]),o("div",de,[h(P,{size:"small","custom-style":"margin-left: 0; margin-right: 8px",onClick:a.onClearInput},{default:f(()=>[v(" 清空 ")]),_:1},8,["onClick"]),h(P,{type:"primary","custom-style":"margin: 0;",size:"small",onClick:a.onConfirmInput},{default:f(()=>[v(" 确定 ")]),_:1},8,["onClick"])])])]),_:1})])}const Ve=y(le,[["render",pe],["__scopeId","data-v-ffd759f3"]]);export{Ve as default};
