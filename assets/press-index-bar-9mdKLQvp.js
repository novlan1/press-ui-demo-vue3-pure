import{g}from"./rect-ZZRvyvMD.js";import{d as v,a as b}from"./press-component-HD2axD72.js";import{C as k,P as C}from"./relation-Cl7c7lz0.js";import{c as T}from"./parent-map-CSroF5oj.js";import{_ as A,o as h,c as d,a as m,x as D,v as S,y as I,t as _,r as O,f as R,n as P,w as u,F as B,i as L,d as N}from"./index-BZexHo5h.js";import{a as E}from"./color-DciZLlTH.js";import{a as y}from"./validator-OjQp2SYe.js";import{g as M}from"./scroll-DZ_Dh06R.js";const z={name:"PressIndexAnchor",options:{...v,styleIsolation:"shared"},mixins:[k(T,{indexKey:"tIndex"})],props:{useSlot:Boolean,index:{type:[Number,String],default:""},...b},emits:[],data(){return{active:!1,wrapperStyle:"",anchorStyle:""}},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},scrollIntoView(e,t){g(this,".press-index-anchor-wrapper").then(o=>{const r=e+o.top-this[T].stickyOffsetTop;t==null||t(r)})}}},j={key:1};function V(e,t,o,r,s,i){return h(),d("div",null,[m("div",{class:"press-index-anchor-wrapper",style:S(s.wrapperStyle)},[m("div",{class:D("press-index-anchor "+(s.active?"press-index-anchor--active press-hairline--bottom":"")),style:S(s.anchorStyle)},[o.useSlot?I(e.$slots,"default",{key:0},void 0,!0):(h(),d("span",j,_(o.index),1))],6)],4)])}const rt=A(z,[["render",V],["__scopeId","data-v-45678c13"]]),H=()=>{const e=[];for(let o=0;o<26;o++)e.push(String.fromCharCode(65+o));return e},W={name:"PressIndexBar",options:{...v,styleIsolation:"shared"},mixins:[C(T)],props:{sticky:{type:Boolean,default:!0},zIndex:{type:Number,default:1},highlightColor:{type:String,default:E},stickyOffsetTop:{type:Number,default:0},indexList:{type:Array,default:()=>H()},windowTop:{type:Number,default:0},...b},emits:["select"],data(){return{activeAnchorIndex:null,showSidebar:!1,sidebar:{},curScrollTop:0}},created(){this.scrollTop=0,this.children=[]},mounted(){this.updateData()},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},updateData(){this.$nextTick(()=>{this.timer!=null&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.showSidebar=!!this.children.length,this.$nextTick(()=>{this.setRect().then(()=>{this.onScroll()})})},0)})},setRect(){return Promise.all([this.setAnchorsRect(),this.setListRect(),this.setSiderbarRect()])},setAnchorsRect(){return Promise.all(this.children.map(e=>g(e,".press-index-anchor-wrapper").then(t=>(Object.assign(e,{height:t.height,top:t.top+this.scrollTop}),e))))},setListRect(){return g(this,".press-index-bar").then(e=>{y(e)&&Object.assign(this,{height:e.height,top:e.top+this.scrollTop})})},setSiderbarRect(){return g(this,".press-index-bar__sidebar").then(e=>{y(e)&&(this.sidebar={height:e.height,top:e.top})})},setDiffData({target:e,data:t}){const o={};Object.keys(t).forEach(r=>{e[r]!==t[r]&&(o[r]=t[r])}),Object.keys(o).length&&e.setData(o)},getAnchorRect(e){return g(e,".press-index-anchor-wrapper").then(t=>({height:t.height,top:t.top}))},getActiveAnchorIndex(){const{children:e,scrollTop:t}=this,{sticky:o,stickyOffsetTop:r}=this;for(let s=this.children.length-1;s>=0;s--){const i=s>0?e[s-1].height:0;if((o?i+r:this.stickyOffsetTop)+t>=e[s].top)return s}return-1},onScroll(e){e&&(e.target||e.detail)&&(this.scrollTop=e.target.scrollTop||e.detail.scrollTop);const{children:t=[],scrollTop:o}=this;if(!t.length)return;const{sticky:r,stickyOffsetTop:s,zIndex:i,highlightColor:c}=this,n=this.getActiveAnchorIndex();if(this.setDiffData({target:this,data:{activeAnchorIndex:n}}),r){let l=!1;n!==-1&&(l=t[n].top<=s+o),t.forEach((p,a)=>{if(a===n){let f="",x=`
              color: ${c};
            `;l&&(f=`
                height: ${t[a].height}px;
              `,x=`
                position: fixed;
                top: ${s}px;
                z-index: ${i};
                color: ${c};
              `),this.setDiffData({target:p,data:{active:!0,anchorStyle:x,wrapperStyle:f}})}else if(a===n-1){const f=t[a],x=f.top,w=`
              position: relative;
              transform: translate3d(0, ${(a===t.length-1?this.top:t[a+1].top)-x-f.height}px, 0);
              z-index: ${i};
              color: ${c};
            `;this.setDiffData({target:p,data:{active:!0,anchorStyle:w}})}else this.setDiffData({target:p,data:{active:!1,anchorStyle:"",wrapperStyle:""}})})}},onClick(){},onTouchMove(e){const t=this.children.length,o=e.touches[0],r=this.sidebar.height/t;let s;console.log("[onTouchMove]",o.clientY,this.sidebar.top,this.top),s=Math.floor((o.clientY+this.windowTop-this.sidebar.top)/r),console.log("[onTouchMove]",s),s<0?s=0:s>t-1&&(s=t-1),this.scrollToAnchor(s)},onTouchStop(){this.scrollToAnchorIndex=null},scrollToAnchor(e){if(typeof e!="number"||this.scrollToAnchorIndex===e)return;this.scrollToAnchorIndex=e;const t=this.children.find(o=>o.index===this.indexList[e]);t!==void 0&&(console.log("[scrollTop]",this.scrollTop),t.scrollIntoView(this.scrollTop,this.changeScrollerTop),this.$emit("select",t.index))},onClickInner(e){var o,r;const t=(r=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:r.index;t!==void 0&&(console.log("[index]",t,this.indexList),this.scrollToAnchor(+t))},onWatchScroll(e){this.onScroll(e)},changeScrollerTop(e){const t=M("pressIndexBarWrapper");console.log("[changeScrollerTop] top",e);const o=document==null?void 0:document.querySelector(t);o&&(o.scrollTop=e)}}},Y={class:"press-index-bar-container"},F={class:"press-index-bar"},$=["data-index"];function q(e,t,o,r,s,i){const c=O("scroll-view");return h(),d("div",Y,[R(c,{id:"pressIndexBarWrapper",class:"press-index-bar-wrapper",enhanced:"","scroll-with-animation":!1,"scroll-y":"","scroll-top":s.curScrollTop,onScroll:i.onWatchScroll},{default:P(()=>[m("div",F,[I(e.$slots,"default",{},void 0,!0)])]),_:3},8,["scroll-top","onScroll"]),s.showSidebar?(h(),d("div",{key:0,class:"press-index-bar__sidebar",onClick:t[1]||(t[1]=u((...n)=>i.onClick&&i.onClick(...n),["stop","prevent"])),onTouchmove:t[2]||(t[2]=u((...n)=>i.onTouchMove&&i.onTouchMove(...n),["stop","prevent"])),onTouchend:t[3]||(t[3]=u((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop"])),onTouchcancel:t[4]||(t[4]=u((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop","prevent"]))},[(h(!0),d(B,null,L(o.indexList,(n,l)=>(h(),d("div",{key:l,class:"press-index-bar__index",style:S("z-index: "+(o.zIndex+1)+"; color: "+(s.activeAnchorIndex===l?o.highlightColor:"")),"data-index":l,onClick:t[0]||(t[0]=u((...p)=>i.onClickInner&&i.onClickInner(...p),["stop"]))},_(n),13,$))),128))],32)):N("",!0)])}const it=A(W,[["render",q],["__scopeId","data-v-8a9bbb63"]]);export{rt as P,it as a};
