import{a as D,i as R}from"./utils-C2tViYFs.js";import{a as M}from"./add-unit-B8Dm0KXN.js";import{P as B}from"./press-icon-plus-Be77GIh7.js";import{P as V}from"./press-loading-plus-BH5XUDOz.js";import{i as S,v as N,f as T,p as E}from"./test-CXO-MJ-T.js";import{_ as A,r as w,o as u,c,a as x,F as L,y as q,m as k,f as d,t as I,b as z,d as f,w as j,i as G,n as H,l as p}from"./index-BrqLSZap.js";import{P as W}from"./press-image-CyGNOyLh.js";import"./style-CpIyAjCl.js";import"./press-info-Bvabues3.js";import"./press-component-D9D_j5DA.js";import"./press-transition-Dm3ttXkb.js";import"./system-BWskc-Wq.js";import"./adapter-_Qol4RNt.js";const X={image:{jpg:"jpeg",jpe:"jpeg",pbm:"x-portable-bitmap",pgm:"x-portable-graymap",pnm:"x-portable-anymap",ppm:"x-portable-pixmap",psd:"vnd.adobe.photoshop",pic:"x-pict",rgb:"x-rgb",svg:"svg+xml",svgz:"svg+xml",tif:"tiff",xif:"vnd.xiff",wbmp:"vnd.wap.wbmp",wdp:"vnd.ms-photo",xbm:"x-xbitmap",ico:"x-icon"},video:{"3g2":"3gpp2","3gp":"3gpp",avi:"x-msvideo",f4v:"x-f4v",flv:"x-flv",jpgm:"jpm",jpgv:"jpeg",m1v:"mpeg",m2v:"mpeg",mpe:"mpeg",mpg:"mpeg",mpg4:"mpeg",m4v:"x-m4v",mkv:"x-matroska",mov:"quicktime",qt:"quicktime",movie:"x-sgi-movie",mp4v:"mp4",ogv:"ogg",smv:"x-smv",wm:"x-ms-wm",wmv:"x-ms-wmv",wmx:"x-ms-wmx",wvx:"x-ms-wvx"}},K="*";function J(){const e=window.navigator.userAgent.toLowerCase();return!!(e.match(/MicroMessenger/i)&&e.match(/MicroMessenger/i)[0]==="micromessenger")}function F({count:e,sourceType:i,type:a,extension:o=["*"]}){const s=document.createElement("input");return s.type="file",D(s,{position:"absolute",visibility:"hidden","z-index":-999,width:0,height:0,top:0,left:0}),s.accept=o.map(t=>{if(a!==K){const n=t.replace(".","");return`${a}/${X[a][n]||n}`}return J()?".":t.indexOf(".")===0?t:`.${t}`}).join(","),e>1&&(s.multiple="multiple"),i.length===1&&i[0]==="camera"&&(s.capture="camera"),s}const{hasOwnProperty:Q}=Object.prototype;function Y(e,i){return Q.call(e,i)}const b={};function C(e){for(const a in b)if(Y(b,a)&&b[a]===e)return a;const i=(window.URL||window.webkitURL).createObjectURL(e);return b[i]=e,i}function O(e){(window.URL||window.webkitURL).revokeObjectURL(e),delete b[e]}function U(e,i){const a=[],o=e.target.files.length;for(let s=0;s<o;s++){const t=e.target.files[s];let n;Object.defineProperty(t,"path",{get(){return n=n||C(t),n}}),s<i&&a.push(t)}return a}let h=null;function Z({count:e,sourceType:i,type:a,extension:o,success:s}){h&&(document.body.removeChild(h),h=null),h=F({count:e,sourceType:i,type:a,extension:o}),document.body.appendChild(h),h.addEventListener("change",t=>{const n=U(t,e);s({errMsg:"chooseFile:ok",get tempFilePaths(){return n.map(({path:l})=>l)},tempFiles:n})}),h.click()}let g=null;function $({count:e,sourceType:i,extension:a,success:o}){g&&(document.body.removeChild(g),g=null),g=F({count:e,sourceType:i,extension:a,type:"image"}),document.body.appendChild(g),g.addEventListener("change",s=>{const t=U(s,e);o({errMsg:"chooseImage:ok",get tempFilePaths(){return t.map(({path:r})=>r)},tempFiles:t})}),g.click()}let _=null;function ee({sourceType:e,extension:i,success:a}){_&&(document.body.removeChild(_),_=null),_=F({sourceType:e,extension:i,type:"video"}),document.body.appendChild(_),_.addEventListener("change",o=>{const s=o.target.files[0],t={errMsg:"chooseVideo:ok",tempFile:s,size:s.size,duration:0,width:0,height:0,name:s.name};let n;Object.defineProperty(t,"tempFilePath",{get(){return n=n||C(this.tempFile),n}});const r=document.createElement("video");if(r.onloadedmetadata!==void 0){const l=C(s);r.onloadedmetadata=function(){O(l),a(Object.assign(t,{duration:r.duration||0,width:r.videoWidth||0,height:r.videoHeight||0}))},setTimeout(()=>{r.onloadedmetadata=null,O(l),a(t)},300),r.src=l}else a(t)}),_.click()}function te({count:e,success:i,fail:a,type:o}){if(R())return Z({count:e,sourceType:[],type:o,extension:["*"],success:i});uni.chooseFile({count:e,type:o,success:i,fail:a})}function ie({count:e,sourceType:i,sizeType:a,success:o,fail:s}){if(R())return $({count:e,sourceType:i,extension:["*"],success:o});uni.chooseImage({count:e,sourceType:i,sizeType:a,success:o,fail:s})}function se({sourceType:e,success:i,fail:a,compressed:o,maxDuration:s,camera:t}){if(R())return ee({sourceType:e,extension:["*"],success:i});uni.chooseVideo({sourceType:e,success:i,fail:a,compressed:o,maxDuration:s,camera:t})}function ae(e){return e.tempFiles}function oe(e){return e.tempFiles}function le({accept:e,multiple:i,capture:a,compressed:o,maxDuration:s,sizeType:t,camera:n,maxCount:r}){return new Promise((l,v)=>{switch(e){case"image":ie({count:i?Math.min(r,9):1,sourceType:a,sizeType:t,success:m=>l(ae(m)),fail:v});break;case"video":se({sourceType:a,compressed:o,maxDuration:s,camera:n,success:m=>l(m),fail:v});break;default:te({count:i?r:1,type:"all",success:m=>l(oe(m)),fail:v})}})}const ne={watch:{accept:{immediate:!0,handler(e){(e==="all"||e==="media")&&console.warn("只有微信小程序才支持把 accept 配置为 all、media 之一")}}}},re={props:{accept:{type:String,default:"image"},capture:{type:[String,Array],default:()=>["album","camera"]},compressed:{type:Boolean,default:!0},camera:{type:String,default:"back"},maxDuration:{type:Number,default:60},uploadIcon:{type:String,default:"photograph"},uploadIconColor:{type:String,default:"#D3D4D6"},useBeforeRead:{type:Boolean,default:!1},afterRead:{type:Function,default:null},beforeRead:{type:Function,default:null},previewFullImage:{type:Boolean,default:!0},maxCount:{type:[String,Number],default:52},disabled:{type:Boolean,default:!1},imageMode:{type:String,default:"aspectFill"},name:{type:String,default:"file"},sizeType:{type:Array,default:()=>["original","compressed"]},multiple:{type:Boolean,default:!1},deletable:{type:Boolean,default:!0},maxSize:{type:[String,Number],default:Number.MAX_VALUE},fileList:{type:Array,default:()=>[]},uploadText:{type:String,default:""},width:{type:[String,Number],default:80},height:{type:[String,Number],default:80},previewImage:{type:Boolean,default:!0},customStyle:{type:String,default:""}}},de={name:"PressUploader",options:{virtualHost:!0,styleIsolation:"shared"},components:{PressIconPlus:B,PressLoadingPlus:V},mixins:[ne,re],emits:["afterRead","error","oversize"],data(){return{lists:[],isInCount:!0,isNotInUni:R()}},watch:{fileList:{immediate:!0,handler(){this.formatFileList()}}},methods:{addUnit:M,formatFileList(){const{fileList:e=[],maxCount:i}=this,a=e.map(o=>Object.assign(Object.assign({},o),{isImage:this.accept==="image"||S(o.url||o.thumb),isVideo:this.accept==="video"||N(o.url||o.thumb),deletable:typeof o.deletable=="boolean"?o.deletable:this.deletable}));this.lists=a,this.isInCount=a.length<i},chooseFile(){const{maxCount:e,multiple:i,lists:a,disabled:o}=this;if(console.log("[chooseFile]"),o)return;let s;try{s=Array.isArray(this.capture)?this.capture:this.capture.split(",")}catch{s=[]}le(Object.assign({accept:this.accept,multiple:this.multiple,capture:s,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-a.length})).then(t=>{this.onBeforeRead(i?t:t[0])}).catch(t=>{this.$emit("error",t)})},onBeforeRead(e){const{beforeRead:i,useBeforeRead:a}=this;let o=!0;T(i)&&(o=i(e,this.getDetail())),a&&(o=new Promise((s,t)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:n=>{n?s():t()}}))})),o&&(E(o)?o.then(s=>this.onAfterRead(s||e)):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:e??this.fileList.length}},onAfterRead(e){const{maxSize:i,afterRead:a}=this;if(Array.isArray(e)?e.some(s=>s.size>i):e.size>i){this.$emit("oversize",Object.assign({file:e},this.getDetail()));return}typeof a=="function"&&a(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail()))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e){!e.isImage||!this.previewFullImage||uni.previewImage({urls:this.lists.filter(i=>this.accept==="image"||S(i.url||i.thumb)).map(i=>i.url||i.thumb),current:e.url||e.thumb,fail(){}})},onPreviewVideo(e){if(!this.data.previewFullImage)return;const{index:i}=e.currentTarget.dataset,{lists:a}=this.data;wx.previewMedia({sources:a.map(o=>Object.assign(Object.assign({},o),{type:"video"})),current:i,fail(){}})},onClickPreview(e){const{index:i}=e.currentTarget.dataset,a=this.data.lists[i];this.$emit("clickPreview",Object.assign(Object.assign({},a),this.getDetail(i)))}}},ue={class:"press-upload__wrap"},ce=["src","mode","onClick"],pe=["src","mode","onClick"],me={key:1,class:"press-upload__wrap__preview__other"},fe={class:"press-upload__wrap__preview__other__text"},he={key:2,class:"press-upload__status"},ge={class:"press-upload__status__icon"},_e={key:0,class:"press-upload__status__message"},ve=["onClick"];const ye=["hover-class"],be={key:0,class:"press-upload__button__text"};function we(e,i,a,o,s,t){const n=w("PressIconPlus"),r=w("PressLoadingPlus");return u(),c("div",{class:"press-upload",style:k(e.customStyle)},[x("div",ue,[e.previewImage?(u(!0),c(L,{key:0},q(s.lists,(l,v)=>(u(),c("div",{key:v,class:"press-upload__wrap__preview"},[l.isImage||l.type&&l.type==="image"?(u(),c(L,{key:0},[s.isNotInUni?(u(),c("img",{key:0,src:l.thumb||l.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:k([{width:t.addUnit(e.width),height:t.addUnit(e.height)}]),onClick:m=>t.onPreviewImage(l)},null,12,ce)):(u(),c("image",{key:1,src:l.thumb||l.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:k([{width:t.addUnit(e.width),height:t.addUnit(e.height)}]),onClick:m=>t.onPreviewImage(l)},null,12,pe))],64)):(u(),c("div",me,[d(n,{color:"#80CBF9",size:"26",name:l.isVideo||l.type&&l.type==="video"?"movie":"folder"},null,8,["name"]),x("span",fe,I(l.isVideo||l.type&&l.type==="video"?"视频":"文件"),1)])),l.status==="uploading"||l.status==="failed"?(u(),c("div",he,[x("div",ge,[l.status==="failed"?(u(),z(n,{key:0,name:"close",color:"#ffffff",size:"22"})):(u(),z(r,{key:1,size:"22",mode:"circle",color:"#ffffff"}))]),l.message?(u(),c("span",_e,I(l.message),1)):f("",!0)])):f("",!0),l.status!=="uploading"&&(e.deletable||l.deletable)?(u(),c("div",{key:3,class:"press-upload__deletable",onClick:j(m=>t.deleteItem(v),["stop"])},[d(n,{name:"cross",color:"#ffffff",size:"16","custom-class":"press-upload__deletable__icon"})],8,ve)):f("",!0),(l.status,f("",!0))]))),128)):f("",!0),s.isInCount?(u(),c(L,{key:1},[e.$slots.default||e.$slots.$default?(u(),c("div",{key:0,onClick:i[0]||(i[0]=(...l)=>t.chooseFile&&t.chooseFile(...l))},[G(e.$slots,"default",{},void 0,!0)])):(u(),c("div",{key:1,class:H(["press-upload__button",[e.disabled&&"press-upload__button--disabled"]]),"hover-class":e.disabled?"":"press-upload__button--hover","hover-stay-time":"150",style:k([{width:t.addUnit(e.width),height:t.addUnit(e.height)}]),onClick:i[1]||(i[1]=j((...l)=>t.chooseFile&&t.chooseFile(...l),["stop"]))},[d(n,{name:e.uploadIcon,size:"26",color:e.uploadIconColor,onClick:t.chooseFile},null,8,["name","color","onClick"]),e.uploadText?(u(),c("span",be,I(e.uploadText),1)):f("",!0)],14,ye))],64)):f("",!0)])],4)}const ke=A(de,[["render",we],["__scopeId","data-v-9e4a56da"]]),y="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_a17f94292a34e9f644.jpeg";let P;const Pe={i18n:{"zh-CN":{uploadVideo:"上传视频",uploadStatus:"上传状态",preview:"文件预览",maxCount:"限制上传数量",maxSize:"限制上传大小",customStyle:"自定义上传样式",beforeRead:"上传前置处理"},"en-US":{uploadVideo:"Upload Video",uploadStatus:"Upload Status",preview:"Preview",maxCount:"Max Count",maxSize:"Max Size",customStyle:"Custom Style",beforeRead:"Before Read"}},components:{PressUploader:ke,PressImage:W},data(){return{fileList1:[],fileListMaxSize:[],fileList2:[],fileList3:[{url:y}],fileList4:[{url:y},{url:y}],fileList6:[],fileListStatus:[{url:y,status:"uploading",message:"上传中..."},{url:y,status:"failed",message:"上传失败"}]}},mounted(){P=this},methods:{deletePic(e){console.log("[deletePic] event",e),this[`fileList${e.name}`].splice(e.index,1)},async afterRead(e){console.log("[afterRead] event",e);const i=[].concat(e.file);let a=this[`fileList${e.name}`].length;i.map(o=>{this[`fileList${e.name}`].push({...o,status:"uploading",message:"上传中"})});for(let o=0;o<i.length;o++){const s=await this.uploadFilePromise(i[o].path),t=this[`fileList${e.name}`][a];this[`fileList${e.name}`].splice(a,1,Object.assign(t,{message:"",...s})),a+=1}},uploadFilePromise(e){return console.log("[uploadFilePromise] url",e),new Promise(i=>{setTimeout(()=>i({url:e,status:"success",message:"上传失败"}),1e3)})},onOversize(e){console.log("[onOversize] file",e),P.onGTip("文件大小不能超过 500kb")},beforeRead(e){return console.log("[beforeRead] file",e),e.type!=="image/jpeg"?(P.onGTip("请上传 jpg 格式图片"),!1):!0},asyncBeforeRead(e){return console.log("[asyncBeforeRead] file",e),new Promise((i,a)=>{if(e.type!=="image/jpeg")P.onGTip("请上传 jpg 格式图片"),a();else{const o=new File(["foo"],"bar.jpg",{type:"image/jpeg"});i(o)}})}}},Re={class:"demo-wrap"};function xe(e,i,a,o,s,t){const n=w("PressUploader"),r=w("demo-block"),l=w("PressImage");return u(),c("div",Re,[d(r,{title:e.t("basicUsage")},{default:p(()=>[d(n,{"file-list":s.fileList1,name:"1",multiple:"","max-count":10,onAfterRead:t.afterRead,onDelete:t.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("uploadVideo")},{default:p(()=>[d(n,{"file-list":s.fileList2,name:"2",multiple:"","max-count":10,accept:"video",onAfterRead:t.afterRead,onDelete:t.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("uploadStatus")},{default:p(()=>[d(n,{"file-list":s.fileListStatus,name:"Status",multiple:"","max-count":10,accept:"video",onAfterRead:t.afterRead,onDelete:t.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("preview")},{default:p(()=>[d(n,{"file-list":s.fileList3,name:"3",multiple:"","max-count":10,"preview-full-image":!0,onAfterRead:t.afterRead,onDelete:t.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("maxCount")},{default:p(()=>[d(n,{"file-list":s.fileList4,name:"4",multiple:"","max-count":2,onAfterRead:t.afterRead,onDelete:t.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("maxSize")},{default:p(()=>[d(n,{"file-list":s.fileListMaxSize,name:"MaxSize",multiple:"","max-size":500*1024,onAfterRead:t.afterRead,onOversize:t.onOversize},null,8,["file-list","onAfterRead","onOversize"])]),_:1},8,["title"]),d(r,{title:e.t("customStyle")},{default:p(()=>[d(n,{"file-list":s.fileList6,name:"6",multiple:"","max-count":1,width:"250",height:"150",onAfterRead:t.afterRead,onDelete:t.deletePic},{default:p(()=>[d(l,{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_799718017ac81b11c0.png",mode:"widthFix",style:{width:"250px",height:"150px"},width:"250px",height:"150px"})]),_:1},8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("beforeRead")},{default:p(()=>[d(n,{"before-read":t.beforeRead},null,8,["before-read"])]),_:1},8,["title"]),d(r,{title:e.t("disabled")},{default:p(()=>[d(n,{disabled:""})]),_:1},8,["title"])])}const Ve=A(Pe,[["render",xe]]);export{Ve as default};
