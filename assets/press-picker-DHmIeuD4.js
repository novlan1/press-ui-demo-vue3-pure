import{_ as w,o,c,a as h,l as p,F as P,q as M,n as f,t as y,w as u,z as I,Q as S,r as v,b as g,k as T,d as k,e as x,aA as D,al as b}from"./index-BIszYdsF.js";import{g as L}from"./rect-B0viD194.js";function d(t){return t.changedTouches&&t.changedTouches[0]?t.changedTouches[0]:t.touches&&t.touches[0]?t.touches[0]:t}const q={name:"PressPickerView",props:{data:{type:Array,default:()=>[{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"}],required:!0},current:{type:Object,default:null,required:!1},hasTip:{type:Boolean,default:!1,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},options:{virtualHost:!0},emits:["currentIndexChanged"],data(){return{currentIndex:0,currentScroll:0,start:0,startScroll:0,move:0,itemHeight:56,downX:0,downY:0,upX:0,upY:0,lastMove:0,lastTime:0,speed:0,hasClick:!1,slideLimitNum:10,slideTimeThreshold:300}},computed:{upMissed(){const{currentIndex:t,virtualListThreshold:e}=this;return Math.max(0,t-e)},hiddenUpPartStyle(){const{itemHeight:t,upMissed:e}=this;return`height: ${e*t}px;`},hiddenBottomPartStyle(){const{currentIndex:t,data:e,itemHeight:r,virtualListThreshold:n}=this;return`height: ${(e.length-t-n)*r}px;`},showingData(){const{currentIndex:t,virtualListThreshold:e,upMissed:r}=this;return this.data.slice(r,t+e).map((n,l)=>({...n,uniqueKey:l+r}))},transformStyle(){return`transform: translate3d(0, ${this.currentScroll}px, 0);`},slideLimitDistance(){return this.slideLimitNum*this.itemHeight}},watch:{data(t){return this.updateCurrent(),t},current(t){return this.updateCurrent(),t},currentIndex:{handler(t){this.$emit("currentIndexChanged",t)},deep:!0}},created(){},mounted(){L(this,".press-picker-view--item__active").then(t=>{this.itemHeight=t.height,this.updateCurrent()}),this.updateCurrent(),document.addEventListener("mouseup",this.mouseUp)},beforeDestroy(){this.onBeforeDestroy()},beforeUnmount(){this.onBeforeDestroy()},methods:{onBeforeDestroy(){document.removeEventListener("mouseup",this.mouseUp)},mouseDown(t){document.addEventListener("mousemove",this.mouseMove),this.handleStart(t)},mouseMove(t){this.handleMove(t)},mouseUp(){document.removeEventListener("mousemove",this.mouseMove),this.handleEnd()},handleStart(t){const e=d(t);this.start=e==null?void 0:e.clientY,this.startScroll=this.currentScroll,this.lastMove=0,this.lastTime=new Date().getTime()},handleMove(t){const e=d(t);this.move=(e==null?void 0:e.clientY)-this.start;let r=this.startScroll+this.move;r=Math.min(0,r),r=Math.max(-(this.data.length-1)*this.itemHeight,r),this.currentScroll=r;const n=Math.round(this.currentScroll/this.itemHeight);this.currentIndex=-n,this.time=new Date().getTime(),this.time!==this.lastTime&&(this.speed=(this.move-this.lastMove)/(this.time-this.lastTime)),this.lastMove=this.move,this.lastTime=this.time},handleEnd(){if(this.hasClick){this.hasClick=!1;return}let t=0;new Date().getTime()-this.lastTime<this.slideTimeThreshold&&(t=this.speed*this.slideTimeThreshold/2,t=Math.min(this.slideLimitDistance,t),t=Math.max(-this.slideLimitDistance,t));let e=this.currentScroll+t;e=Math.min(0,e),e=Math.max(-(this.data.length-1)*this.itemHeight,e);const r=Math.round(e/this.itemHeight);this.currentScroll=r*this.itemHeight,this.currentIndex=-r},getCurrentItem(){return this.data[this.currentIndex]},updateCurrent(){if(this.current){const t=this.data.find(e=>e.value==this.current.value);this.currentIndex=this.data.indexOf(t),this.currentScroll=-this.currentIndex*this.itemHeight}},itemDown(t){const e=d(t);this.downX=e==null?void 0:e.clientX,this.downY=e==null?void 0:e.clientY,this.upX=e==null?void 0:e.clientX,this.upY=e==null?void 0:e.clientY},itemMove(t){const e=d(t);this.upX=e==null?void 0:e.clientX,this.upY=e==null?void 0:e.clientY},itemUp(t){const{uniqueKey:e}=t.currentTarget.dataset;this.twoPointDistance({x:this.downX,y:this.downY},{x:this.upX,y:this.upY})<10&&(this.currentIndex=e,this.currentScroll=-this.currentIndex*this.itemHeight,this.hasClick=!0)},twoPointDistance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getElementIndex(t){return parseInt(t.id,10)}}},O={ref:"dropListMask",class:"press-picker-view--mask"},_={ref:"dropListIndicator",class:"press-picker-view--indicator"},z=["data-unique-key"];function B(t,e,r,n,l,i){return o(),c("div",{class:f(["press-picker-view",[r.hasTip?"press-picker-view__tip":"",r.horizontal?"press-picker-view--hor":""]]),onMousedown:e[6]||(e[6]=u((...s)=>i.mouseDown&&i.mouseDown(...s),["stop","prevent"])),onMouseup:e[7]||(e[7]=u((...s)=>i.mouseUp&&i.mouseUp(...s),["stop","prevent"])),onTouchstart:e[8]||(e[8]=u((...s)=>i.handleStart&&i.handleStart(...s),["stop","prevent"])),onTouchmove:e[9]||(e[9]=u((...s)=>i.handleMove&&i.handleMove(...s),["stop","prevent"])),onTouchend:e[10]||(e[10]=u((...s)=>i.handleEnd&&i.handleEnd(...s),["stop","prevent"]))},[h("div",O,null,512),h("div",_,null,512),h("div",{ref:"DropListContent",class:"press-picker-view--content",style:p(i.transformStyle)},[h("div",{style:p(i.hiddenUpPartStyle)},null,4),(o(!0),c(P,null,M(i.showingData,(s,m)=>(o(),c("div",{key:m,class:f(["press-picker-view--item",[s.uniqueKey==l.currentIndex?"press-picker-view--item__active":""]]),"data-unique-key":s.uniqueKey,onMousedown:e[0]||(e[0]=(...a)=>i.itemDown&&i.itemDown(...a)),onMousemove:e[1]||(e[1]=(...a)=>i.itemMove&&i.itemMove(...a)),onMouseup:e[2]||(e[2]=(...a)=>i.itemUp&&i.itemUp(...a)),onTouchstart:e[3]||(e[3]=(...a)=>i.itemDown&&i.itemDown(...a)),onTouchmove:e[4]||(e[4]=(...a)=>i.itemMove&&i.itemMove(...a)),onTouchend:e[5]||(e[5]=(...a)=>i.itemUp&&i.itemUp(...a))},y(s.label),43,z))),128)),h("div",{style:p(i.hiddenBottomPartStyle)},null,4)],4)],34)}const H=w(q,[["render",B],["__scopeId","data-v-b7bf6455"]]),U={components:{PressPopup:I,PressPickerView:H},props:{title:{type:String,default:"",required:!1},arrowIcon:{type:Boolean,default:!1},tip:{type:String,default:"",required:!1},data:{type:Array,default:()=>[],required:!0},current:{type:Object,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},options:{virtualHost:!0,styleIsolation:"shared"},emits:["onSelect","onCancel"],data(){return{currentIndex:-1}},mounted(){},methods:{t:S,onCurrentIndexChanged(t){this.currentIndex=t},onConfirm(){var t,e;(t=this.$refs)!=null&&t.picker?this.$emit("onSelect",this.$refs.picker.getCurrentItem()):this.$emit("onSelect",(e=this.data)==null?void 0:e[this.currentIndex])},onCancel(){this.$emit("onCancel")}}},Y={key:0,class:"press-picker--tip"};function E(t,e,r,n,l,i){const s=v("PressPickerView"),m=v("PressPopup");return o(),g(m,{"close-icon":!r.arrowIcon,"show-back-arrow":r.arrowIcon,title:r.title,button:i.t("picker.confirm"),mode:"white",horizontal:r.horizontal,"width-number":54,"popup-class":"press-popup-picker",class:f(r.tip?"press-picker__tip":""),onCancel:i.onCancel,onConfirm:i.onConfirm},{default:T(()=>[r.tip?(o(),c("div",Y,y(r.tip),1)):k("",!0),x(s,{ref:"picker",data:r.data,"has-tip":!!r.tip,current:r.current,horizontal:r.horizontal,"virtual-list-threshold":r.virtualListThreshold,onCurrentIndexChanged:i.onCurrentIndexChanged},null,8,["data","has-tip","current","horizontal","virtual-list-threshold","onCurrentIndexChanged"])]),_:1},8,["close-icon","show-back-arrow","title","button","horizontal","class","onCancel","onConfirm"])}const X=w(U,[["render",E],["__scopeId","data-v-c5625d43"]]),C={arrowIcon:"showBackArrow",list:"selectList",current:"selectItem",confirm:"onClickConfirm",cancel:"onRemove"},N={arrowIcon:{type:Boolean,default:!1},title:{type:String,default:""},list:{type:Array,default:()=>[],required:!1},current:{type:Object,default:null,required:!1},tip:{type:String,default:"",required:!1},confirm:{type:Function,default:null,required:!1},cancel:{type:Function,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},V=D(N,C),A={name:"PressPicker",options:{styleIsolation:"shared"},components:{PickerInner:X},mixins:[b(V,{showProp:!1,propsKeyMap:C})],props:{},emits:["onClickConfirm","confirm","onRemove","cancel"],data(){return{}},mounted(){this.isFunctionMode||this.showDialog()},methods:{onClickSelect(t){this.$emit("onClickConfirm",t),this.$emit("confirm",t),this.innerShow=!1,this.getPropOrData("confirm")&&this.getPropOrData("confirm")(t),this.promiseCallback("confirm",{item:t}),setTimeout(()=>{this.destroy()},100)},remove(){this.$emit("onRemove"),this.$emit("cancel"),this.innerShow=!1,this.getPropOrData("cancel")&&this.getPropOrData("cancel")(),this.promiseCallback("cancel"),setTimeout(()=>{this.destroy()},100)},destroy(){var t,e,r,n;this.isFunctionMode||((t=this==null?void 0:this.$destroy)==null||t.call(this),document.body.contains(this.$el)&&((n=(r=(e=this.$el)==null?void 0:e.parentElement)==null?void 0:r.removeChild)==null||n.call(r,this.$el)))}}};function F(t,e,r,n,l,i){const s=v("PickerInner");return t.innerShow?(o(),g(s,{key:0,data:t.getPropOrData("list"),current:t.getPropOrData("current"),title:t.getPropOrData("title"),"arrow-icon":t.getPropOrData("arrowIcon"),tip:t.getPropOrData("tip"),"virtual-list-threshold":t.getPropOrData("virtualListThreshold"),horizontal:t.getPropOrData("horizontal"),onOnCancel:i.remove,onOnSelect:i.onClickSelect},null,8,["data","current","title","arrow-icon","tip","virtual-list-threshold","horizontal","onOnCancel","onOnSelect"])):k("",!0)}const j=w(A,[["render",F]]);export{j as P};
