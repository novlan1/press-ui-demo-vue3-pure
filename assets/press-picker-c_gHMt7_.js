import{u as c,y as d,_ as w,k as O,l as H,X as P,U as B,c as l,o as u,b as a,B as m,F as k,j as M,w as V,n as S,H as A,t as j,R as T,a7 as K,r as C,d as x,a as v,e as L}from"./index-Q-rLfHSZ.js";import{C as U,c as N,a as Y}from"./relation-C7hDGN8M.js";import{r as I}from"./number-CU9l-NjU.js";import{S as J}from"./scroll-view-d6qms1vU.js";import{P as R}from"./press-picker-toolbar-Cu0rXKNk.js";function D(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function z(e,t){return D(e)&&e[t]!=null?e[t]:e}function F(e){return D(e)&&e.html}function X(e){return d({height:c(e.itemHeight*e.visibleItemCount)})}function q(e){const t=c(e.offset+e.itemHeight*(e.visibleItemCount-1)/2);return d({transition:`transform ${e.duration}ms`,"line-height":c(e.itemHeight),transform:`translate3d(0, ${t}, 0)`})}const b={optionText:z,optionTextHtml:F,rootStyle:X,wrapperStyle:q},G=200,_=300,Q=15,W={name:"PressPickerPlusColumn",options:{...H},mixins:[J,U(N)],props:{...O,activeClass:{type:String,default:""},valueKey:{type:String,default:""},className:{type:String,default:""},itemHeight:{type:Number,default:44},visibleItemCount:{type:Number,default:6},initialOptions:{type:Array,default:()=>[]},defaultIndex:{type:Number,default:0},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3},relationKey:{type:String,default:""}},emits:["change"],data(){return{startY:0,offset:0,duration:0,startOffset:0,options:[],currentIndex:0,computed:b,touchStartTime:0,momentumOffset:0}},computed:{columnStyle(){const{itemHeight:e,visibleItemCount:t}=this;return b.rootStyle({itemHeight:e,visibleItemCount:t})},wrapperStyle(){const{offset:e,itemHeight:t,visibleItemCount:s,duration:n}=this;return b.wrapperStyle({offset:e,itemHeight:t,visibleItemCount:s,duration:n})}},watch:{defaultIndex:{handler(e){this.setIndex(e)},immediate:!0},initialOptions:{handler(e,t){JSON.stringify(t)!==JSON.stringify(e)&&(this.options=e,this.setIndex(this.defaultIndex))},deep:!0}},created(){const{defaultIndex:e,initialOptions:t}=this;this.set({currentIndex:e,options:t}).then(()=>{this.setIndex(e)})},mounted(){},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},getCount(){return this.options.length},set(e){return this.setData(e),new Promise(t=>B(t))},onTouchStart(e){this.setData({startY:e.touches[0].clientY,startOffset:this.offset,duration:0,touchStartTime:Date.now(),momentumOffset:this.offset})},onTouchMove(e){if(!e.touches[0])return;const t=e.touches[0].clientY-this.startY,s=I(this.startOffset+t,-(this.getCount()*this.itemHeight),this.itemHeight);this.setData({offset:s});const n=Date.now();n-this.touchStartTime>_&&(this.touchStartTime=n,this.momentumOffset=s)},getIndexByOffset(e){return I(Math.round(-e/this.itemHeight),0,this.getCount()-1)},momentum(e,t){const s=Math.abs(e/t),n=this.offset+s/.003*(e<0?-1:1),o=this.getIndexByOffset(n);this.setData({duration:+this.swipeDuration}),this.setIndex(o,!0)},onTouchEnd(){if(this.offset===this.startOffset)return;const e=this.offset-this.momentumOffset,t=Date.now()-this.touchStartTime;if(t<_&&Math.abs(e)>Q&&this.useMomentum){this.momentum(e,t);return}this.setData({duration:G});const n=this.getIndexByOffset(this.offset);this.setIndex(n,!0)},onClickItem(e){const{index:t}=e.currentTarget.dataset;this.setIndex(t,!0)},adjustIndex(e){const t=this.getCount();e=I(e,0,t);for(let s=e;s<t;s++)if(!this.isDisabled(this.options[s]))return s;for(let s=e-1;s>=0;s--)if(!this.isDisabled(this.options[s]))return s},isDisabled(e){return P(e)&&e.disabled},getOptionText(e){return P(e)&&this.valueKey in e?e[this.valueKey]:e},setIndex(e,t){e=this.adjustIndex(e)||0;const s=-e*this.itemHeight;return e!==this.currentIndex?this.set({offset:s,currentIndex:e}).then(()=>{t&&this.$emit("change",e)}):this.set({offset:s})},setValue(e){const{options:t}=this;for(let s=0;s<t.length;s++)if(this.getOptionText(t[s])===e)return this.setIndex(s);return Promise.resolve()},getValue(){return this.options[this.currentIndex]}}},Z={class:"press-picker-column-index"},$=["data-index"],ee=["innerHTML"];function te(e,t,s,n,o,i){return u(),l("div",Z,[a("div",{class:S(["press-picker-column",e.customClass]),style:m(i.columnStyle),onTouchstart:t[1]||(t[1]=(...r)=>i.onTouchStart&&i.onTouchStart(...r)),onTouchmove:t[2]||(t[2]=V((...r)=>i.onTouchMove&&i.onTouchMove(...r),["stop","prevent"])),onTouchend:t[3]||(t[3]=(...r)=>i.onTouchEnd&&i.onTouchEnd(...r)),onTouchcancel:t[4]||(t[4]=(...r)=>i.onTouchEnd&&i.onTouchEnd(...r))},[a("div",{style:m(i.wrapperStyle),class:"press-picker-column__wrapper"},[(u(!0),l(k,null,M(o.options,(r,h)=>(u(),l("div",{key:r.index,"data-index":h,style:m({height:`${s.itemHeight}px`,lineHeight:`${s.itemHeight}px`}),class:S(["press-ellipsis","press-picker-column__item",{"press-picker-column__item--disabled":r&&r.disabled,"press-picker-column__item--selected":h===o.currentIndex,activeClass:h===o.currentIndex}]),onClick:t[0]||(t[0]=(...g)=>i.onClickItem&&i.onClickItem(...g))},[o.computed.optionTextHtml(r)?(u(),l("div",{key:0,class:"press-picker-column__item-html",innerHTML:o.computed.optionTextHtml(r)},null,8,ee)):(u(),l(k,{key:1},[A(j(o.computed.optionText(r,s.valueKey)),1)],64))],14,$))),128))],4)],38)])}const se=w(W,[["render",te],["__scopeId","data-v-e2bf876b"]]),ne={title:{type:String,default:""},showToolbar:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},cancelButtonText:{type:String,default:T("picker.cancel")},confirmButtonText:{type:String,default:T("picker.confirm")},visibleItemCount:{type:Number,default:6},itemHeight:{type:[Number,String],default:44}};function ie(e){return d({height:c(e.itemHeight*e.visibleItemCount)})}function re(e){return d({"background-size":`100% ${c(e.itemHeight*(e.visibleItemCount-1)/2)}`})}function oe(e){return d({height:c(e.itemHeight)})}function ue(e){return Array.isArray(e)?e.length&&!e[0].values?[{values:e}]:e:[]}const p={columnsStyle:ie,frameStyle:oe,maskStyle:re,columns:ue},le={name:"PressPicker",options:{...H},components:{PressPickerPlusColumn:se,PressLoading:K,PressPickerPlusToolbar:R},mixins:[Y(N)],props:{...O,...ne,valueKey:{type:String,default:"text"},toolbarPosition:{type:String,default:"top"},defaultIndex:{type:Number,default:0},columns:{type:Array,default:()=>[]},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}},emits:["change","confirm","cancel"],data(){return{simple:!0,relationKey:`${Math.random()}`}},computed:{columnStyle(){const{itemHeight:e,visibleItemCount:t}=this;return p.columnsStyle({itemHeight:e,visibleItemCount:t})},maskStyle(){const{itemHeight:e,visibleItemCount:t}=this;return p.maskStyle({itemHeight:e,visibleItemCount:t})},frameStyle(){const{itemHeight:e}=this;return p.frameStyle({itemHeight:e})},computedColumns(){const{columns:e}=this;return p.columns(e)}},watch:{columns:{handler(e=[]){this.simple=e.length&&!e[0].values,Array.isArray(this.children)&&this.children.length&&this.setColumns().catch(()=>{})},immediate:!0}},beforeCreate(){},created(){this.children||(this.children=[])},mounted(){Array.isArray(this.children)&&this.children.length&&this.setColumns(!0).catch(()=>{})},methods:{noop(){},setColumns(e){const t=this.simple?[{values:this.columns}]:this.columns;if(e&&!t.find(o=>o.values&&o.values.length))return Promise.resolve();const s=t.map((n,o)=>this.setColumnValues(o,n.values));return Promise.all(s)},emit(e){const{type:t}=e.currentTarget.dataset;this.simple?this.$emit(t,{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit(t,{value:this.getValues(),index:this.getIndexes()})},onChange(e,t){this.simple?this.$emit("change",{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit("change",{value:this.getValues(),index:t})},getColumn(e){return this.children[e]},getColumnValue(e){const t=this.getColumn(e);return t&&t.getValue()},setColumnValue(e,t){const s=this.getColumn(e);return s==null?Promise.reject(new Error("setColumnValue: 对应列不存在")):s.setValue(t)},getColumnIndex(e){return(this.getColumn(e)||{}).currentIndex},setColumnIndex(e,t){const s=this.getColumn(e);return s==null?Promise.reject(new Error("setColumnIndex: 对应列不存在")):s.setIndex(t)},getColumnValues(e){return(this.children[e]||{}).options},setColumnValues(e,t,s=!0){const n=this.children[e];return n==null?Promise.reject(new Error("setColumnValues: 对应列不存在")):JSON.stringify(n.options)===JSON.stringify(t)?Promise.resolve():n.set({options:t}).then(()=>{s&&n.setIndex(0)})},getValues(){return this.children.map(e=>e.getValue())},setValues(e){const t=e.map((s,n)=>this.setColumnValue(n,s));return Promise.all(t)},getIndexes(){return this.children.map(e=>e.currentIndex)},setIndexes(e){const t=e.map((s,n)=>this.setColumnIndex(n,s));return Promise.all(t)},resetColumn(e,t=0){const s=this.getColumn(e);if(s==null)return Promise.reject(new Error("setColumnValue: 对应列不存在"));s.setIndex(t)}}},ae={class:"press-picker-index"},me={key:1,class:"press-picker__loading"};function ce(e,t,s,n,o,i){const r=C("PressPickerPlusToolbar"),h=C("PressLoading"),g=C("PressPickerPlusColumn");return u(),l("div",ae,[a("div",{class:S(["press-picker",e.customClass])},[s.toolbarPosition==="top"?(u(),x(r,{key:0,title:e.title,"show-toolbar":e.showToolbar,"cancel-button-text":e.cancelButtonText,"confirm-button-text":e.confirmButtonText,"custom-class":s.toolbarClass,onEmit:i.emit},null,8,["title","show-toolbar","cancel-button-text","confirm-button-text","custom-class","onEmit"])):v("",!0),e.loading?(u(),l("div",me,[L(h,{color:"#1989fa"})])):v("",!0),a("div",{class:"press-picker__columns",style:m(i.columnStyle),onTouchmove:t[0]||(t[0]=V((...f)=>i.noop&&i.noop(...f),["stop","prevent"]))},[(u(!0),l(k,null,M(i.computedColumns,(f,y)=>(u(),x(g,{ref_for:!0,ref:"pickerColumn",key:y,"relation-key":o.relationKey,class:"press-picker__column","data-index":y,"custom-class":s.columnClass,"value-key":s.valueKey,"initial-options":f.values,"default-index":f.defaultIndex||s.defaultIndex,"item-height":e.itemHeight,"visible-item-count":e.visibleItemCount,"active-class":s.activeClass,"use-momentum":s.useMomentum,"swipe-duration":s.swipeDuration,onChange:E=>i.onChange(E,y)},null,8,["relation-key","data-index","custom-class","value-key","initial-options","default-index","item-height","visible-item-count","active-class","use-momentum","swipe-duration","onChange"]))),128)),a("div",{class:"press-picker__mask",style:m(i.maskStyle)},null,4),a("div",{class:"press-picker__frame press-hairline--top-bottom",style:m(i.frameStyle)},null,4)],36),s.toolbarPosition==="bottom"?(u(),x(r,{key:2,"custom-class":s.toolbarClass},null,8,["custom-class"])):v("",!0)],2)])}const ye=w(le,[["render",ce],["__scopeId","data-v-141dd6a5"]]);export{ye as P,ne as p};
