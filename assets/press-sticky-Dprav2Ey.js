import{u}from"./utils-D0lA7q9W.js";import{s as p}from"./style-CpIyAjCl.js";import{a as d}from"./add-unit-DeNeB5nf.js";import{g as l,c as m}from"./rect-CXQTALcu.js";import{g as x}from"./validator-C_cgqHAw.js";import{B as y}from"./bind-event-CsCWoQ8E.js";import{d as S,a as D}from"./press-component-BmHMjgT0.js";import{_ as g,o as T,c as w,a as n,n as a,m as f,i as b}from"./index-VLx2MJJu.js";function _(t){return p({height:t.fixed?d(t.height):"","z-index":t.zIndex})}function z(t){return p({transform:t.transform?`translate3d(0, ${t.transform}px, 0)`:"",top:t.fixed?d(t.offsetTop):"","z-index":t.zIndex})}const c={containerStyle:_,wrapStyle:z},h=".press-sticky",k={name:"PressSticky",options:{...S},mixins:[y(function(t){this.scroller||(this.scroller=m(this.$el)),t(this.scroller,"scroll",this.onScroll,!0),t(this.scroller,"touchmove",this.onScroll,!0),this.onScroll()})],props:{...D,zIndex:{type:Number,default:99},offsetTop:{type:Number,default:0},disabled:{type:Boolean},container:{type:[Function,null],default:null},scrollTop:{type:[Number,null],default:null}},emits:["scroll"],data(){return{height:0,fixed:!1,transform:0,scrollTopData:this.scrollTop}},computed:{containerStyle(){const{fixed:t,height:e,zIndex:r}=this;return c.containerStyle({fixed:t,height:e,zIndex:r})},wrapStyle(){const{fixed:t,offsetTop:e,transform:r,zIndex:i}=this;return c.wrapStyle({fixed:t,offsetTop:e,transform:r,zIndex:i})},wrapClass(){const{fixed:t}=this;return u.bem2("sticky-wrap",{fixed:t})}},watch:{offsetTop:{handler(){this.onScroll()}},disabled:{handler(){this.onScroll()}},container:{handler(){this.onScroll()}},scrollTop:{handler(t){this.onScroll({scrollTop:t}),this.scrollTopData=t}}},created(){},mounted(){this.scrollTopData=this.scrollTop,this.onScroll()},methods:{setData(t){Object.keys(t).forEach(e=>{this[e]=t[e]})},onScroll({scrollTop:t}={}){const{container:e,offsetTop:r,disabled:i}=this;if(i){this.setDataAfterDiff({fixed:!1,transform:0});return}if(this.scrollTopData=t||this.scrollTopData,typeof e=="function"&&e()){Promise.all([l(this,h),this.getContainerRect()]).then(([s,o])=>{s&&o&&r+s.height>o.height+o.top?this.setDataAfterDiff({fixed:!1,transform:o.height-s.height}):s&&r>=s.top?this.setDataAfterDiff({fixed:!0,height:s.height,transform:0}):this.setDataAfterDiff({fixed:!1,transform:0})}).catch(s=>{console.warn("error",s)});return}l(this,h).then(s=>{x(s)&&(r>=s.top?(this.setDataAfterDiff({fixed:!0,height:s.height}),this.transform=0):this.setDataAfterDiff({fixed:!1}))})},setDataAfterDiff(t){this.$nextTick(()=>{const e=Object.keys(t).reduce((r,i)=>(t[i]!==this[i]&&(r[i]=t[i]),r),{});Object.keys(e).length>0&&this.setData(e),this.$emit("scroll",{scrollTop:this.scrollTopData,isFixed:t.fixed||this.fixed})})},getContainerRect(){const t=this.container();let e;const r=t.getBoundingClientRect();return e=Promise.resolve(r),e}}};function A(t,e,r,i,s,o){return T(),w("div",null,[n("div",{ref:"sticky",class:a(["press-sticky",t.customClass]),style:f(o.containerStyle)},[n("div",{class:a(o.wrapClass),style:f(o.wrapStyle)},[b(t.$slots,"default",{},void 0,!0)],6)],6)])}const v=g(k,[["render",A],["__scopeId","data-v-b2d25777"]]);export{v as P};
