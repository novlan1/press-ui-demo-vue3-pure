import{s as f}from"./style-CpIyAjCl.js";import{a as m,i as V}from"./add-unit-B8Dm0KXN.js";import{r as x}from"./number-CU9l-NjU.js";import{d as H,a as w}from"./press-component-D9D_j5DA.js";import{c as T}from"./parent-map-_1jD1UtF.js";import{t as j,n as A,a as D}from"./adapter-BgGMvpFJ.js";import{S as K}from"./scroll-view-gEPpO0v9.js";import{_ as P,o,c as l,a as u,m as c,F as B,y as E,n as C,t as y,w as O,d,r as b,b as _,f as M}from"./index-DfxNb_pP.js";import{P as Y}from"./press-loading-plus-bw9xFZF2.js";import{t as v}from"./index-Fgh2JTYb.js";function L(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function z(e,t){return L(e)&&e[t]!=null?e[t]:e}function F(e){return f({height:m(e.itemHeight*e.visibleItemCount)})}function R(e){const t=m(e.offset+e.itemHeight*(e.visibleItemCount-1)/2);return f({transition:`transform ${e.duration}ms`,"line-height":m(e.itemHeight),transform:`translate3d(0, ${t}, 0)`})}const S={optionText:z,rootStyle:F,wrapperStyle:R},U=200,J={name:"PressPickerColumn",options:{...H},mixins:[K],...j(T),props:{...w,activeClass:{type:String,default:""},valueKey:{type:String,default:""},className:{type:String,default:""},itemHeight:{type:Number,default:44},visibleItemCount:{type:Number,default:6},initialOptions:{type:Array,default:()=>[]},defaultIndex:{type:Number,default:0}},emits:["change"],data(){return{startY:0,offset:0,duration:0,startOffset:0,options:[],currentIndex:0,computed:S}},computed:{columnStyle(){const{itemHeight:e,visibleItemCount:t}=this;return S.rootStyle({itemHeight:e,visibleItemCount:t})},wrapperStyle(){const{offset:e,itemHeight:t,visibleItemCount:s,duration:r}=this;return S.wrapperStyle({offset:e,itemHeight:t,visibleItemCount:s,duration:r})}},watch:{defaultIndex:{handler(e){this.setIndex(e)},immediate:!0},initialOptions:{handler(e){this.options=e,this.setIndex(this.defaultIndex)},deep:!0}},created(){const{defaultIndex:e,initialOptions:t}=this;this.set({currentIndex:e,options:t}).then(()=>{this.setIndex(e)}),this[T].children.push(this)},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},getCount(){return this.options.length},set(e){return this.setData(e),new Promise(t=>A(t))},onTouchStart(e){this.setData({startY:e.touches[0].clientY,startOffset:this.offset,duration:0})},onTouchMove(e){if(!e.touches[0])return;const t=e.touches[0].clientY-this.startY;this.setData({offset:x(this.startOffset+t,-(this.getCount()*this.itemHeight),this.itemHeight)})},onTouchEnd(){if(this.offset!==this.startOffset){this.setData({duration:U});const e=x(Math.round(-this.offset/this.itemHeight),0,this.getCount()-1);this.setIndex(e,!0)}},onClickItem(e){const{index:t}=e.currentTarget.dataset;this.setIndex(t,!0)},adjustIndex(e){const t=this.getCount();e=x(e,0,t);for(let s=e;s<t;s++)if(!this.isDisabled(this.options[s]))return s;for(let s=e-1;s>=0;s--)if(!this.isDisabled(this.options[s]))return s},isDisabled(e){return V(e)&&e.disabled},getOptionText(e){return V(e)&&this.valueKey in e?e[this.valueKey]:e},setIndex(e,t){e=this.adjustIndex(e)||0;const s=-e*this.itemHeight;return e!==this.currentIndex?this.set({offset:s,currentIndex:e}).then(()=>{t&&this.$emit("change",e)}):this.set({offset:s})},setValue(e){const{options:t}=this;for(let s=0;s<t.length;s++)if(this.getOptionText(t[s])===e)return this.setIndex(s);return Promise.resolve()},getValue(){return this.options[this.currentIndex]}}},q={class:"press-picker-column-index"},G=["data-index"];function Q(e,t,s,r,a,n){return o(),l("div",q,[u("div",{class:C(["press-picker-column",e.customClass]),style:c(n.columnStyle),onTouchstart:t[1]||(t[1]=(...i)=>n.onTouchStart&&n.onTouchStart(...i)),onTouchmove:t[2]||(t[2]=O((...i)=>n.onTouchMove&&n.onTouchMove(...i),["stop","prevent"])),onTouchend:t[3]||(t[3]=(...i)=>n.onTouchEnd&&n.onTouchEnd(...i)),onTouchcancel:t[4]||(t[4]=(...i)=>n.onTouchEnd&&n.onTouchEnd(...i))},[u("div",{style:c(n.wrapperStyle)},[(o(!0),l(B,null,E(a.options,(i,h)=>(o(),l("div",{key:i.index,"data-index":h,style:c({height:`${s.itemHeight}px`,lineHeight:`${s.itemHeight}px`}),class:C(["press-ellipsis","press-picker-column__item",{"press-picker-column__item--disabled":i&&i.disabled,"press-picker-column__item--selected":h===a.currentIndex,activeClass:h===a.currentIndex}]),onClick:t[0]||(t[0]=(...k)=>n.onClickItem&&n.onClickItem(...k))},y(a.computed.optionText(i,s.valueKey)),15,G))),128))],4)],38)])}const W=P(J,[["render",Q],["__scopeId","data-v-9a127fe3"]]),X={props:{title:{type:String,default:""},showToolbar:Boolean,cancelButtonText:{type:String,default:v("picker.cancel")},confirmButtonText:{type:String,default:v("picker.confirm")},customClass:{type:String,default:""}},methods:{emit(...e){this.$emit("emit",...e)}}},Z={key:0,class:"press-picker__toolbar toolbar-class"},$={key:0,class:"press-picker__title press-ellipsis"};function ee(e,t,s,r,a,n){return o(),l("div",{class:C(["press-picker-toolbar",s.customClass])},[s.showToolbar?(o(),l("div",Z,[u("div",{class:"press-picker__cancel","hover-class":"press-picker__cancel--hover","hover-stay-time":"70","data-type":"cancel",onClick:t[0]||(t[0]=(...i)=>n.emit&&n.emit(...i))},y(s.cancelButtonText),1),s.title?(o(),l("div",$,y(s.title),1)):d("",!0),u("div",{class:"press-picker__confirm","hover-class":"press-picker__confirm--hover","hover-stay-time":"70","data-type":"confirm",onClick:t[1]||(t[1]=(...i)=>n.emit&&n.emit(...i))},y(s.confirmButtonText),1)])):d("",!0)],2)}const te=P(X,[["render",ee],["__scopeId","data-v-60141d0d"]]),se={title:{type:String,default:""},showToolbar:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},cancelButtonText:{type:String,default:v("picker.cancel")},confirmButtonText:{type:String,default:v("picker.confirm")},visibleItemCount:{type:Number,default:6},itemHeight:{type:[Number,String],default:44}};function ne(e){return f({height:m(e.itemHeight*e.visibleItemCount)})}function ie(e){return f({"background-size":`100% ${m(e.itemHeight*(e.visibleItemCount-1)/2)}`})}function re(e){return f({height:m(e.itemHeight)})}function oe(e){return Array.isArray(e)?e.length&&!e[0].values?[{values:e}]:e:[]}const g={columnsStyle:ne,frameStyle:re,maskStyle:ie,columns:oe},le={name:"PressPickerPlus",options:{...H},components:{PickerColumn:W,Loading:Y,ToolBar:te},...D(T),props:{...w,...se,valueKey:{type:String,default:"text"},toolbarPosition:{type:String,default:"top"},defaultIndex:{type:Number,default:0},columns:{type:Array,default:()=>[]},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""}},emits:["change","confirm","cancel"],data(){return{simple:!0}},computed:{columnStyle(){const{itemHeight:e,visibleItemCount:t}=this;return g.columnsStyle({itemHeight:e,visibleItemCount:t})},maskStyle(){const{itemHeight:e,visibleItemCount:t}=this;return g.maskStyle({itemHeight:e,visibleItemCount:t})},frameStyle(){const{itemHeight:e}=this;return g.frameStyle({itemHeight:e})},computedColumns(){const{columns:e}=this;return g.columns(e)}},watch:{columns:{handler(e=[]){this.simple=e.length&&!e[0].values,Array.isArray(this.children)&&this.children.length&&this.setColumns().catch(()=>{})},immediate:!0}},beforeCreate(){},created(){this.children=[]},mounted(){Array.isArray(this.children)&&this.children.length&&this.setColumns().catch(()=>{})},methods:{noop(){},setColumns(){const t=(this.simple?[{values:this.columns}]:this.columns).map((s,r)=>this.setColumnValues(r,s.values));return Promise.all(t)},emit(e){const{type:t}=e.currentTarget.dataset;this.simple?this.$emit(t,{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit(t,{value:this.getValues(),index:this.getIndexes()})},onChange(e,t){this.simple?this.$emit("change",{value:this.getColumnValue(0),index:this.getColumnIndex(0)}):this.$emit("change",{value:this.getValues(),index:t})},getColumn(e){return this.children[e]},getColumnValue(e){const t=this.getColumn(e);return t&&t.getValue()},setColumnValue(e,t){const s=this.getColumn(e);return s==null?Promise.reject(new Error("setColumnValue: 对应列不存在")):s.setValue(t)},getColumnIndex(e){return(this.getColumn(e)||{}).currentIndex},setColumnIndex(e,t){const s=this.getColumn(e);return s==null?Promise.reject(new Error("setColumnIndex: 对应列不存在")):s.setIndex(t)},getColumnValues(e){return(this.children[e]||{}).options},setColumnValues(e,t,s=!0){const r=this.children[e];return r==null?Promise.reject(new Error("setColumnValues: 对应列不存在")):JSON.stringify(r.options)===JSON.stringify(t)?Promise.resolve():r.set({options:t}).then(()=>{s&&r.setIndex(0)})},getValues(){return this.children.map(e=>e.getValue())},setValues(e){const t=e.map((s,r)=>this.setColumnValue(r,s));return Promise.all(t)},getIndexes(){return this.children.map(e=>e.currentIndex)},setIndexes(e){const t=e.map((s,r)=>this.setColumnIndex(r,s));return Promise.all(t)},resetColumn(e,t=0){const s=this.getColumn(e);if(s==null)return Promise.reject(new Error("setColumnValue: 对应列不存在"));s.setIndex(t)}}},ue={class:"press-picker-index"},ae={key:1,class:"press-picker__loading"};function ce(e,t,s,r,a,n){const i=b("ToolBar"),h=b("loading"),k=b("picker-column");return o(),l("div",ue,[u("div",{class:C(["press-picker",e.customClass])},[s.toolbarPosition==="top"?(o(),_(i,{key:0,title:e.title,"show-toolbar":e.showToolbar,"cancel-button-text":e.cancelButtonText,"confirm-button-text":e.confirmButtonText,"custom-class":s.toolbarClass,onEmit:n.emit},null,8,["title","show-toolbar","cancel-button-text","confirm-button-text","custom-class","onEmit"])):d("",!0),e.loading?(o(),l("div",ae,[M(h,{color:"#1989fa"})])):d("",!0),u("div",{class:"press-picker__columns",style:c(n.columnStyle),onTouchmove:t[0]||(t[0]=O((...p)=>n.noop&&n.noop(...p),["stop","prevent"]))},[(o(!0),l(B,null,E(n.computedColumns,(p,I)=>(o(),_(k,{ref_for:!0,ref:"pickerColumn",key:I,class:"press-picker__column","data-index":I,"custom-class":s.columnClass,"value-key":s.valueKey,"initial-options":p.values,"default-index":p.defaultIndex||s.defaultIndex,"item-height":e.itemHeight,"visible-item-count":e.visibleItemCount,"active-class":s.activeClass,onChange:N=>n.onChange(N,I)},null,8,["data-index","custom-class","value-key","initial-options","default-index","item-height","visible-item-count","active-class","onChange"]))),128)),u("div",{class:"press-picker__mask",style:c(n.maskStyle)},null,4),u("div",{class:"press-picker__frame press-hairline--top-bottom",style:c(n.frameStyle)},null,4)],36),s.toolbarPosition==="bottom"?(o(),_(i,{key:2,"custom-class":s.toolbarClass},null,8,["custom-class"])):d("",!0)],2)])}const Ie=P(le,[["render",ce],["__scopeId","data-v-f99f205c"]]);export{Ie as P,se as p};
