import{W as z,B as S}from"./color-DciZLlTH.js";import{c as B,g as E}from"./system-BAdrsxg_.js";import{i as L}from"./press-component-CjxC_Cwf.js";import{i as g,u as w}from"./utils-Do31p4kb.js";import{_ as V,r as m,o as c,c as u,a as n,v as N,y as M,F as x,t as f,b as T,n as h,u as _,f as a}from"./index-BapbWgDO.js";import{P as W}from"./press-button-DlU-xFsU.js";import"./add-unit-Df5pRFBE.js";import"./press-icon-plus-BHni9MA3.js";import"./press-info-fdIUeWSl.js";import"./press-loading-plus-BwizbpXU.js";import"./press-loading-Bc0gWeOb.js";import"./button-BaKXjqxg.js";function k(e){return Object.assign(e,{setStrokeStyle(t){e.strokeStyle=t},setLineWidth(t){e.lineWidth=t},setLineCap(t){e.lineCap=t},setFillStyle(t){e.fillStyle=t},setFontSize(t){e.font=String(t)},setGlobalAlpha(t){e.globalAlpha=t},setLineJoin(t){e.lineJoin=t},setTextAlign(t){e.textAlign=t},setMiterLimit(t){e.miterLimit=t},setShadow(t,r,i,s){e.shadowOffsetX=t,e.shadowOffsetY=r,e.shadowBlur=i,e.shadowColor=s},setTextBaseline(t){e.textBaseline=t},createCircularGradient(){},draw(){}})}let I=0;function U(e){return Math.min(Math.max(e,0),100)}const b=2*Math.PI,y=-Math.PI/2,C=1,F={name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:z},color:{type:null,default:S},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data(){return{hoverColor:S,id:1,isNotInUni:g()}},computed:{circleStyle(){const{size:e}=this;return`width: ${w.addUnit(e)};height: ${w.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})}}},created(){I+=1,this.id=I},mounted(){this.currentValue=this.value,this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:t}=this;if(g()){const i=window.devicePixelRatio,s=document.getElementById(this.canvasId),o=s.getContext("2d");return this.inited||(this.inited=!0,s.width=t*i,s.height=t*i,o.scale(i,i)),Promise.resolve(k(o))}if(e===""||!B()){const i=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(i)}const r=E().pixelRatio;return new Promise(i=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec(s=>{const o=s[0].node,l=o.getContext(e);this.inited||(this.inited=!0,o.width=t*r,o.height=t*r,l.scale(r,r)),i(k(l))})})},setHoverColor(){const{color:e,size:t}=this;return L(e)?this.getContext().then(r=>{const i=r.createLinearGradient(t,0,0,0);Object.keys(e).sort((s,o)=>parseFloat(s)-parseFloat(o)).map(s=>i.addColorStop(parseFloat(s)/100,e[s])),this.hoverColor=i}):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,t,r,i,s){const{strokeWidth:o,lineCap:l,clockwise:p,size:v}=this,d=v/2,P=d-o/2;e.setStrokeStyle(t),e.setLineWidth(o),e.setLineCap(l),e.beginPath(),e.arc(d,d,P,r,i,!p),e.stroke(),s&&(e.setFillStyle(s),e.fill())},renderLayerCircle(e){const{layerColor:t,fill:r}=this;this.presetCanvas(e,t,0,b,r)},renderHoverCircle(e,t){const{clockwise:r}=this,i=b*(t/100),s=r?y+i:3*Math.PI-(y+i);this.presetCanvas(e,this.hoverColor,y,s)},drawCircle(e){const{size:t}=this;this.getContext().then(r=>{r.clearRect(0,0,t,t),this.renderLayerCircle(r);const i=U(e);i!==0&&this.renderHoverCircle(r,i),r.draw()})},reRender(){const{value:e,speed:t}=this;if(t<=0||t>1e3){this.drawCircle(e);return}this.clearMockInterval(),this.currentValue=this.currentValue||0;const r=()=>{this.interval=setTimeout(()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<C?this.currentValue=e:this.currentValue<e?this.currentValue+=C:this.currentValue-=C,this.drawCircle(this.currentValue),r()):this.clearMockInterval()},1e3/t)};r()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},R={class:"press-circle-index"},A={class:"press-circle"},G=["id","type","canvas-id"],H={key:0,class:"press-circle__text"},D={key:0,class:"press-circle__text"};function O(e,t,r,i,s,o){const l=m("cover-view");return c(),u("div",R,[n("div",A,[n("canvas",{id:o.canvasId,class:"press-circle__canvas",type:r.type,style:N(o.circleStyle),"canvas-id":o.canvasId},null,12,G),r.text?(c(),u(x,{key:1},[s.isNotInUni?(c(),u("div",D,f(r.text),1)):(c(),T(l,{key:1,class:"press-circle__text"},{default:h(()=>[_(f(r.text),1)]),_:1}))],64)):(c(),u("div",H,[M(e.$slots,"default",{},void 0,!0)]))])])}const j=V(F,[["render",O],["__scopeId","data-v-ca0b97d2"]]),J={i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:j,PressButton:W},data(){return{value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}},methods:{onChangeCircleValue(e){if(e==="plus"){if(this.value>=100)return;this.value+=20}else if(e==="minus"){if(this.value<=0)return;this.value-=20}}}},Q={class:"demo-wrap demo-wrap--gray"},X={class:"demo-part"},Y={class:"demo-part"},$={class:"demo-part"},q={class:"demo-part"},K={class:"demo-part"};function Z(e,t,r,i,s,o){const l=m("press-circle"),p=m("demo-block"),v=m("press-button");return c(),u("div",Q,[a(p,{title:e.t("basicUsage"),"header-style":s.headerStyle,"section-style":s.sectionStyle},{default:h(()=>[a(l,{value:s.value,text:`${s.value}%`},null,8,["value","text"])]),_:1},8,["title","header-style","section-style"]),a(p,{title:e.t("customStyle"),"header-style":s.headerStyle,"section-style":s.sectionStyle},{default:h(()=>[n("div",X,[a(l,{value:s.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),n("div",Y,[a(l,{value:s.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),n("div",$,[a(l,{value:s.value,"stroke-width":6,color:s.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),n("div",q,[a(l,{value:s.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),n("div",K,[a(l,{value:s.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),n("div",null,[a(v,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:t[0]||(t[0]=d=>o.onChangeCircleValue("plus"))},{default:h(()=>[_(f(e.t("add")),1)]),_:1}),a(v,{type:"e-sport-primary",onClick:t[1]||(t[1]=d=>o.onChangeCircleValue("minus"))},{default:h(()=>[_(f(e.t("decrease")),1)]),_:1})])]),_:1},8,["title","header-style","section-style"])])}const he=V(J,[["render",Z],["__scopeId","data-v-9cde7cae"]]);export{he as default};
