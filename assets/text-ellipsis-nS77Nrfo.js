import{_ as A,y as b,c as T,o as w,H,a as M,t as S,A as R,r as C,e as d,h as x}from"./index-D8fxni52.js";let E=0;const j={name:"PressTextEllipsis",props:{rows:{type:[Number,String],default:1},dots:{type:String,default:"..."},content:{type:String,default:""},expandText:{type:String,default:""},collapseText:{type:String,default:""},position:{type:String,default:"end"},useActionSlot:{type:Boolean,default:!1},adjustString:{type:[Object,String],default:()=>({end:"a",start:"a",middle:"aa"})}},data(){return{text:this.content,expanded:!1,hasAction:!1,needRecalculate:!1,hideText:this.content,id:"hideDom-0"}},computed:{innerAdjustString(){return typeof this.adjustString=="string"?this.adjustString:this.adjustString[this.position]},hideStyle(){return b({position:"fixed",zIndex:"-9999",top:"-9999px",height:"auto",minHeight:"auto",maxHeight:"auto"})},actionText(){return this.expanded?this.collapseText:this.expandText}},watch:{content:{handler(e){this.calcEllipsised(),this.hideText=e}},rows:"calcEllipsised",position:"calcEllipsised"},mounted(){this.calcEllipsised(),E+=1,this.id=`hideDom-${E}`,this.useActionSlot&&setTimeout(()=>{this.calcEllipsised()}),window.addEventListener("resize",this.watchResize,{passive:!0}),window.addEventListener("orientationchange",this.watchResize,{passive:!0})},activated(){this.needRecalculate&&(this.needRecalculate=!1,this.calcEllipsised())},beforeDestroy(){this.onBeforeUnMount()},beforeUnmount(){this.onBeforeUnMount()},methods:{onBeforeUnMount(){window.removeEventListener("resize",this.watchResize),window.removeEventListener("orientationchange",this.watchResize)},watchResize(){this.calcEllipsised()},pxToNum(e){if(!e)return 0;const t=`${e}`.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},updateContainer(e,t,o){e[t]=o},getContainerHeight(e){let t;return t=Promise.resolve({offsetHeight:e.offsetHeight,paddingTop:e.style.paddingBottom,paddingBottom:e.style.paddingTop,lineHeight:e.style.lineHeight}),t},cloneContainer(){if(!this.$refs.root||!this.$refs.root.isConnected)return;const e=window.getComputedStyle(this.$refs.root),t=document.createElement("div");return Array.prototype.slice.apply(e).forEach(r=>{t.style.setProperty(r,e.getPropertyValue(r))}),t.style.position="fixed",t.style.zIndex="-9999",t.style.top="-9999px",t.style.height="auto",t.style.minHeight="auto",t.style.maxHeight="auto",t.innerText=this.content,document.body.appendChild(t),t},async calcEllipsisText(e,t){const{content:o,position:r,dots:s}=this,a=o.length,l=0+a>>1,m=(()=>{var i,n;return this.useActionSlot?((i=this.$refs.actionRef)==null?void 0:i.outerHTML)==null?"":(n=this.$refs.actionRef)==null?void 0:n.outerHTML:this.expandText})(),v=async()=>{const i=async(n,p)=>{if(p-n<=1)return r==="end"?o.slice(0,n)+s:s+o.slice(p,a);const c=Math.round((n+p)/2);let h="";r==="end"?h=o.slice(0,c)+s:h=s+o.slice(c,a),this.updateContainer(e,"innerText",h);let f=h+this.innerAdjustString;f=e.innerHTML+m,this.updateContainer(e,"innerHTML",f);const{offsetHeight:g}=await this.getContainerHeight(e);return g>t?r==="end"?await i(n,c):await i(c,p):r==="end"?await i(c,p):await i(n,c)};return await i(0,a)},y=async(i,n)=>{if(i[1]-i[0]<=1&&n[1]-n[0]<=1)return o.slice(0,i[0])+s+o.slice(n[1],a);const p=Math.floor((i[0]+i[1])/2),c=Math.ceil((n[0]+n[1])/2),h=this.content.slice(0,p)+this.dots+this.content.slice(c,a);this.updateContainer(e,"innerText",h);let f=h+this.innerAdjustString;f=e.innerHTML+m,this.updateContainer(e,"innerHTML",f);const{offsetHeight:g}=await this.getContainerHeight(e);return g>=t?await y([i[0],p],[c,n[1]]):await y([p,i[1]],[n[0],c])};return this.position==="middle"?await y([0,l],[l,a]):await v()},async calcEllipsised(){let e={offsetHeight:0,innerHTML:"",innerText:""};if(e=this.cloneContainer(),!e){this.needRecalculate=!0;return}const t=await this.getContainerHeight(e),{paddingBottom:o,paddingTop:r,lineHeight:s,offsetHeight:a}=t,l=Math.ceil((Number(this.rows)+.5)*this.pxToNum(s)+this.pxToNum(r)+this.pxToNum(o));l<a?(this.hasAction=!0,this.text=await this.calcEllipsisText(e,l)):(this.hasAction=!1,this.text=this.content),document.body.removeChild(e)},toggle(e=!this.expanded){this.expanded=e},onClickAction(e){this.toggle(),this.$emit("clickAction",e)},getHideDom(){return new Promise(e=>{uni.createSelectorQuery().in(this).select(`#${this.id}`).fields({size:!0,computedStyle:["lineHeight","paddingBottom","paddingTop"]},t=>{console.log("res",t),e(t)}).exec()})},updateHideText(e){this.hideText=e}}},I={ref:"root",class:"press-text-ellipsis"};function L(e,t,o,r,s,a){return w(),T("div",I,[H(S(s.expanded?o.content:s.text),1),s.hasAction?(w(),T("span",{key:0,ref:"actionRef",class:"press-text-ellipsis__action",onClick:t[0]||(t[0]=(...l)=>a.onClickAction&&a.onClickAction(...l))},[R(e.$slots,"action",{expanded:s.expanded},()=>[H(S(a.actionText),1)],!0)],512)):M("",!0)],512)}const N=A(j,[["render",L],["__scopeId","data-v-3c7da032"]]),k={i18n:{"zh-CN":{text:"慢慢来，不要急，生活给你出了难题，可也终有一天会给出答案。",text2:"似水流年是一个人所有的一切，只有这个东西，才真正归你所有。其余的一切，都是片刻的欢娱和不幸，转眼间就已跑到那似水流年里去了。",text3:"那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。",expandText:"展开",collapseText:"收起",expandCollapse:"展开/收起",customRows:"自定义展示行数",collapsePosition:"自定义省略位置",collapseStart:"头部省略",collapseMiddle:"中部省略",customAction:"自定义操作内容"},"en-US":{text:"Take your time and be patient. Life itself will eventually answer all those questions it once raised for you.",text2:"The fleeting time of one's life is everything that belongs to a person. Only this thing truly belongs to you. Everything else is just a momentary pleasure or misfortune, which will soon be gone with the passing of time.",text3:"That day, I turned twenty-one. In the golden age of my life, I was full of dreams. I wanted to love, to eat, and to instantly transform into one of these clouds, part alight, part darkened. It was only later that I understood life is but a slow, drawn-out process of getting your balls crushed. Day by day, you get older. Day by day, your dreams fade. In the end you are no different from a crushed ox. But I hadn't foreseen any of it on my twenty-first birthday. I thought I would be vigorous forever, and that nothing could ever crush me.",expandText:"expand",collapseText:"collapse",expandCollapse:"Expand/Collapse",customRows:"Customize Rows",collapsePosition:"Custom Collapse Position",collapseStart:"Head Area Collapse Position",collapseMiddle:"Middle Area Collapse Position",customAction:"Custom Action"}},components:{PressTextEllipsis:N},data(){return{headerStyle:"margin-top: 10px;"}},computed:{},mounted(){},methods:{}},z={class:"demo-wrap"};function B(e,t,o,r,s,a){const l=C("PressTextEllipsis"),u=C("demo-block");return w(),T("div",z,[d(u,{title:e.t("basicUsage")},{default:x(()=>[d(l,{content:e.t("text")},null,8,["content"])]),_:1},8,["title"]),d(u,{title:e.t("expandCollapse"),"header-style":s.headerStyle},{default:x(()=>[d(l,{"adjust-string":"aa",content:e.t("text2"),"expand-text":e.t("expandText"),"collapse-text":e.t("collapseText")},null,8,["content","expand-text","collapse-text"])]),_:1},8,["title","header-style"]),d(u,{title:e.t("customRows"),"header-style":s.headerStyle},{default:x(()=>[d(l,{rows:"3",content:e.t("text3"),"expand-text":e.t("expandText"),"collapse-text":e.t("collapseText"),"adjust-string":"aaaa"},null,8,["content","expand-text","collapse-text"])]),_:1},8,["title","header-style"]),d(u,{title:e.t("collapseStart"),"header-style":s.headerStyle},{default:x(()=>[d(l,{rows:"1","adjust-string":"aa",content:e.t("text3"),"expand-text":e.t("expandText"),"collapse-text":e.t("collapseText"),position:"start"},null,8,["content","expand-text","collapse-text"])]),_:1},8,["title","header-style"]),d(u,{title:e.t("collapseMiddle"),"header-style":s.headerStyle},{default:x(()=>[d(l,{rows:"2",content:e.t("text3"),"adjust-string":"aa","expand-text":e.t("expandText"),"collapse-text":e.t("collapseText"),position:"middle"},null,8,["content","expand-text","collapse-text"])]),_:1},8,["title","header-style"]),d(u,{title:e.t("customAction"),"header-style":s.headerStyle},{default:x(()=>[d(l,{content:e.t("text"),"use-action-slot":!0},{action:x(({expanded:m})=>[H(S(m?e.t("collapseText"):e.t("expandText")),1)]),_:1},8,["content"])]),_:1},8,["title","header-style"])])}const $=A(k,[["render",B]]);export{$ as default};
