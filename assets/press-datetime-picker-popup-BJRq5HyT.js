import{_ as $,m as x,U as H,l as N,r as D,c as k,o as C,e as b,ah as T,am as Y,u as I,x as _,an as F,a as M,j as B,b as E,t as S}from"./index-BMxCy5dw.js";import{P as A,p as R}from"./press-picker-plus-fKSQh7Nu.js";function j(e){const{year:t,month:n}=v(e);return`${t}/${n}`}const f=(e,t)=>e==="yearMonth"?j(t):t,g="yearMonth-day-hour-minute",P="yearMonth";function v(e){const t=e%12,n=parseInt(`${(e-t)/12}`,10);return t?{year:n,month:t}:{year:n-1,month:12}}const O=new Date().getFullYear();function z(e){return T(e)&&!isNaN(new Date(e).getTime())}function V(e,t,n){return Math.min(Math.max(e,t),n)}function l(e){return`00${e}`.slice(-2)}function L(e,t){let n=0;const a=Array(e<0?0:e);for(;n<e;)a[n]=t(n),n+=1;return a}function c(e){for(e===void 0&&(e="1");isNaN(parseInt(e,10));)e=e.slice(1);return parseInt(e,10)}function w(e,t){return 32-new Date(e,t-1,32).getDate()}const U={name:"PressDatetimePicker",options:{...x,styleIsolation:"shared"},components:{PressPicker:A},props:Object.assign(Object.assign({},R),{...N,value:{type:null},filter:{type:[Function,null],default:null},type:{type:String,default:"datetime"},showToolbar:{type:Boolean,default:!0},formatter:{type:[Function,null],default:f},minDate:{type:Number,default:new Date(O-10,0,1).getTime()},maxDate:{type:Number,default:new Date(O+10,11,31).getTime()},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},immediateCheck:{type:Boolean,default:!1},activeClass:{type:String,default:""},toolbarClass:{type:String,default:""},columnClass:{type:String,default:""},useMomentum:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3}}),emits:["input","input","cancel","confirm","input","change"],data(){return{innerValue:Date.now(),columns:[]}},watch:{value:{handler(){this.updateValue()}},type:{handler(){this.updateValue()}},minDate:{handler(){this.updateValue()}},maxDate:{handler(){this.updateValue()}},minHour:{handler(){this.updateValue()}},maxHour:{handler(){this.updateValue()}},minMinute:{handler(){this.updateValue()}},maxMinute:{handler(){this.updateValue()}}},mounted(){const e=this.correctValue(this.value);setTimeout(()=>{this.updateColumnValue(e,!1).then(({cb:t})=>{setTimeout(()=>{t()},300)}).then(()=>{this.immediateCheck?this.onChange():this.$emit("input",e)})},0)},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},set(e){return this.setData(e),new Promise(t=>H(t))},updateValue(){const e=this.correctValue(this.value),t=e===this.innerValue;this.updateColumnValue(e).then(()=>{t||this.$emit("input",e)})},getPicker(){if(this.picker==null){this.picker=this.$refs.pressPicker;const{picker:e}=this,{setColumnValues:t}=e;e.setColumnValues=(...n)=>t.apply(e,[...n,!1])}return this.picker},updateColumns(){const e=this.formatter||f,t=this.getOriginColumns().map(n=>({values:n.values.map(a=>e(n.type,a,this.innerValue))}));return this.set({columns:t})},getOriginColumns(){const{filter:e,innerValue:t}=this;return this.getRanges().map(({type:a,range:r})=>{let i=L(r[1]-r[0]+1,o=>{const u=r[0]+o;return a==="year"||a===P?`${u}`:l(u)});return e&&(i=e(a,i,t)),{type:a,values:i}})},getRanges(){if(this.type==="time")return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:n,maxHour:a,maxMinute:r,maxYearMonth:i}=this.getBoundary("max",this.innerValue),{minYear:o,minDate:u,minMonth:s,minHour:m,minMinute:h,minYearMonth:p}=this.getBoundary("min",this.innerValue),d=[{type:"year",range:[o,e]},{type:"month",range:[s,n]},{type:"day",range:[u,t]},{type:"hour",range:[m,a]},{type:"minute",range:[h,r]}];return this.type==="date"&&d.splice(3,2),this.type==="year-month"&&d.splice(2,3),this.type===g?[{type:P,range:[p,i]},{type:"day",range:[u,t]},{type:"hour",range:[m,a]},{type:"minute",range:[h,r]}]:d},correctValue(e){const t=this.type!=="time";if(t&&!z(e))e=this.minDate;else if(!t&&!e){const{minHour:n}=this;e=`${l(n)}:00`}if(!t){let[n,a]=e.split(":");return n=l(V(n,this.minHour,this.maxHour)),a=l(V(a,this.minMinute,this.maxMinute)),`${n}:${a}`}return e=Math.max(e,this.minDate),e=Math.min(e,this.maxDate),e},getBoundary(e,t){const n=new Date(t),a=new Date(this[`${e}Date`]),r=a.getFullYear();let i=1,o=1,u=0,s=0;e==="max"&&(i=12,o=w(n.getFullYear(),n.getMonth()+1),u=23,s=59),n.getFullYear()===r&&(i=a.getMonth()+1,n.getMonth()+1===i&&(o=a.getDate(),n.getDate()===o&&(u=a.getHours(),n.getHours()===u&&(s=a.getMinutes()))));const m=r*12+i;return{[`${e}Year`]:r,[`${e}Month`]:i,[`${e}Date`]:o,[`${e}Hour`]:u,[`${e}Minute`]:s,[`${e}YearMonth`]:m}},onCancel(){this.$emit("cancel")},onConfirm(){this.$emit("confirm",this.innerValue)},onChange(){let e;const t=this.getPicker(),n=this.getOriginColumns();if(this.type==="time"){const a=t.getIndexes();e=`${+n[0].values[a[0]]}:${+n[1].values[a[1]]}`}else{const r=t.getIndexes().map((p,d)=>n[d].values[p]);let i=c(r[0]),o=c(r[1]);const u=w(i,o);let s=c(r[2]);this.type==="year-month"&&(s=1),s=s>u?u:s;let m=0,h=0;if(this.type==="datetime"&&(m=c(r[3]),h=c(r[4])),this.type===g){const p=v(r[0]);i=p.year,o=p.month,s=c(r[1]),m=c(r[2]),h=c(r[3])}e=new Date(i,o-1,s,m,h)}e=this.correctValue(e),this.updateColumnValue(e).then(()=>{this.$emit("input",e),this.$emit("change",t)})},updateColumnValue(e,t=!0){let n=[];const{type:a,innerValue:r}=this,i=this.formatter||f,o=this.getPicker();if(a==="time"){const s=e.split(":");n=[i("hour",s[0],r),i("minute",s[1])]}else{const s=new Date(e);n=[i("year",`${s.getFullYear()}`,r),i("month",l(s.getMonth()+1),r)],a==="date"&&n.push(i("day",l(s.getDate()),r)),a==="datetime"&&n.push(i("day",l(s.getDate()),r),i("hour",l(s.getHours()),r),i("minute",l(s.getMinutes()),r)),a===g&&(n=[i(P,s.getFullYear()*12+s.getMonth()+1,r),i("day",l(s.getDate()),r),i("hour",l(s.getHours()),r),i("minute",l(s.getMinutes()),r)])}const u=()=>o.setValues(n);return t?this.set({innerValue:e}).then(()=>this.updateColumns()).then(()=>u()):this.set({innerValue:e}).then(()=>(this.updateColumns(),{values:n,cb:u}))}}},q={class:"press-datetime-picker-index"};function Z(e,t,n,a,r,i){const o=D("PressPicker");return C(),k("div",q,[b(o,{ref:"pressPicker",class:"press-datetime-picker","active-class":e.activeClass,"toolbar-class":e.toolbarClass,"column-class":e.columnClass,title:e.title,columns:r.columns,"item-height":e.itemHeight,"show-toolbar":e.showToolbar,"visible-item-count":e.visibleItemCount,"confirm-button-text":e.confirmButtonText,"cancel-button-text":e.cancelButtonText,"use-momentum":e.useMomentum,"swipe-duration":e.swipeDuration,onChange:i.onChange,onConfirm:i.onConfirm,onCancel:i.onCancel},null,8,["active-class","toolbar-class","column-class","title","columns","item-height","show-toolbar","visible-item-count","confirm-button-text","cancel-button-text","use-momentum","swipe-duration","onChange","onConfirm","onCancel"])])}const G=$(U,[["render",Z]]);let y;const J={...F,datetimePicker:{type:Object,default:()=>({})},tip:{type:String,default:""}},K={name:"PressDatetimePickerPopup",options:{..._(!0,!1)},components:{PressPopup:I,PressDatetimePicker:G},mixins:[Y(J)],props:{},emits:[],data(){return{currentValue:this.getPropOrData("datetimePicker.value")}},computed:{immediateCheck(){return this.getPropOrData("datetimePicker.immediateCheck")||!0}},watch:{},created(){y=this},mounted(){},methods:{noop(){},emitEvent(e){const t={context:this,value:this.currentValue};this.$emit(e),this.promiseCallback(e,t)},confirm(){this.emitEvent("confirm")},cancel(){this.emitEvent("cancel")},onInput(e){var t;this.currentValue=e,(t=this.getPropOrData("datetimePicker.input"))==null||t(e)},timeFilter(e,t,n){const a=y.getPropOrData("datetimePicker.filter")||null;return a?a(e,t,n):t},timeFormatter(e,t,n){const a=y.getPropOrData("datetimePicker.formatter")||null;return a?a(e,t,n):t}}},Q={key:0,class:"press-datetime-picker-popup"},W={class:"press-datetime-picker-popup__picker"},X={key:0,class:"press-datetime-picker-popup__tip"};function ee(e,t,n,a,r,i){const o=D("PressDatetimePicker"),u=D("PressPopup");return e.innerShow?(C(),k("div",Q,[b(u,{"show-title":e.getPropOrData("showTitle"),"close-icon":e.getPropOrData("closeIcon"),"arrow-icon":e.getPropOrData("arrowIcon"),title:e.getPropOrData("title"),button:e.getPropOrData("button"),"border-button":e.getPropOrData("borderButton"),"z-index":e.getPropOrData("zIndex"),"popup-class":e.getPropOrData("popupClass"),"close-on-click-overlay":e.getPropOrData("closeOnClickOverlay"),"custom-style":e.getPropOrData("customStyle"),onConfirm:i.confirm,onCancel:i.cancel},{default:B(()=>[E("div",W,[b(o,{ref:"picker",value:e.getPropOrData("datetimePicker.value"),"show-toolbar":e.getPropOrData("datetimePicker.showToolbar")||!1,"item-height":e.getPropOrData("datetimePicker.itemHeight")||56,type:e.getPropOrData("datetimePicker.type")||"datetime","max-date":e.getPropOrData("datetimePicker.maxDate"),"min-date":e.getPropOrData("datetimePicker.minDate"),"immediate-check":i.immediateCheck,formatter:i.timeFormatter,filter:i.timeFilter,onInput:i.onInput},null,8,["value","show-toolbar","item-height","type","max-date","min-date","immediate-check","formatter","filter","onInput"])]),e.tip?(C(),k("div",X,S(e.tip),1)):M("",!0)]),_:1},8,["show-title","close-icon","arrow-icon","title","button","border-button","z-index","popup-class","close-on-click-overlay","custom-style","onConfirm","onCancel"])])):M("",!0)}const ie=$(K,[["render",ee],["__scopeId","data-v-1392abe8"]]);export{G as P,ie as a,f as d,v as g};
