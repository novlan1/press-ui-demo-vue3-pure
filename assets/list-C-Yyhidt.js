import{_ as w,k as B,ag as x,a7 as M,l as N,U,y as z,r as c,d as H,o as g,h as m,b as n,A as p,a as v,B as u,e as h,H as O,t as L,n as D,P as R,az as F,c as S,F as K,j as G}from"./index-Q-rLfHSZ.js";import{g as y,f as j,d as W}from"./rect-DC6GBRy5.js";import{B as Y}from"./bind-event-DNeD-BxK.js";import{S as q}from"./scroll-view-d6qms1vU.js";import{P as J}from"./press-picker-plus-D8bQhMBx.js";import{s as Q,a as _,F as X}from"./helper-CYbRUfga.js";import{i as Z}from"./utils-Bnosij7X.js";const T="scrollViewId",k=j(T),$={name:"PressList",options:{...N},components:{PressLoading:M},mixins:[x,Y(function(e){this.autoCheckScroller&&(this.scroller||(this.scroller=W(this.$el)),e(this.scroller,"scroll",this.onScroll,!0),e(this.scroller,"touchmove",this.onScroll,!0),this.onScroll())}),q],props:{offset:{type:[Number,String],default:50},finished:{type:Boolean,default:!1},finishedText:{type:String,default:""},loadingText:{type:String,default:"加载中..."},immediateCheck:{type:Boolean,default:!0},enableFlex:{type:Boolean,default:!1},enhanced:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},enablePassive:{type:Boolean,default:!1},scrollAnchoring:{type:Boolean,default:!1},scrollToElementById:{type:String,default:""},vertical:{type:Boolean,default:!0},loadingStyle:{type:String,default:""},loadingSize:{type:String,default:"20px"},finishedStyle:{type:String,default:""},autoCheckScroller:{type:Boolean,default:!1},scrollLeft:{type:[Number,String],default:0},scrollTop:{type:[Number,String],default:0},...B,customStyle:{type:[String,Object],default:""}},emits:["scroll","input","load","update:modelValue"],data(){return{innerLoading:this.realModelValue,SCROLL_VIEW_ID:T,scrollerHeight:0}},computed:{scrollViewClass(){return["press-list",this.vertical?"press-list--vertical":"press-list--hor",this.customClass].join(" ")},scrollViewStyle(){return z([{height:"100%"},this.customStyle])}},watch:{realModelValue:{handler(e){this.innerLoading=e,this.check()}},finished:"check"},mounted(){this.immediateCheck&&this.check()},updated(){},methods:{getScrollerHeight(){this.scrollerHeight||y(this,k).then(e=>{this.scrollerHeight=e.height})},scroll(e){this.getScrollerHeight(),this.$emit("scroll",e,this.scrollerHeight),this.check()},scrollToLower(){this.emitInput()},emitInput(){this.innerLoading||this.finished||(this.innerLoading=!0,this.emitModelValue(!0),this.$emit("load"))},check(){U(()=>{this.innerCheck()})},innerCheck(){if(!this.autoCheckScroller){this.commonCheck();return}},commonCheck(e){const{offset:t}=this;this.innerLoading||this.finished||Promise.all([y(this,".press-list__placeholder"),y(this,k)]).then(l=>{const{0:i,1:s}=l;if(e===void 0&&(e=s),this.innerLoading||this.finished||!(e.bottom-e.top))return;let o=i.bottom-e.bottom;this.vertical||(o=i.right-e.right),o<=t&&this.emitInput()}).catch(()=>{}).finally(()=>{})},onScroll(){const{scroller:e,autoCheckScroller:t}=this;if(!t)return;let l;e!=null&&e.getBoundingClientRect&&(l=e.getBoundingClientRect()),this.commonCheck(l)}}},ee={class:"press-list__layout"};function te(e,t,l,i,s,r){const o=c("PressLoading"),d=c("scroll-view");return g(),H(d,{id:s.SCROLL_VIEW_ID,style:u(r.scrollViewStyle),"scroll-y":l.vertical,"scroll-x":!l.vertical,"scroll-with-animation":l.scrollWithAnimation,"scroll-anchoring":l.scrollAnchoring,enhanced:l.enhanced,"enable-flex":l.enableFlex,"enable-passive":l.enablePassive,"lower-threshold":l.offset,"scroll-into-view":l.scrollToElementById,class:D(r.scrollViewClass),"scroll-top":l.scrollTop,"scroll-left":l.scrollLeft,onScrolltolower:r.scrollToLower,onScroll:r.scroll},{default:m(()=>[n("div",ee,[p(e.$slots,"default",{},void 0,!0),s.innerLoading?p(e.$slots,"loading",{key:0},()=>[n("div",{class:"press-list__loading",style:u(l.loadingStyle)},[h(o,{vertical:!l.vertical,size:l.loadingSize},{default:m(()=>[O(L(l.loadingText),1)]),_:1},8,["vertical","size"])],4)],!0):v("",!0),l.finishedText&&l.finished?p(e.$slots,"finished",{key:1},()=>[n("div",{class:"press-list__finished",style:u(l.finishedStyle)},[n("div",null,L(l.finishedText),1)],4)],!0):v("",!0),t[0]||(t[0]=n("div",{class:"press-list__placeholder"},null,-1))])]),_:3},8,["id","style","scroll-y","scroll-x","scroll-with-animation","scroll-anchoring","enhanced","enable-flex","enable-passive","lower-threshold","scroll-into-view","class","scroll-top","scroll-left","onScrolltolower","onScroll"])}const le=w($,[["render",te],["__scopeId","data-v-a6e4b2e1"]]),a={pageSize:20,total:300,delay:200,vertical:!0,autoCheckScroller:!0},C=Array.from({length:5}).map((e,t)=>10**t).reduce((e,t)=>{for(let l=1;l<10;l++)e.push(t*l);return e},[]).map(e=>({label:e,value:e})),I=C.reduce((e,t)=>(e[t.value]=t.label,e),{}),A=Array.from({length:1e3}).map((e,t)=>({label:`${(t+1)*100}ms`,value:(t+1)*100})),ie=A.reduce((e,t)=>(e[t.value]=t.label,e),{});function se({context:e,callback:t}){Q({context:e,title:"自定义设置",closeIcon:!0,cellList:[{label:"每次加载数量",value:I[a.pageSize],click:({context:l})=>{l.closeDialog(),_({title:"每次加载数量",closeIcon:!0,list:C,current:{value:a.pageSize},context:e}).then(({item:i})=>{a.pageSize=i.value,e.onGTip("设置成功"),typeof t.changePageSize=="function"&&t.changePageSize.call(e,i.value)}).catch(()=>{})}},{label:"列表总数",value:I[a.total],click:({context:l})=>{l.closeDialog(),_({title:"列表总数",closeIcon:!0,list:C,current:{value:a.total},context:e}).then(({item:i})=>{a.total=i.value,e.onGTip("设置成功"),typeof t.changeTotal=="function"&&t.changeTotal.call(e,i.value)}).catch(()=>{})}},{label:"数据请求时间",value:ie[a.delay],click:({context:l})=>{l.closeDialog(),_({title:"数据请求时间",closeIcon:!0,list:A,current:{value:a.delay},context:e}).then(({item:i})=>{a.delay=i.value,e.onGTip("设置成功"),typeof t.changeDelay=="function"&&t.changeDelay.call(e,i.value)}).catch(()=>{})}},{label:"是否竖向滚动",type:"switch",open:a.vertical,click:({context:l})=>{l.closeDialog(),a.vertical=!a.vertical,e.onGTip("设置成功"),typeof t.changeDirection=="function"&&t.changeDirection.call(e,a.vertical)}},{label:"自动检测 Scroller",type:"switch",open:a.autoCheckScroller,click:({context:l})=>{l.closeDialog(),a.autoCheckScroller=!a.autoCheckScroller,typeof t.changeAutoCheckScroller=="function"&&t.changeAutoCheckScroller.call(e,a.autoCheckScroller)}}]})}let oe=!1;try{const e={};Object.defineProperty(e,"passive",{get(){return oe=!0,!0}}),window.addEventListener("test-passive",()=>{},e)}catch{}function re(e){var t,l,i;return Z()?{value:((t=e==null?void 0:e.target)==null?void 0:t.value)||"",scrollTop:(l=e==null?void 0:e.target)==null?void 0:l.scrollTop,scrollHeight:(i=e==null?void 0:e.target)==null?void 0:i.scrollHeight}:e.detail}const P=50,ae=500,ne=(e=ae)=>({data(){return{currentIndex:0,useVirtualList:!0}},computed:{upMissed(){const{currentIndex:t}=this;return Math.max(0,t-e)},showingData(){const{currentIndex:t,upMissed:l,list:i,useVirtualList:s}=this;return s?i.slice(l,t+e).map((r,o)=>({...r,uniqueKey:o+l})):i},hiddenUpPartStyle(){const{upMissed:t,useVirtualList:l}=this;return l?`height: ${t*P}px;`:""},wrapStyle(){const{list:t,useVirtualList:l}=this;return l?`height: ${t.length*P}px;`:""}},methods:{updateCurrentIndex(t,l){const{scrollTop:i,scrollHeight:s}=re(t);if(i<0||l+i>s)return;const r=Math.round(i/P);this.currentIndex=r}}});function ce({length:e,delay:t,beforeLength:l}){return new Promise(i=>{setTimeout(()=>{i({data:Array.from({length:e}).map((s,r)=>{let o=r+l+1;return o<10&&(o=`0${o}`),{label:o,value:o}})})},t||0)})}const he={i18n:{"zh-CN":{custom:"自定义"},"en-US":{custom:"Custom"}},components:{PressList:le,PressPopupPlusCell:F,PressPickerPlus:J,PressCell:R},mixins:[ne()],data(){const e={...a};return{sectionStyle:"margin: 0;background: #f7f8fa;",headerStyle:"background: #f7f8fa;",loading:!1,finished:!1,immediateCheck:!0,list:[],FUNCTIONAL_ID_MAP:X,listLocal:e,listStyle:""}},computed:{},watch:{listLocal:{handler(e){e.vertical||(this.useVirtualList=!1)},deep:!0}},mounted(){},methods:{load(){console.log("[load]"),this.onFetchData()},scroll(e,t){this.updateCurrentIndex(e,t)},onFetchData(e){var s;const{total:t,pageSize:l,delay:i}=this.listLocal;ce({delay:i,length:l,beforeLength:e?0:((s=this.list)==null?void 0:s.length)||0}).then(({data:r})=>{let o=e?r:[...this.list,...r];o.length>t&&(o=o.slice(0,t)),this.list=o,console.log("[current total]",o.length),this.loading=!1,this.finished=this.list.length>=t}).catch(()=>{})},onShowBasicPopupCell(){se({context:this,callback:{changeTotal:this.changeTotal,changePageSize:this.changePageSize,changeDelay:this.changeDelay,changeDirection:this.changeDirection,changeAutoCheckScroller:this.changeAutoCheckScroller}})},changePageSize(e){this.listLocal={...this.listLocal,pageSize:e},this.generateData()},changeTotal(e){this.listLocal={...this.listLocal,total:e},this.generateData()},changeDelay(e){this.listLocal={...this.listLocal,delay:e},this.generateData()},changeDirection(e){this.listLocal={...this.listLocal,vertical:e},this.generateData()},changeAutoCheckScroller(e){this.listLocal={...this.listLocal,autoCheckScroller:e},this.list=[],this.generateData()},generateData(){this.loading=!0,this.onFetchData(!0)}}},ue={class:"demo-container"};function de(e,t,l,i,s,r){const o=c("PressCell"),d=c("demo-block"),b=c("PressList"),E=c("PressPopupPlusCell"),V=c("PressPickerPlus");return g(),S("div",{class:D(["demo-wrap demo-wrap--gray demo-wrap--flex",s.listLocal.vertical?"":"demo-wrap--hor"])},[h(d,{title:e.t("basicUsage"),"section-style":s.sectionStyle,"header-style":s.headerStyle},{default:m(()=>[h(o,{title:e.t("custom"),"is-link":"",onClick:r.onShowBasicPopupCell},null,8,["title","onClick"])]),_:1},8,["title","section-style","header-style"]),n("div",ue,[h(b,{modelValue:s.loading,"onUpdate:modelValue":t[0]||(t[0]=f=>s.loading=f),finished:s.finished,"immediate-check":s.immediateCheck,vertical:s.listLocal.vertical,"finished-text":"没有更多了","auto-check-scroller":s.listLocal.autoCheckScroller,"custom-style":s.listStyle,onLoad:r.load,onScroll:r.scroll},{default:m(()=>[n("div",{style:u(e.wrapStyle),class:"list__wrap"},[n("div",{style:u(e.hiddenUpPartStyle)},null,4),(g(!0),S(K,null,G(e.showingData,f=>(g(),S("div",{key:f.value,class:"list__item"},L(f.label),1))),128))],4)]),_:1},8,["modelValue","finished","immediate-check","vertical","auto-check-scroller","custom-style","onLoad","onScroll"])]),h(E,{id:s.FUNCTIONAL_ID_MAP.POPUP_CELL,ref:s.FUNCTIONAL_ID_MAP.POPUP_CELL,mode:"functional"},null,8,["id"]),h(V,{id:s.FUNCTIONAL_ID_MAP.PICKER,ref:s.FUNCTIONAL_ID_MAP.PICKER,mode:"functional"},null,8,["id"])],2)}const Pe=w(he,[["render",de],["__scopeId","data-v-49b77077"]]);export{Pe as default};
