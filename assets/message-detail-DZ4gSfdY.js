import{P as w}from"./press-loading-plus-BbOWp1Vm.js";import{g as G}from"./scroll-DZ_Dh06R.js";import{g as S}from"./rect-ZZRvyvMD.js";import{g as I}from"./event-DUjdombs.js";import{_ as A,r as k,o as a,c as l,f as C,n as L,a as i,v as T,F as M,i as P,t as n,w as g,d as _,x as p,p as H,e as R}from"./index-DU6LSpJC.js";import{P as N}from"./press-message-board-input-CxUtopZN.js";import{a as u}from"./data-B5yhOwAp.js";import{a as V,b as B}from"./index-B17f7L1L.js";import"./utils-Do31p4kb.js";import"./add-unit-Df5pRFBE.js";import"./press-component-BYCAM0Tw.js";import"./validator-CMi1mmGD.js";import"./system-BAdrsxg_.js";import"./support-passive-CNRHRm4O.js";const X={TIME:"TIME",EXCHANGE_TEXT:"EXCHANGE_TEXT",MESSAGE_TEXT:"MESSAGE_TEXT",EXCHANGE_CARD:"EXCHANGE_CARD"},x={SCROLL_VIEW_ID:"tipMatchMsgWrap",MESSAGE_ITEM_PREFIX:"msgDetailItem-"},y=G(x.SCROLL_VIEW_ID),O={name:"PressMessageDetail",components:{PressLoadingPlus:w},props:{loading:{type:Boolean,default:!1},list:{type:Array,default:()=>[]},placeHolderTop:{type:Number,default:()=>0},offset:{type:Number,default:300}},emits:["onScroll","touchMove","clickPic","clickAvatar","checkDetail","reSend","agreeExchangeCard","goSetCardPage","makePhoneCall","clickCopy","loadMore"],data(){return{MESSAGE_TYPE_MAP:X,SELECTOR_MAP:x,scrollY:!0,scrollWithAnimation:!0,scrollTop:0,innerLoading:this.loading,scrollerHeight:0,placeHolderStyle:""}},computed:{reversedList(){const e=[...this.list];return e.reverse(),e}},watch:{loading(e){this.innerLoading=e},list:{handler(){},deep:!0,immediate:!0}},methods:{scroll(e){this.$emit("onScroll",e),this.watchScrollTop(e)},touchmove(e){this.$emit("touchMove",e)},clickPic(e,t){this.$emit("clickPic",e,t)},clickAvatar(e){this.$emit("clickAvatar",e)},checkDetail(e,t){this.$emit("checkDetail",e,t)},reSend(e){this.$emit("reSend",e)},agreeExchangeCard(e){this.$emit("agreeExchangeCard",e)},goSetCardPage(e){this.$emit("goSetCardPage",e)},makePhoneCall(e,t,d){this.$emit("makePhoneCall",e,t,d)},clickCopy(e,t,d,h){this.$emit("clickCopy",e,t,d,h)},scrollToBottom(){var t;if(!((t=this.list)!=null&&t.length))return;const e=document.querySelector(y);e&&(e.scrollTop=0)},getScrollerHeight(){return this.scrollerHeight?Promise.resolve(this.scrollerHeight):new Promise(e=>{S(this,y).then(t=>{this.scrollerHeight=t.height,e(t.height)})})},watchScrollTop(e){var h;if(!((h=this.list)!=null&&h.length)||this.innerLoading)return;const{scrollTop:t,scrollHeight:d}=I(e)||{};this.getScrollerHeight().then(c=>{t+c>d-this.offset&&this.$emit("loadMore")})},setPlaceholderHeight(){this.$nextTick(()=>{Promise.all([S(this,".press-message-detail__scroll-view"),S(this,".press-message-detail__layout")]).then(e=>{const{0:t,1:d}=e,h=t.height-d.height;h>0?this.placeHolderStyle=`height: ${h}px;`:this.placeHolderStyle="height: 0"})})}}},b=e=>(H("data-v-9a0c118e"),e=e(),R(),e),W={class:"press-message-detail"},Y={class:"press-message-detail__layout"},F=["id"],U={key:0,class:"press-message-item__time"},$={key:1},z={class:"press-message-item__tip"},q={key:0,class:"press-message-item__tip"},K=b(()=>i("span",null,"根据您的设置，自动同意了交换名片，",-1)),j=["onClick"],J=["onClick"],Q=["src","onClick"],Z=["onClick"],ee={key:0,class:"press-message-item__title"},se={class:"press-message-item__content"},te={class:"press-message-item__content__item"},oe=["onClick"],ae=["onClick"],le=["onClick"],ie={class:"press-message-item-card__title"},re={class:"press-message-item-card__title__main"},ce={class:"press-message-item-card__title__desc"},ne={class:"press-message-item-card__main"},_e={class:"press-message-card__user"},de=["src"],he={class:"press-message-card__user-meta"},ge={class:"press-message-card__user-name"},pe={class:"press-message-card__user-desc"},me={class:"press-message-card__contact"},ue={class:"press-message-card__contact__value"},ke={key:0,class:"press-message-card__contact__tip"},Ce=["href","onClick"],Ee=["onClick"],ve=["onClick"],Se={key:1,class:"press-message-card__contact__btn press-message-card__contact__btn--disable"},Te={key:0,class:"press-message-detail__loading"},Me=b(()=>i("div",{class:"press-message-detail__scrollbar"},null,-1));function Pe(e,t,d,h,c,o){const E=k("press-loading-plus"),v=k("scroll-view");return a(),l("div",W,[C(v,{id:c.SELECTOR_MAP.SCROLL_VIEW_ID,"scroll-y":c.scrollY,"enable-flex":"true",enhanced:"true",class:"press-message-detail__scroll-view","scroll-with-animation":c.scrollWithAnimation,"enable-passive":!1,onScroll:o.scroll,onTouchmove:o.touchmove},{default:L(()=>[i("div",{class:"press-message-detail__placeholder",style:T(c.placeHolderStyle)},null,4),i("div",Y,[(a(!0),l(M,null,P(o.reversedList,s=>(a(),l("div",{id:`${c.SELECTOR_MAP.MESSAGE_ITEM_PREFIX}${s.id}`,key:s.id,class:"press-message-item"},[s.messageType===c.MESSAGE_TYPE_MAP.TIME?(a(),l("p",U,n(s.text||""),1)):s.messageType===c.MESSAGE_TYPE_MAP.EXCHANGE_TEXT?(a(),l("div",$,[i("p",z,n(s.text||""),1),s.showAutoAgreeExchangeCardText?(a(),l("p",q,[K,i("span",{class:"press-message-item__tip__btn",onClick:g(r=>o.goSetCardPage(s),["stop"])},"设置>",8,j)])):_("",!0)])):s.messageType===c.MESSAGE_TYPE_MAP.MESSAGE_TEXT?(a(),l("div",{key:2,class:p(["press-message-item__box",s.isMine?"press-message-item__box--right":""])},[i("div",{class:"press-message-item__box__avatar",style:T(s.avatar?`background-image: url(${s.avatar})`:""),onClick:g(r=>o.clickAvatar(s),["stop"])},null,12,J),s.picUrl?(a(),l("img",{key:0,mode:"widthFix",class:"press-message-item__box__img",src:s.picUrl,onClick:r=>o.clickPic(s.picUrl,s)},null,8,Q)):(a(),l("div",{key:1,class:p(["press-message-item__box__popover",s.isMine?"press-message-item__box__popover--right":"press-message-item__box__popover--left"]),onClick:g(r=>o.reSend(s),["stop"])},[s.title?(a(),l("div",ee,n(s.title),1)):_("",!0),i("div",se,[i("div",te,[(a(!0),l(M,null,P(s.textList,r=>(a(),l("div",{key:r.key},n(r.value),1))),128))]),s.link?(a(),l("span",{key:0,class:"press-message-item__content__link",onClick:g(r=>o.checkDetail(s.link,s),["stop"])}," 查看详情 ",8,oe)):_("",!0)])],10,Z)),s.isCustomFail?(a(),l("p",{key:2,class:"press-message-status",onClick:g(r=>o.reSend(s),["stop"])}," ❗️ ",8,ae)):s.isMine?(a(),l("p",{key:3,class:p(["press-message-status",s.isPeerRead?"press-message-status--read":"press-message-status--unread"])},n(s.isPeerRead?"已读":"未读"),3)):_("",!0)],2)):s.messageType===c.MESSAGE_TYPE_MAP.EXCHANGE_CARD?(a(),l("div",{key:3,class:p(["press-message-item__box",s.isMine?"press-message-item__box--right":""])},[i("div",{class:"press-message-item__box__avatar",style:T(s.avatar?`background-image: url(${s.avatar})`:""),onClick:g(r=>o.clickAvatar(s),["stop"])},null,12,le),i("div",{class:p(["press-message-item-card",s.isMine?"press-message-item-card--right":"press-message-item-card--left",s.isOwner?"press-message-item-card--owner":""])},[i("div",ie,[i("p",re,n(s.cardTip||""),1),i("p",ce,n(s.cardDesc||""),1)]),i("div",ne,[i("div",_e,[i("img",{class:"press-message-card__avatar",src:s.avatar},null,8,de),i("div",he,[i("div",ge,n(s.nick),1),i("div",pe,n(s.userGradeDesc),1)])]),i("div",me,[(a(!0),l(M,null,P(s.cardContactList,r=>(a(),l("div",{key:r.key,class:"press-message-card__contact__item"},[i("div",{class:p(["iconfont",r.icon||""])},null,2),i("div",ue,n(r.value||""),1),r.tip?(a(),l("span",ke,n(r.tip),1)):_("",!0),r.showPhoneCallLink?(a(),l("a",{key:1,class:"press-message-card__contact__tag",href:`tel:${r.phone}`,onClick:g(D=>o.makePhoneCall(r.phone,r,s),["stop"])}," 拨打 ",8,Ce)):_("",!0),r.showCopy||r.showCopyInMp?(a(),l("span",{key:2,id:"message-wx-copy2",class:"press-message-card__contact__tag",onClick:g(D=>o.clickCopy("#message-wx-copy2",r.copyValue,r,s),["stop"])}," 复制 ",8,Ee)):_("",!0)]))),128)),s.showAgreeExchangeCardButton?(a(),l("div",{key:0,class:"press-message-card__contact__btn",onClick:g(r=>o.agreeExchangeCard(s),["stop"])}," 同意交换 ",8,ve)):s.showExchangedCardButton?(a(),l("div",Se," 已交换 ")):_("",!0)])])],2)],2)):_("",!0)],8,F))),128)),c.innerLoading?(a(),l("div",Te,[C(E,{size:"16px",color:"rgba(0,0,0,0.7)"})])):_("",!0)])]),_:1},8,["id","scroll-y","scroll-with-animation","onScroll","onTouchmove"]),Me])}const ye=A(O,[["render",Pe],["__scopeId","data-v-9a0c118e"]]);function f(e=0){return[u[0],{...u[1],textList:[{value:e+1,key:729218}]},...u.slice(2)]}function fe(){return u.slice(0,2)}function Ae(e){let t=V;return t=B,t(`${e}`)}const xe="pressMessageDetail";let m;const be={components:{PressMessageDetail:ye,PressMessageBoardInput:N},data(){let e=0;return e=44,{list:[],msgContent:"",pressMessageDetailRef:xe,loading:!1,placeHolderTop:e,loadTime:0}},computed:{sendBtnEnable(){return!!(this.msgContent&&this.msgContent.trim().length>0)}},mounted(){this.list=f(this.loadTime),setTimeout(()=>{m=this.$refs[this.pressMessageDetailRef],m==null||m.scrollToBottom()})},methods:{clickInput(){var e;this.onGTip("Click Input"),(e=this.$refs[this.pressMessageDetailRef])==null||e.scrollToBottom()},sendMsg(){console.log("[sendMsg]",this.msgContent),this.onGTip(this.msgContent)},onScroll(){},touchMove(){},clickAvatar(...e){console.log("[clickAvatar]",...e),this.onGTip("[EVENT] clickAvatar list will change"),setTimeout(()=>{this.list=fe(),this.loadTime=12},1e3)},clickPic(...e){console.log("[clickPic]",...e),this.onGTip("[EVENT] clickPic")},makePhoneCall(...e){console.log("[makePhoneCall]",...e),this.onGTip("[EVENT] makePhoneCall"),uni.makePhoneCall({phoneNumber:`${e[0]}`,success(t){console.log("success",t)},fail(t){console.log("fail",t)}})},goSetCardPage(...e){console.log("[goSetCardPage]",...e),this.onGTip("[EVENT] goSetCardPage")},reSend(...e){console.log("[reSend]",...e),this.onGTip("[EVENT] reSend")},checkDetail(...e){console.log("[checkDetail]",...e),this.onGTip("[EVENT] checkDetail")},agreeExchangeCard(...e){console.log("[agreeExchangeCard]",...e),this.onGTip("[EVENT] agreeExchangeCard")},clickCopy(e,t){Ae(t).then(()=>{this.onGTip("复制成功")}).catch(()=>{this.onGTip("复制失败")})},loadMore(){this.loading||this.loadTime>10||(this.loading=!0,this.loadTime+=1,setTimeout(()=>{this.list=[...f(this.loadTime).map(e=>({...e,id:`${e.id}-${Math.random()}`})),...this.list],console.log("[loadMore] current total",this.list.length),this.loading=!1},1e3))}}},De={class:"demo-wrap demo-wrap--flex demo-wrap--gray"},we={class:"demo-list-wrap"},Ge={class:"demo-input-wrap"};function Ie(e,t,d,h,c,o){const E=k("PressMessageDetail"),v=k("PressMessageBoardInput");return a(),l("div",De,[i("div",we,[C(E,{ref:c.pressMessageDetailRef,list:c.list,loading:c.loading,"place-holder-top":c.placeHolderTop,onOnScroll:o.onScroll,onTouchMove:o.touchMove,onClickAvatar:o.clickAvatar,onClickPic:o.clickPic,onMakePhoneCall:o.makePhoneCall,onGoSetCardPage:o.goSetCardPage,onReSend:o.reSend,onCheckDetail:o.checkDetail,onAgreeExchangeCard:o.agreeExchangeCard,onClickCopy:o.clickCopy,onLoadMore:o.loadMore},null,8,["list","loading","place-holder-top","onOnScroll","onTouchMove","onClickAvatar","onClickPic","onMakePhoneCall","onGoSetCardPage","onReSend","onCheckDetail","onAgreeExchangeCard","onClickCopy","onLoadMore"])]),i("div",Ge,[C(v,{modelValue:c.msgContent,"onUpdate:modelValue":t[0]||(t[0]=s=>c.msgContent=s),"send-btn-enable":o.sendBtnEnable,onClickInput:o.clickInput,onSendMsg:o.sendMsg},null,8,["modelValue","send-btn-enable","onClickInput","onSendMsg"])])])}const qe=A(be,[["render",Ie]]);export{qe as default};
