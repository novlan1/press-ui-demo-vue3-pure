import{aP as D,i as L,_ as A,u as M,a7 as B,v as V,x as N,y as T,r as x,c,o as u,b as R,a as f,F as P,j as E,A as q,w as S,B as w,n as G,e as d,t as C,d as z,h as p}from"./index-D8fxni52.js";import{i as j,f as H,p as W,v as X}from"./test-CXO-MJ-T.js";const K={props:{accept:{type:String,default:"image"},capture:{type:[String,Array],default:()=>["album","camera"]},compressed:{type:Boolean,default:!0},camera:{type:String,default:"back"},maxDuration:{type:Number,default:60},uploadIcon:{type:String,default:"photograph"},uploadIconColor:{type:String,default:"#D3D4D6"},useBeforeRead:{type:Boolean,default:!1},afterRead:{type:Function,default:null},beforeRead:{type:Function,default:null},previewFullImage:{type:Boolean,default:!0},maxCount:{type:[String,Number],default:52},disabled:{type:Boolean,default:!1},imageMode:{type:String,default:"aspectFill"},name:{type:String,default:"file"},sizeType:{type:Array,default:()=>["original","compressed"]},multiple:{type:Boolean,default:!1},deletable:{type:Boolean,default:!0},maxSize:{type:[String,Number],default:Number.MAX_VALUE},fileList:{type:Array,default:()=>[]},uploadText:{type:String,default:""},width:{type:[String,Number],default:80},height:{type:[String,Number],default:80},previewImage:{type:Boolean,default:!0},customStyle:{type:[String,Object],default:""}}},J={watch:{accept:{immediate:!0,handler(e){(e==="all"||e==="media")&&console.warn("只有微信小程序才支持把 accept 配置为 all、media 之一")}}}},{hasOwnProperty:Q}=Object.prototype;function Y(e,t){return Q.call(e,t)}const b={};function F(e){for(const a in b)if(Y(b,a)&&b[a]===e)return a;const t=(window.URL||window.webkitURL).createObjectURL(e);return b[t]=e,t}function O(e){(window.URL||window.webkitURL).revokeObjectURL(e),delete b[e]}function U(e,t){const a=[],l=e.target.files.length;for(let s=0;s<l;s++){const i=e.target.files[s];let n;Object.defineProperty(i,"path",{get(){return n=n||F(i),n}}),s<t&&a.push(i)}return a}const Z={image:{jpg:"jpeg",jpe:"jpeg",pbm:"x-portable-bitmap",pgm:"x-portable-graymap",pnm:"x-portable-anymap",ppm:"x-portable-pixmap",psd:"vnd.adobe.photoshop",pic:"x-pict",rgb:"x-rgb",svg:"svg+xml",svgz:"svg+xml",tif:"tiff",xif:"vnd.xiff",wbmp:"vnd.wap.wbmp",wdp:"vnd.ms-photo",xbm:"x-xbitmap",ico:"x-icon"},video:{"3g2":"3gpp2","3gp":"3gpp",avi:"x-msvideo",f4v:"x-f4v",flv:"x-flv",jpgm:"jpm",jpgv:"jpeg",m1v:"mpeg",m2v:"mpeg",mpe:"mpeg",mpg:"mpeg",mpg4:"mpeg",m4v:"x-m4v",mkv:"x-matroska",mov:"quicktime",qt:"quicktime",movie:"x-sgi-movie",mp4v:"mp4",ogv:"ogg",smv:"x-smv",wm:"x-ms-wm",wmv:"x-ms-wmv",wmx:"x-ms-wmx",wvx:"x-ms-wvx"}},$="*";function ee(){const e=window.navigator.userAgent.toLowerCase();return!!(e.match(/MicroMessenger/i)&&e.match(/MicroMessenger/i)[0]==="micromessenger")}function I({count:e,sourceType:t,type:a,extension:l=["*"]}){const s=document.createElement("input");return s.type="file",D(s,{position:"absolute",visibility:"hidden","z-index":-999,width:0,height:0,top:0,left:0}),s.accept=l.map(i=>{if(a!==$){const n=i.replace(".","");return`${a}/${Z[a][n]||n}`}return ee()?".":i.indexOf(".")===0?i:`.${i}`}).join(","),e>1&&(s.multiple="multiple"),t.length===1&&t[0]==="camera"&&(s.capture="camera"),s}let h=null;function te({count:e,sourceType:t,type:a,extension:l,success:s}){h&&(document.body.removeChild(h),h=null),h=I({count:e,sourceType:t,type:a,extension:l}),document.body.appendChild(h),h.addEventListener("change",i=>{const n=U(i,e);s({errMsg:"chooseFile:ok",get tempFilePaths(){return n.map(({path:o})=>o)},tempFiles:n})}),h.click()}let g=null;function ie({count:e,sourceType:t,extension:a,success:l}){g&&(document.body.removeChild(g),g=null),g=I({count:e,sourceType:t,extension:a,type:"image"}),document.body.appendChild(g),g.addEventListener("change",s=>{const i=U(s,e);l({errMsg:"chooseImage:ok",get tempFilePaths(){return i.map(({path:r})=>r)},tempFiles:i})}),g.click()}let v=null;function se({sourceType:e,extension:t,success:a}){v&&(document.body.removeChild(v),v=null),v=I({sourceType:e,extension:t,type:"video"}),document.body.appendChild(v),v.addEventListener("change",l=>{const s=l.target.files[0],i={errMsg:"chooseVideo:ok",tempFile:s,size:s.size,duration:0,width:0,height:0,name:s.name};let n;Object.defineProperty(i,"tempFilePath",{get(){return n=n||F(this.tempFile),n}});const r=document.createElement("video");if(r.onloadedmetadata!==void 0){const o=F(s);r.onloadedmetadata=function(){O(o),a(Object.assign(i,{duration:r.duration||0,width:r.videoWidth||0,height:r.videoHeight||0}))},setTimeout(()=>{r.onloadedmetadata=null,O(o),a(i)},300),r.src=o}else a(i)}),v.click()}function ae({count:e,success:t,fail:a,type:l}){if(L())return te({count:e,sourceType:[],type:l,extension:["*"],success:t});uni.chooseFile({count:e,type:l,success:t,fail:a})}function le({count:e,sourceType:t,sizeType:a,success:l,fail:s}){if(L())return ie({count:e,sourceType:t,extension:["*"],success:l});uni.chooseImage({count:e,sourceType:t,sizeType:a,success:l,fail:s})}function oe({sourceType:e,success:t,fail:a,compressed:l,maxDuration:s,camera:i}){if(L())return se({sourceType:e,extension:["*"],success:t});uni.chooseVideo({sourceType:e,success:t,fail:a,compressed:l,maxDuration:s,camera:i})}function ne(e){return e.tempFiles}function re(e){return e.tempFiles}function de({accept:e,multiple:t,capture:a,compressed:l,maxDuration:s,sizeType:i,camera:n,maxCount:r}){return new Promise((o,y)=>{switch(e){case"image":le({count:t?Math.min(r,9):1,sourceType:a,sizeType:i,success:m=>o(ne(m)),fail:y});break;case"video":oe({sourceType:a,compressed:l,maxDuration:s,camera:n,success:m=>o(m),fail:y});break;default:ae({count:t?r:1,type:"all",success:m=>o(re(m)),fail:y})}})}const ue={name:"PressUploader",options:{...N(!0,!1),styleIsolation:"shared"},components:{PressIcon:V,PressLoading:B},mixins:[J,K],emits:["chooseFile","beforeRead","afterRead","oversize","clickPreview","delete","error"],data(){return{lists:[],isInCount:!0,isNotInUni:L()}},computed:{wrapStyle(){return T(this.customStyle)}},watch:{fileList:{immediate:!0,handler(){this.formatFileList()}}},methods:{addUnit:M,formatFileList(){const{fileList:e=[],maxCount:t}=this,a=e.map(l=>Object.assign(Object.assign({},l),{isImage:this.accept==="image"||j(l.url||l.thumb),isVideo:this.accept==="video"||X(l.url||l.thumb),deletable:typeof l.deletable=="boolean"?l.deletable:this.deletable}));this.lists=a,this.isInCount=a.length<t},chooseFile(){const{maxCount:e,multiple:t,lists:a,disabled:l}=this;if(this.$emit("chooseFile",l),l)return;let s;try{s=Array.isArray(this.capture)?this.capture:this.capture.split(",")}catch{s=[]}de(Object.assign({accept:this.accept,multiple:this.multiple,capture:s,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-a.length})).then(i=>{this.onBeforeRead(t?i:i[0])}).catch(i=>{this.$emit("error",i)})},onBeforeRead(e){const{beforeRead:t,useBeforeRead:a}=this;let l=!0;H(t)&&(l=t(e,this.getDetail())),a&&(l=new Promise((s,i)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:n=>{n?s():i()}}))})),l&&(W(l)?l.then(s=>this.onAfterRead(s||e)):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:e??this.fileList.length}},onAfterRead(e){const{maxSize:t,afterRead:a}=this;if(Array.isArray(e)?e.some(s=>s.size>t):e.size>t){this.$emit("oversize",Object.assign({file:e},this.getDetail()));return}typeof a=="function"&&a(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail()))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e){!e.isImage||!this.previewFullImage||uni.previewImage({urls:this.lists.filter(t=>this.accept==="image"||j(t.url||t.thumb)).map(t=>t.url||t.thumb),current:e.url||e.thumb,fail(){}})},onPreviewVideo(e){if(!this.data.previewFullImage)return;const{index:t}=e.currentTarget.dataset,{lists:a}=this.data;wx.previewMedia({sources:a.map(l=>Object.assign(Object.assign({},l),{type:"video"})),current:t,fail(){}})},onClickPreview(e){const{index:t}=e.currentTarget.dataset,a=this.data.lists[t];this.$emit("clickPreview",Object.assign(Object.assign({},a),this.getDetail(t)))}}},ce={class:"press-upload__wrap"},pe=["src","mode","onClick"],me=["src","mode","onClick"],fe={key:1,class:"press-upload__wrap__preview__other"},he={class:"press-upload__wrap__preview__other__text"},ge={key:2,class:"press-upload__status"},ve={class:"press-upload__status__icon"},ye={key:0,class:"press-upload__status__message"},_e=["onClick"];const be=["hover-class"],we={key:0,class:"press-upload__button__text"};function ke(e,t,a,l,s,i){const n=x("PressIcon"),r=x("PressLoading");return u(),c("div",{class:"press-upload",style:w(i.wrapStyle)},[R("div",ce,[e.previewImage?(u(!0),c(P,{key:0},E(s.lists,(o,y)=>(u(),c("div",{key:y,class:"press-upload__wrap__preview"},[o.isImage||o.type&&o.type==="image"?(u(),c(P,{key:0},[s.isNotInUni?(u(),c("img",{key:0,src:o.thumb||o.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:w([{width:i.addUnit(e.width),height:i.addUnit(e.height)}]),onClick:m=>i.onPreviewImage(o)},null,12,pe)):(u(),c("image",{key:1,src:o.thumb||o.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:w([{width:i.addUnit(e.width),height:i.addUnit(e.height)}]),onClick:m=>i.onPreviewImage(o)},null,12,me))],64)):(u(),c("div",fe,[d(n,{color:"#80CBF9",size:"26",name:o.isVideo||o.type&&o.type==="video"?"movie":"folder"},null,8,["name"]),R("span",he,C(o.isVideo||o.type&&o.type==="video"?"视频":"文件"),1)])),o.status==="uploading"||o.status==="failed"?(u(),c("div",ge,[R("div",ve,[o.status==="failed"?(u(),z(n,{key:0,name:"close",color:"#ffffff",size:"22"})):(u(),z(r,{key:1,size:"22",mode:"circle",color:"#ffffff"}))]),o.message?(u(),c("span",ye,C(o.message),1)):f("",!0)])):f("",!0),o.status!=="uploading"&&(e.deletable||o.deletable)?(u(),c("div",{key:3,class:"press-upload__deletable",onClick:S(m=>i.deleteItem(y),["stop"])},[d(n,{name:"cross",color:"#ffffff",size:"16","custom-class":"press-upload__deletable__icon"})],8,_e)):f("",!0),(o.status,f("",!0))]))),128)):f("",!0),s.isInCount?(u(),c(P,{key:1},[e.$slots.default||e.$slots.$default?(u(),c("div",{key:0,onClick:t[0]||(t[0]=(...o)=>i.chooseFile&&i.chooseFile(...o))},[q(e.$slots,"default",{},void 0,!0)])):(u(),c("div",{key:1,class:G(["press-upload__button",[e.disabled&&"press-upload__button--disabled"]]),"hover-class":e.disabled?"":"press-upload__button--hover","hover-stay-time":"150",style:w([{width:i.addUnit(e.width),height:i.addUnit(e.height)}]),onClick:t[1]||(t[1]=S((...o)=>i.chooseFile&&i.chooseFile(...o),["stop"]))},[d(n,{name:e.uploadIcon,size:"26",color:e.uploadIconColor,onClick:i.chooseFile},null,8,["name","color","onClick"]),e.uploadText?(u(),c("span",we,C(e.uploadText),1)):f("",!0)],14,be))],64)):f("",!0)])],4)}const Re=A(ue,[["render",ke],["__scopeId","data-v-41f02580"]]),_="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_a17f94292a34e9f644.jpeg";let k;const xe={i18n:{"zh-CN":{uploadVideo:"上传视频",uploadStatus:"上传状态",preview:"文件预览",maxCount:"限制上传数量",maxSize:"限制上传大小",customStyle:"自定义上传样式",beforeRead:"上传前置处理"},"en-US":{uploadVideo:"Upload Video",uploadStatus:"Upload Status",preview:"Preview",maxCount:"Max Count",maxSize:"Max Size",customStyle:"Custom Style",beforeRead:"Before Read"}},components:{PressUploader:Re},data(){return{fileList1:[],fileListMaxSize:[],fileList2:[],fileList3:[{url:_}],fileList4:[{url:_},{url:_}],fileList6:[],fileListStatus:[{url:_,status:"uploading",message:"上传中..."},{url:_,status:"failed",message:"上传失败"}]}},mounted(){k=this},methods:{deletePic(e){console.log("[deletePic] event",e),this[`fileList${e.name}`].splice(e.index,1)},async afterRead(e){console.log("[afterRead] event",e);const t=`fileList${e.name}`,a=[].concat(e.file);let l=this[t].length;a.map(s=>{this[t].push({...s,status:"uploading",message:"上传中"})});for(let s=0;s<a.length;s++){const i=await this.uploadFilePromise(a[s].path),n=this[t][l];this[t].splice(l,1,Object.assign(n,{message:"",...i})),this[t]=this[t].map(r=>({...r})),l+=1}},uploadFilePromise(e){return console.log("[uploadFilePromise] url",e),new Promise(t=>{setTimeout(()=>t({url:e,status:"success",message:"上传失败"}),1e3)})},onOversize(e){console.log("[onOversize] file",e),k.onGTip("文件大小不能超过 500kb")},beforeRead(e){return console.log("[beforeRead] file",e),e.type!=="image/jpeg"?(k.onGTip("请上传 jpg 格式图片"),!1):!0},asyncBeforeRead(e){return console.log("[asyncBeforeRead] file",e),new Promise((t,a)=>{if(e.type!=="image/jpeg")k.onGTip("请上传 jpg 格式图片"),a();else{const l=new File(["foo"],"bar.jpg",{type:"image/jpeg"});t(l)}})}}},Le={class:"demo-wrap"};function Pe(e,t,a,l,s,i){const n=x("PressUploader"),r=x("demo-block");return u(),c("div",Le,[d(r,{title:e.t("basicUsage")},{default:p(()=>[d(n,{"file-list":s.fileList1,name:"1",multiple:"","max-count":10,onAfterRead:i.afterRead,onDelete:i.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("uploadVideo")},{default:p(()=>[d(n,{"file-list":s.fileList2,name:"2",multiple:"","max-count":10,accept:"video",onAfterRead:i.afterRead,onDelete:i.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("uploadStatus")},{default:p(()=>[d(n,{"file-list":s.fileListStatus,name:"Status",multiple:"","max-count":10,accept:"video",onAfterRead:i.afterRead,onDelete:i.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("preview")},{default:p(()=>[d(n,{"file-list":s.fileList3,name:"3",multiple:"","max-count":10,"preview-full-image":!0,onAfterRead:i.afterRead,onDelete:i.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("maxCount")},{default:p(()=>[d(n,{"file-list":s.fileList4,name:"4",multiple:"","max-count":2,onAfterRead:i.afterRead,onDelete:i.deletePic},null,8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("maxSize")},{default:p(()=>[d(n,{"file-list":s.fileListMaxSize,name:"MaxSize",multiple:"","max-size":500*1024,onAfterRead:i.afterRead,onOversize:i.onOversize},null,8,["file-list","onAfterRead","onOversize"])]),_:1},8,["title"]),d(r,{title:e.t("customStyle")},{default:p(()=>[d(n,{"file-list":s.fileList6,name:"6",multiple:"","max-count":1,width:"250",height:"150",onAfterRead:i.afterRead,onDelete:i.deletePic},{default:p(()=>t[0]||(t[0]=[R("img",{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_799718017ac81b11c0.png",mode:"widthFix",style:{width:"250px",height:"150px"},width:"250px",height:"150px"},null,-1)])),_:1},8,["file-list","onAfterRead","onDelete"])]),_:1},8,["title"]),d(r,{title:e.t("beforeRead")},{default:p(()=>[d(n,{"before-read":i.beforeRead},null,8,["before-read"])]),_:1},8,["title"]),d(r,{title:e.t("disabled")},{default:p(()=>[d(n,{disabled:""})]),_:1},8,["title"])])}const Ie=A(xe,[["render",Pe]]);export{Ie as default};
