import{W as z,B as _}from"./color-DciZLlTH.js";import{_ as P,O as g,E as S,T as E,U as N,V as b,o as c,c as d,a as n,l as B,h as M,F as T,t as m,N as U,e as a,k as p,r as f,G as k}from"./index-DccXyPO9.js";import{a as w}from"./canvas-DG8Ww8fk.js";let I=0;function W(e){return Math.min(Math.max(e,0),100)}const x=2*Math.PI,y=-Math.PI/2,C=1,L={name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:z},color:{type:null,default:_},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data(){return{hoverColor:_,id:1,isNotInUni:g()}},computed:{circleStyle(){const{size:e}=this;return`width: ${S.addUnit(e)};height: ${S.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})}}},created(){I+=1,this.id=I},mounted(){this.currentValue=this.value,this.setHoverColor().then(()=>{this.drawCircle(this.currentValue)})},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:s}=this;if(g()){const i=window.devicePixelRatio,t=document.getElementById(this.canvasId),o=t.getContext("2d");return this.inited||(this.inited=!0,t.width=s*i,t.height=s*i,o.scale(i,i)),Promise.resolve(w(o))}if(e===""||!E()){const i=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(i)}const r=N().pixelRatio;return new Promise(i=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec(t=>{const o=t[0].node,l=o.getContext(e);this.inited||(this.inited=!0,o.width=s*r,o.height=s*r,l.scale(r,r)),i(w(l))})})},setHoverColor(){const{color:e,size:s}=this;return b(e)?this.getContext().then(r=>{const i=r.createLinearGradient(s,0,0,0);Object.keys(e).sort((t,o)=>parseFloat(t)-parseFloat(o)).map(t=>i.addColorStop(parseFloat(t)/100,e[t])),this.hoverColor=i}):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,s,r,i,t){const{strokeWidth:o,lineCap:l,clockwise:h,size:v}=this,u=v/2,V=u-o/2;e.setStrokeStyle(s),e.setLineWidth(o),e.setLineCap(l),e.beginPath(),e.arc(u,u,V,r,i,!h),e.stroke(),t&&(e.setFillStyle(t),e.fill())},renderLayerCircle(e){const{layerColor:s,fill:r}=this;this.presetCanvas(e,s,0,x,r)},renderHoverCircle(e,s){const{clockwise:r}=this,i=x*(s/100),t=r?y+i:3*Math.PI-(y+i);this.presetCanvas(e,this.hoverColor,y,t)},drawCircle(e){const{size:s}=this;this.getContext().then(r=>{r.clearRect(0,0,s,s),this.renderLayerCircle(r);const i=W(e);i!==0&&this.renderHoverCircle(r,i),r.draw()})},reRender(){const{value:e,speed:s}=this;if(s<=0||s>1e3){this.drawCircle(e);return}this.clearMockInterval(),this.currentValue=this.currentValue||0;const r=()=>{this.interval=setTimeout(()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<C?this.currentValue=e:this.currentValue<e?this.currentValue+=C:this.currentValue-=C,this.drawCircle(this.currentValue),r()):this.clearMockInterval()},1e3/s)};r()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},R={class:"press-circle-index"},F={class:"press-circle"},H=["id","type","canvas-id"],D={key:0,class:"press-circle__text"},G={key:0,class:"press-circle__text"},O={key:1,class:"press-circle__text"};function j(e,s,r,i,t,o){return c(),d("div",R,[n("div",F,[n("canvas",{id:o.canvasId,class:"press-circle__canvas",type:r.type,style:B(o.circleStyle),"canvas-id":o.canvasId},null,12,H),r.text?(c(),d(T,{key:1},[t.isNotInUni?(c(),d("div",G,m(r.text),1)):(c(),d("cover-view",O,m(r.text),1))],64)):(c(),d("div",D,[M(e.$slots,"default",{},void 0,!0)]))])])}const A=P(L,[["render",j],["__scopeId","data-v-0aee1d31"]]),$={i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:A,PressButton:U},data(){return{value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}},methods:{onChangeCircleValue(e){if(e==="plus"){if(this.value>=100)return;this.value+=20}else if(e==="minus"){if(this.value<=0)return;this.value-=20}}}},Q={class:"demo-wrap demo-wrap--gray"},q={class:"demo-part"},J={class:"demo-part"},K={class:"demo-part"},X={class:"demo-part"},Y={class:"demo-part"};function Z(e,s,r,i,t,o){const l=f("PressCircle"),h=f("demo-block"),v=f("PressButton");return c(),d("div",Q,[a(h,{title:e.t("basicUsage"),"header-style":t.headerStyle,"section-style":t.sectionStyle},{default:p(()=>[a(l,{value:t.value,text:`${t.value}%`},null,8,["value","text"])]),_:1},8,["title","header-style","section-style"]),a(h,{title:e.t("customStyle"),"header-style":t.headerStyle,"section-style":t.sectionStyle},{default:p(()=>[n("div",q,[a(l,{value:t.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),n("div",J,[a(l,{value:t.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),n("div",K,[a(l,{value:t.value,"stroke-width":6,color:t.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),n("div",X,[a(l,{value:t.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),n("div",Y,[a(l,{value:t.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),n("div",null,[a(v,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:s[0]||(s[0]=u=>o.onChangeCircleValue("plus"))},{default:p(()=>[k(m(e.t("add")),1)]),_:1}),a(v,{type:"e-sport-primary",onClick:s[1]||(s[1]=u=>o.onChangeCircleValue("minus"))},{default:p(()=>[k(m(e.t("decrease")),1)]),_:1})])]),_:1},8,["title","header-style","section-style"])])}const re=P($,[["render",Z],["__scopeId","data-v-173fed69"]]);export{re as default};
