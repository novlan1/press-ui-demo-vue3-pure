import{d as x,a as B}from"./press-component-DrBAWcfZ.js";import{P as M}from"./press-loading-plus-DszTOKEu.js";import{e as N,g as p,c as z}from"./rect-BYiZ8mJe.js";import{v as U,n as F}from"./add-unit-BnQ5fsFt.js";import{B as R}from"./bind-event-3T0urj34.js";import{S as H}from"./scroll-view-CCUhjMUN.js";import{_ as D,r as c,o as m,b as O,l as g,a,i as S,m as u,f as h,A as K,t as v,d as C,n as w,p as G,e as W,Y,c as y,F as j,y as q}from"./index-BxhWvFY9.js";import{s as J,a as _,P as Q,F as X}from"./helper-BV40IfCh.js";import{P as Z}from"./press-picker-Be9ysPQR.js";import{P as $}from"./press-cell-Dv-a32-e.js";import"./utils-DhsswyhS.js";import"./style-CpIyAjCl.js";import"./system-CXLAmUl6.js";import"./event-hsD8QdF2.js";import"./support-passive-CNRHRm4O.js";import"./press-popup-DicYmAnN.js";import"./press-button-rGDS5l2l.js";import"./press-icon-plus-BqwcHqXX.js";import"./press-info-BrbwTMID.js";import"./press-loading-CP-vqwEZ.js";import"./button-rDhf7Z8G.js";import"./function-fP_6JZcz.js";import"./press-switch-CCvh-R5W.js";import"./computed-HBwS1k1g.js";import"./functional-CD4QvUta.js";import"./index-DtXFQmnQ.js";import"./link-CJQDnSIb.js";const T="scrollViewId",k=N(T),ee={name:"PressList",options:{...x},components:{PressLoadingPlus:M},mixins:[U,R(function(e){this.autoCheckScroller&&(this.scroller||(this.scroller=z(this.$el)),e(this.scroller,"scroll",this.onScroll,!0),e(this.scroller,"touchmove",this.onScroll,!0),this.onScroll())}),H],props:{offset:{type:[Number,String],default:50},finished:{type:Boolean,default:!1},finishedText:{type:String,default:""},loadingText:{type:String,default:"加载中..."},immediateCheck:{type:Boolean,default:!0},enableFlex:{type:Boolean,default:!1},enhanced:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},enablePassive:{type:Boolean,default:!1},scrollAnchoring:{type:Boolean,default:!1},scrollToElementById:{type:String,default:""},vertical:{type:Boolean,default:!0},loadingStyle:{type:String,default:""},loadingSize:{type:String,default:"20px"},finishedStyle:{type:String,default:""},autoCheckScroller:{type:Boolean,default:!1},scrollLeft:{type:[Number,String],default:0},scrollTop:{type:[Number,String],default:0},...B,customStyle:{type:String,default:""}},emits:["scroll","input","load","update:modelValue"],data(){return{innerLoading:this.realModelValue,SCROLL_VIEW_ID:T,scrollerHeight:0}},computed:{scrollViewClass(){return["press-list",this.vertical?"press-list--vertical":"press-list--hor",this.customClass].join(" ")},scrollViewStyle(){return`height: 100%; ${this.customStyle};`}},watch:{realModelValue:{handler(e){this.innerLoading=e,this.check()}},finished:"check"},mounted(){this.immediateCheck&&this.check()},updated(){},methods:{getScrollerHeight(){this.scrollerHeight||p(this,k).then(e=>{this.scrollerHeight=e.height})},scroll(e){this.getScrollerHeight(),this.$emit("scroll",e,this.scrollerHeight),this.check()},scrollToLower(){this.emitInput()},emitInput(){this.innerLoading||this.finished||(this.innerLoading=!0,this.emitModelValue(!0),this.$emit("load"))},check(){F(()=>{this.innerCheck()})},innerCheck(){if(!this.autoCheckScroller){this.commonCheck();return}},commonCheck(e){const{offset:l}=this;this.innerLoading||this.finished||Promise.all([p(this,".press-list__placeholder"),p(this,k)]).then(t=>{const{0:o,1:i}=t;if(e===void 0&&(e=i),this.innerLoading||this.finished||!(e.bottom-e.top))return;let s=o.bottom-e.bottom;this.vertical||(s=o.right-e.right),s<=l&&this.emitInput()}).catch(()=>{}).finally(()=>{})},onScroll(){const{scroller:e,autoCheckScroller:l}=this;if(!l)return;let t;e!=null&&e.getBoundingClientRect&&(t=e.getBoundingClientRect()),this.commonCheck(t)}}},te=e=>(G("data-v-753d1232"),e=e(),W(),e),le={class:"press-list__layout"},ie=te(()=>a("div",{class:"press-list__placeholder"},null,-1));function oe(e,l,t,o,i,r){const s=c("PressLoadingPlus"),d=c("scroll-view");return m(),O(d,{id:i.SCROLL_VIEW_ID,style:u(r.scrollViewStyle),"scroll-y":t.vertical,"scroll-x":!t.vertical,"scroll-with-animation":t.scrollWithAnimation,"scroll-anchoring":t.scrollAnchoring,enhanced:t.enhanced,"enable-flex":t.enableFlex,"enable-passive":t.enablePassive,"lower-threshold":t.offset,"scroll-into-view":t.scrollToElementById,class:w(r.scrollViewClass),"scroll-top":t.scrollTop,"scroll-left":t.scrollLeft,onScrolltolower:r.scrollToLower,onScroll:r.scroll},{default:g(()=>[a("div",le,[S(e.$slots,"default",{},void 0,!0),i.innerLoading?S(e.$slots,"loading",{key:0},()=>[a("div",{class:"press-list__loading",style:u(t.loadingStyle)},[h(s,{vertical:!t.vertical,size:t.loadingSize},{default:g(()=>[K(v(t.loadingText),1)]),_:1},8,["vertical","size"])],4)],!0):C("",!0),t.finishedText&&t.finished?S(e.$slots,"finished",{key:1},()=>[a("div",{class:"press-list__finished",style:u(t.finishedStyle)},[a("div",null,v(t.finishedText),1)],4)],!0):C("",!0),ie])]),_:3},8,["id","style","scroll-y","scroll-x","scroll-with-animation","scroll-anchoring","enhanced","enable-flex","enable-passive","lower-threshold","scroll-into-view","class","scroll-top","scroll-left","onScrolltolower","onScroll"])}const se=D(ee,[["render",oe],["__scopeId","data-v-753d1232"]]),n={pageSize:20,total:300,delay:200,vertical:!0,autoCheckScroller:!0},P=Array.from({length:5}).map((e,l)=>10**l).reduce((e,l)=>{for(let t=1;t<10;t++)e.push(l*t);return e},[]).map(e=>({label:e,value:e})),I=P.reduce((e,l)=>(e[l.value]=l.label,e),{}),A=Array.from({length:1e3}).map((e,l)=>({label:`${(l+1)*100}ms`,value:(l+1)*100})),re=A.reduce((e,l)=>(e[l.value]=l.label,e),{});function ne({context:e,callback:l}){J({context:e,title:"自定义设置",closeIcon:!0,cellList:[{label:"每次加载数量",value:I[n.pageSize],click:({context:t})=>{t.closeDialog(),_({title:"每次加载数量",closeIcon:!0,list:P,current:{value:n.pageSize},context:e}).then(({item:o})=>{n.pageSize=o.value,e.onGTip("设置成功"),typeof l.changePageSize=="function"&&l.changePageSize.call(e,o.value)}).catch(()=>{})}},{label:"列表总数",value:I[n.total],click:({context:t})=>{t.closeDialog(),_({title:"列表总数",closeIcon:!0,list:P,current:{value:n.total},context:e}).then(({item:o})=>{n.total=o.value,e.onGTip("设置成功"),typeof l.changeTotal=="function"&&l.changeTotal.call(e,o.value)}).catch(()=>{})}},{label:"数据请求时间",value:re[n.delay],click:({context:t})=>{t.closeDialog(),_({title:"数据请求时间",closeIcon:!0,list:A,current:{value:n.delay},context:e}).then(({item:o})=>{n.delay=o.value,e.onGTip("设置成功"),typeof l.changeDelay=="function"&&l.changeDelay.call(e,o.value)}).catch(()=>{})}},{label:"是否竖向滚动",type:"switch",open:n.vertical,click:({context:t})=>{t.closeDialog(),n.vertical=!n.vertical,e.onGTip("设置成功"),typeof l.changeDirection=="function"&&l.changeDirection.call(e,n.vertical)}},{label:"自动检测 Scroller",type:"switch",open:n.autoCheckScroller,click:({context:t})=>{t.closeDialog(),n.autoCheckScroller=!n.autoCheckScroller,typeof l.changeAutoCheckScroller=="function"&&l.changeAutoCheckScroller.call(e,n.autoCheckScroller)}}]})}const L=50,ae=500,ce=(e=ae)=>({data(){return{currentIndex:0,useVirtualList:!0}},computed:{upMissed(){const{currentIndex:l}=this;return Math.max(0,l-e)},showingData(){const{currentIndex:l,upMissed:t,list:o,useVirtualList:i}=this;return i?o.slice(t,l+e).map((r,s)=>({...r,uniqueKey:s+t})):o},hiddenUpPartStyle(){const{upMissed:l,useVirtualList:t}=this;return t?`height: ${l*L}px;`:""},wrapStyle(){const{list:l,useVirtualList:t}=this;return t?`height: ${l.length*L}px;`:""}},methods:{updateCurrentIndex(l,t){const{scrollTop:o,scrollHeight:i}=Y(l);if(o<0||t+o>i)return;const r=Math.round(o/L);this.currentIndex=r}}});function he({length:e,delay:l,beforeLength:t}){return new Promise(o=>{setTimeout(()=>{o({data:Array.from({length:e}).map((i,r)=>{let s=r+t+1;return s<10&&(s=`0${s}`),{label:s,value:s}})})},l||0)})}const ue={i18n:{"zh-CN":{custom:"自定义"},"en-US":{custom:"Custom"}},components:{PressList:se,PressPopupCell:Q,PressPicker:Z,PressCell:$},mixins:[ce()],data(){const e={...n};return{sectionStyle:"margin: 0;background: #f7f8fa;",headerStyle:"background: #f7f8fa;",loading:!1,finished:!1,immediateCheck:!0,list:[],FUNCTIONAL_ID_MAP:X,listLocal:e,listStyle:""}},computed:{},watch:{listLocal:{handler(e){e.vertical||(this.useVirtualList=!1)},deep:!0}},mounted(){},methods:{load(){console.log("[load]"),this.onFetchData()},scroll(e,l){this.updateCurrentIndex(e,l)},onFetchData(e){var i;const{total:l,pageSize:t,delay:o}=this.listLocal;he({delay:o,length:t,beforeLength:e?0:((i=this.list)==null?void 0:i.length)||0}).then(({data:r})=>{let s=e?r:[...this.list,...r];s.length>l&&(s=s.slice(0,l)),this.list=s,console.log("[current total]",s.length),this.loading=!1,this.finished=this.list.length>=l}).catch(()=>{})},onShowBasicPopupCell(){ne({context:this,callback:{changeTotal:this.changeTotal,changePageSize:this.changePageSize,changeDelay:this.changeDelay,changeDirection:this.changeDirection,changeAutoCheckScroller:this.changeAutoCheckScroller}})},changePageSize(e){this.listLocal={...this.listLocal,pageSize:e},this.generateData()},changeTotal(e){this.listLocal={...this.listLocal,total:e},this.generateData()},changeDelay(e){this.listLocal={...this.listLocal,delay:e},this.generateData()},changeDirection(e){this.listLocal={...this.listLocal,vertical:e},this.generateData()},changeAutoCheckScroller(e){this.listLocal={...this.listLocal,autoCheckScroller:e},this.list=[],this.generateData()},generateData(){this.loading=!0,this.onFetchData(!0)}}},de={class:"demo-container"};function fe(e,l,t,o,i,r){const s=c("press-cell"),d=c("demo-block"),E=c("PressList"),V=c("PressPopupCell"),b=c("PressPicker");return m(),y("div",{class:w(["demo-wrap demo-wrap--gray demo-wrap--flex",i.listLocal.vertical?"":"demo-wrap--hor"])},[h(d,{title:e.t("basicUsage"),"section-style":i.sectionStyle,"header-style":i.headerStyle},{default:g(()=>[h(s,{title:e.t("custom"),"is-link":"",onClick:r.onShowBasicPopupCell},null,8,["title","onClick"])]),_:1},8,["title","section-style","header-style"]),a("div",de,[h(E,{modelValue:i.loading,"onUpdate:modelValue":l[0]||(l[0]=f=>i.loading=f),finished:i.finished,"immediate-check":i.immediateCheck,vertical:i.listLocal.vertical,"finished-text":"没有更多了","auto-check-scroller":i.listLocal.autoCheckScroller,"custom-style":i.listStyle,onLoad:r.load,onScroll:r.scroll},{default:g(()=>[a("div",{style:u(e.wrapStyle),class:"list__wrap"},[a("div",{style:u(e.hiddenUpPartStyle)},null,4),(m(!0),y(j,null,q(e.showingData,f=>(m(),y("div",{key:f.value,class:"list__item"},v(f.label),1))),128))],4)]),_:1},8,["modelValue","finished","immediate-check","vertical","auto-check-scroller","custom-style","onLoad","onScroll"])]),h(V,{id:i.FUNCTIONAL_ID_MAP.POPUP_CELL,ref:i.FUNCTIONAL_ID_MAP.POPUP_CELL,mode:"functional"},null,8,["id"]),h(b,{id:i.FUNCTIONAL_ID_MAP.PICKER,ref:i.FUNCTIONAL_ID_MAP.PICKER,mode:"functional"},null,8,["id"])],2)}const He=D(ue,[["render",fe],["__scopeId","data-v-d2486478"]]);export{He as default};
