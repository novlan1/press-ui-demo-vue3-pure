import{i as S,ab as _,_ as I,c as o,o as a,b as f,a as n,B as l,a1 as y,ac as z,ad as E,u as h,C as B,v as F,x as P,y as C,r as m,d as p,h as H,w as U,F as L,A as w,e as b}from"./index-DImLPMl-.js";S()&&_(["uni-image"],app);function k(e){return navigator.vendor==="Google Inc."&&e>10&&(e=Math.round(e/2)*2),e}const N={name:"Image",props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},lazyLoad:{type:[Boolean,String],default:!1},draggable:{type:Boolean,default:!1}},data(){return{originalWidth:0,originalHeight:0,originalStyle:{width:"",height:""},contentPath:""}},computed:{isVue2(){let e=!0;return e=!1,e},ratio(){return this.originalWidth&&this.originalHeight?this.originalWidth/this.originalHeight:0},style(){let e="auto",t="";const r="no-repeat";switch(this.mode){case"aspectFit":e="contain",t="center center";break;case"aspectFill":e="cover",t="center center";break;case"widthFix":case"heightFix":e="100% 100%";break;case"top":t="center top";break;case"bottom":t="center bottom";break;case"center":t="center center";break;case"left":t="left center";break;case"right":t="right center";break;case"top left":t="left top";break;case"top right":t="right top";break;case"bottom left":t="left bottom";break;case"bottom right":t="right bottom";break;default:e="100% 100%",t="0% 0%";break}return{"background-image":this.contentPath?`url("${this.contentPath}")`:"none","background-position":t,"background-size":e,"background-repeat":r}}},watch:{src(){this._loadImage()},mode(e,t){(t==="widthFix"||t==="heightFix")&&this._resetSize(),(e==="widthFix"||e==="heightFix")&&this._fixSize()},contentPath(e){!e&&this.__img&&(this.__img.remove(),delete this.__img)}},mounted(){this.originalStyle.width=this.$el.style.width||"",this.originalStyle.height=this.$el.style.height||"",this._loadImage()},beforeDestroy(){this._clearImage()},methods:{_fixSize(){if(this.ratio){const{$el:e}=this;if(this.mode==="widthFix"){const t=e.offsetWidth;t&&(e.style.height=`${k(t/this.ratio)}px`)}else if(this.mode==="heightFix"){const t=e.offsetHeight;t&&(e.style.width=`${k(t*this.ratio)}px`)}}window.dispatchEvent(new CustomEvent("updateview"))},_resetSize(){this.$el.style.width=this.originalStyle.width,this.$el.style.height=this.originalStyle.height},_resetData(){this.originalWidth=0,this.originalHeight=0,this.contentPath=""},_loadImage(){const e=this.src;if(e){this._img=this._img||new Image;const t=this._img;t.onload=r=>{this._img=null,this.originalWidth=t.width;const g=this.originalWidth;this.originalHeight=t.height;const s=this.originalHeight;this._fixSize(),this.contentPath=e,t.draggable=this.draggable,this.__img&&this.__img.remove(),this.__img=t,this.$el.appendChild(t),this.$emit("load",r,{width:g,height:s})},t.onerror=r=>{this._img=null,this._resetData(),this.$emit("error",r,{errMsg:`GET ${this.src} 404 (Not Found)`})},t.src=e}else this._clearImage(),this._resetData()},_clearImage(){const e=this._img;e&&(e.onload=null,e.onerror=null,this._img=null)}}};function T(e,t,r,g,s,i){return i.isVue2?(a(),o("uni-image",y({key:0},z(e.$listeners,!0)),[f("div",{ref:"content",style:l(i.style)},null,4),r.mode==="widthFix"||r.mode==="heightFix"?(a(),o("div",{key:0,ref:"sensor",onResize:t[0]||(t[0]=u=>i._fixSize())},null,544)):n("",!0)],16)):(a(),o("uni-image",E(y({key:1},e.$attrs)),[f("div",{ref:"content",style:l(i.style)},null,4),r.mode==="widthFix"||r.mode==="heightFix"?(a(),o("div",{key:0,ref:"sensor",onResize:t[1]||(t[1]=u=>i._fixSize())},null,544)):n("",!0)],16))}const R=I(N,[["render",T],["__scopeId","data-v-369baf78"]]),W={props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},width:{type:[String,Number],default:300},height:{type:[String,Number],default:225},round:{type:Boolean,default:!1},radius:{type:[String,Number],default:0},lazyLoad:{type:Boolean,default:!0},showMenuByLongpress:{type:Boolean,default:!0},loadingIcon:{type:String,default:"photo"},errorIcon:{type:String,default:"photo-fail"},showLoading:{type:Boolean,default:!0},showError:{type:Boolean,default:!0},fade:{type:Boolean,default:!0},webp:{type:Boolean,default:!1},duration:{type:[String,Number],default:500},backgroundColor:{type:String,default:"#f3f4f6"},customStyle:{type:[String,Object],default:""},transitionStyle:{type:String,default:""}}},M={name:"PressImage",options:{...P(!0,!1),styleIsolation:"shared"},components:{PressIcon:F,PressTransition:B,InnerImage:R},mixins:[W],emits:["click","error","load"],data(){return{isError:!1,loading:!0,opacity:1,durationTime:this.duration,backgroundStyle:{},show:!1,isNotInUni:S()}},computed:{wrapStyle(){const e={};return e.width=h(this.width),e.height=h(this.height),e.borderRadius=this.round?"10000px":h(this.radius),e.overflow=this.radius>0?"hidden":"visible",C([{...e,...this.backgroundStyle},this.customStyle])}},watch:{src:{immediate:!0,handler(e){e?(this.isError=!1,this.loading=!0):this.isError=!0}}},mounted(){this.show=!0},methods:{addUnit:h,onClick(){this.$emit("click")},onErrorHandler(e){this.loading=!1,this.isError=!0,this.$emit("error",e)},onLoadHandler(e){this.loading=!1,this.isError=!1,this.$emit("load",e),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}}}},D=["src","mode","show-menu-by-longpress","lazy-load"];function V(e,t,r,g,s,i){const u=m("InnerImage"),c=m("PressIcon"),v=m("PressTransition");return a(),p(v,{mode:"fade",show:s.show,duration:e.fade?s.durationTime:0,"custom-style":`display: inline-block;${e.transitionStyle}`},{default:H(()=>[f("div",{class:"press-image",style:l(i.wrapStyle),onClick:t[2]||(t[2]=U((...d)=>i.onClick&&i.onClick(...d),["stop"]))},[s.isError?n("",!0):(a(),o(L,{key:0},[s.isNotInUni?(a(),p(u,{key:0,src:e.src,mode:e.mode,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"press-image__image",style:l({borderRadius:e.round?"10000px":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)}),onError:i.onErrorHandler,onLoad:i.onLoadHandler},null,8,["src","mode","show-menu-by-longpress","lazy-load","style","onError","onLoad"])):n("",!0),s.isNotInUni?n("",!0):(a(),o("image",{key:1,src:e.src,mode:e.mode,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"press-image__image",style:l({borderRadius:e.round?"10000px":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)}),onError:t[0]||(t[0]=(...d)=>i.onErrorHandler&&i.onErrorHandler(...d)),onLoad:t[1]||(t[1]=(...d)=>i.onLoadHandler&&i.onLoadHandler(...d))},null,44,D))],64)),e.showLoading&&s.loading?(a(),o("div",{key:1,class:"press-image__loading",style:l({borderRadius:e.round?"50%":i.addUnit(e.radius),backgroundColor:e.backgroundColor,width:i.addUnit(e.width),height:i.addUnit(e.height)})},[w(e.$slots,"loading",{},()=>[b(c,{name:e.loadingIcon,width:e.width,height:e.height},null,8,["name","width","height"])],!0)],4)):n("",!0),e.showError&&s.isError&&!s.loading?(a(),o("div",{key:2,class:"press-image__error",style:l({borderRadius:e.round?"50%":i.addUnit(e.radius),width:i.addUnit(e.width),height:i.addUnit(e.height)})},[w(e.$slots,"error",{},()=>[b(c,{name:e.errorIcon,width:e.width,height:e.height},null,8,["name","width","height"])],!0)],4)):n("",!0)],4)]),_:3},8,["show","duration","custom-style"])}const O=I(M,[["render",V],["__scopeId","data-v-71f65b26"]]);export{O as P};
