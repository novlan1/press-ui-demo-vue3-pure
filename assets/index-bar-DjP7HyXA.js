import{P as N}from"./press-cell-Cz3e_1E1.js";import{v as b,x as w,_ as v,o as l,c,a as I,n as E,m as y,l as k,t as O,R as A,ag as C,r as T,e as f,k as P,w as x,F as D,q as R,d as z}from"./index-BC9YZb89.js";import{h as L}from"./parent-map-12wGqNaT.js";import{g as m,a as M,f as j}from"./rect-DfXZL5_q.js";import{C as V,P as H}from"./relation-Ce8eT7mn.js";import{a as Y}from"./color-DciZLlTH.js";import{S as W}from"./scroll-view-Cb9lPJX8.js";import"./event-Dg0tN7JJ.js";import"./link-jZiKsnzo.js";const q={name:"PressIndexAnchor",options:{...b,styleIsolation:"shared"},mixins:[V(L,{indexKey:"tIndex"})],props:{useSlot:Boolean,index:{type:[Number,String],default:""},...w},emits:[],data(){return{active:!1,wrapperStyle:"",anchorStyle:""}},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},scrollIntoView(e,t){m(this,".press-index-anchor-wrapper").then(s=>{const r=e+s.top;t==null||t(r)})}}},F={key:1};function $(e,t,s,r,o,i){return l(),c("div",null,[I("div",{class:"press-index-anchor-wrapper",style:y(o.wrapperStyle)},[I("div",{class:E("press-index-anchor "+(o.active?"press-index-anchor--active press-hairline--bottom":"")),style:y(o.anchorStyle)},[s.useSlot?k(e.$slots,"default",{key:0},void 0,!0):(l(),c("span",F,O(s.index),1))],6)],4)])}const G=v(q,[["render",$],["__scopeId","data-v-50d04bcb"]]),K=()=>{const e=[];for(let s=0;s<26;s++)e.push(String.fromCharCode(65+s));return e},U={name:"PressIndexBar",options:{...b,styleIsolation:"shared"},mixins:[H(L),W],props:{sticky:{type:Boolean,default:!0},zIndex:{type:Number,default:1},highlightColor:{type:String,default:Y},stickyOffsetTop:{type:Number,default:0},indexList:{type:Array,default:()=>K()},...w},emits:["select"],data(){return{activeAnchorIndex:null,showSidebar:!1,sidebar:{},curScrollTop:0}},created(){this.scrollTop=0,this.children=[]},mounted(){this.updateData()},methods:{setData(e){Object.keys(e).forEach(t=>{this[t]=e[t]})},updateData(){A(()=>{this.timer!=null&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.showSidebar=!!this.children.length,A(()=>{this.setRect().then(()=>{this.onScroll()})})},0)})},setRect(){return Promise.all([this.setAnchorsRect(),this.setListRect(),this.setSiderbarRect()])},setAnchorsRect(){return Promise.all(this.children.map(e=>m(e,".press-index-anchor-wrapper").then(t=>(Object.assign(e,{height:t.height,top:t.top+this.scrollTop}),e))))},setListRect(){return m(this,".press-index-bar").then(e=>{C(e)&&Object.assign(this,{height:e.height,top:e.top+this.scrollTop})})},setSiderbarRect(){return m(this,".press-index-bar__sidebar").then(e=>{C(e)&&(this.sidebar={height:e.height,top:e.top})})},setDiffData({target:e,data:t}){const s={};Object.keys(t).forEach(r=>{e[r]!==t[r]&&(s[r]=t[r])}),Object.keys(s).length&&e.setData(s)},getAnchorRect(e){return m(e,".press-index-anchor-wrapper").then(t=>({height:t.height,top:t.top}))},getActiveAnchorIndex(){const{children:e,scrollTop:t}=this,{sticky:s}=this;for(let r=this.children.length-1;r>=0;r--){const o=r>0?e[r-1].height:0;if((s?o:0)+t>=e[r].top)return r}return-1},onScroll(e){var a,d;e&&(e.target||e.detail)&&(this.scrollTop=((a=e.target)==null?void 0:a.scrollTop)||((d=e.detail)==null?void 0:d.scrollTop)||0);const{children:t=[],scrollTop:s}=this;if(!t.length)return;const{sticky:r,stickyOffsetTop:o,zIndex:i,highlightColor:h}=this,n=this.getActiveAnchorIndex();if(this.setDiffData({target:this,data:{activeAnchorIndex:n}}),r){let g=!1;n!==-1&&(g=t[n].top<=+s),t.forEach((_,p)=>{if(p===n){let u="",S=`
              color: ${h};
            `;g&&(u=`
                height: ${t[p].height}px;
              `,S=`
                position: fixed;
                top: ${o}px;
                z-index: ${i};
                color: ${h};
              `),this.setDiffData({target:_,data:{active:!0,anchorStyle:S,wrapperStyle:u}})}else if(p===n-1){const u=t[p],S=u.top,B=`
              position: relative;
              transform: translate3d(0, ${(p===t.length-1?this.top:t[p+1].top)-S-u.height}px, 0);
              z-index: ${i};
              color: ${h};
            `;this.setDiffData({target:_,data:{active:!0,anchorStyle:B}})}else this.setDiffData({target:_,data:{active:!1,anchorStyle:"",wrapperStyle:""}})})}},onClick(){},onTouchMove(e){const t=this.children.length,s=e.touches[0],r=this.sidebar.height/t;let o;o=Math.floor((M(s.clientY)-this.sidebar.top)/r),o<0?o=0:o>t-1&&(o=t-1),this.scrollToAnchor(o)},onTouchStop(){this.scrollToAnchorIndex=null},scrollToAnchor(e){if(typeof e!="number"||this.scrollToAnchorIndex===e)return;this.scrollToAnchorIndex=e;const t=this.children.find(s=>s.index===this.indexList[e]);t!==void 0&&(t.scrollIntoView(this.scrollTop,this.changeScrollerTop),this.$emit("select",t.index))},onClickInner(e){var s,r;const t=(r=(s=e.currentTarget)==null?void 0:s.dataset)==null?void 0:r.index;t!==void 0&&this.scrollToAnchor(+t)},onWatchScroll(e){this.onScroll(e)},changeScrollerTop(e){const t=j("pressIndexBarWrapper"),s=document==null?void 0:document.querySelector(t);s&&(s.scrollTop=e)}}},X={class:"press-index-bar-container"},J={class:"press-index-bar"},Q=["data-index"];function Z(e,t,s,r,o,i){const h=T("scroll-view");return l(),c("div",X,[f(h,{id:"pressIndexBarWrapper",class:"press-index-bar-wrapper",enhanced:"","scroll-with-animation":!1,"scroll-y":"","scroll-top":o.curScrollTop,onScroll:i.onWatchScroll},{default:P(()=>[I("div",J,[k(e.$slots,"default",{},void 0,!0)])]),_:3},8,["scroll-top","onScroll"]),o.showSidebar?(l(),c("div",{key:0,class:"press-index-bar__sidebar",onClick:t[1]||(t[1]=x((...n)=>i.onClick&&i.onClick(...n),["stop","prevent"])),onTouchmove:t[2]||(t[2]=x((...n)=>i.onTouchMove&&i.onTouchMove(...n),["stop","prevent"])),onTouchend:t[3]||(t[3]=x((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop"])),onTouchcancel:t[4]||(t[4]=x((...n)=>i.onTouchStop&&i.onTouchStop(...n),["stop","prevent"]))},[(l(!0),c(D,null,R(s.indexList,(n,a)=>(l(),c("div",{key:a,class:"press-index-bar__index",style:y("z-index: "+(s.zIndex+1)+"; color: "+(o.activeAnchorIndex===a?s.highlightColor:"")),"data-index":a,onClick:t[0]||(t[0]=x((...d)=>i.onClickInner&&i.onClickInner(...d),["stop"]))},O(n),13,Q))),128))],32)):z("",!0)])}const ee=v(U,[["render",Z],["__scopeId","data-v-6cf7df0e"]]);function te(){const e=[];for(let t=65;t<91;t++)e.push(String.fromCharCode(t));return e}const se=te(),re={i18n:{"zh-CN":{text:"文本",customIndexList:"自定义索引列表"},"en-US":{text:"Text",customIndexList:"Custom Index List"}},components:{PressCell:N,PressIndexBar:ee,PressIndexAnchor:G},data(){let e="",t=0;return t=44,{anchorList:se,wrapStyle:e,stickyOffsetTop:t}},mounted(){},methods:{onSelect(e){console.log("[onSelect]: ",e)}}};function oe(e,t,s,r,o,i){const h=T("PressIndexAnchor"),n=T("PressCell"),a=T("PressIndexBar");return l(),c("div",{class:"demo-wrap",style:y(o.wrapStyle)},[f(a,{"sticky-offset-top":o.stickyOffsetTop,onSelect:i.onSelect},{default:P(()=>[(l(!0),c(D,null,R(o.anchorList,(d,g)=>(l(),c("div",{key:g},[f(h,{index:d},null,8,["index"]),f(n,{title:e.t("text")},null,8,["title"]),f(n,{title:e.t("text")},null,8,["title"]),f(n,{title:e.t("text")},null,8,["title"])]))),128))]),_:1},8,["sticky-offset-top","onSelect"])],4)}const ge=v(re,[["render",oe]]);export{ge as default};
